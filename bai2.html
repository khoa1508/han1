<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrÃ² ChÆ¡i Ã”n Táº­p Tiáº¿ng Trung</title>

    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align items to the top */
            min-height: 100vh;
        }

        #game-container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1, h2 {
            color: #0056b3; /* Darker blue */
            margin-bottom: 15px;
        }

        #welcome-screen ul {
            list-style: none;
            padding: 0;
            text-align: left;
            display: inline-block; /* Center the list block */
            margin-bottom: 20px;
        }

        #welcome-screen li {
            margin-bottom: 8px;
        }

        #welcome-screen b {
            color: #007bff; /* Brighter blue */
        }


        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 5px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
        }

        #hint-button {
            background-color: #ffc107; /* Yellow for hint */
            color: #333;
        }

        #hint-button:hover {
            background-color: #e0a800;
        }

        #restart-button {
            background-color: #28a745; /* Green for restart */
        }
        #restart-button:hover {
            background-color: #218838;
        }


        input[type="text"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 10px 0;
            width: calc(100% - 22px); /* Adjust width considering padding */
            font-size: 1em;
        }

        #vocab-image {
            max-width: 250px; /* Limit image size */
            max-height: 200px;
            height: auto;
            margin: 15px auto; /* Center image */
            display: block;
            border: 1px solid #eee;
            border-radius: 4px;
            /* Add a background color in case images fail to load */
            background-color: #eee;
        }

        #pinyin-display, #scrambled-sentence {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            color: #555;
        }

        #scrambled-sentence {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace; /* Makes slashes clearer */
            word-wrap: break-word; /* Ensure long scrambled parts wrap */
        }


        p#feedback-part1, p#feedback-part2 {
            margin-top: 10px;
            font-weight: bold;
            white-space: pre-wrap; /* Allow line breaks in feedback */
        }

        p#attempts-left {
            color: #dc3545; /* Red for attempts */
            font-size: 0.9em;
        }

        p#hint-display {
            margin-top: 10px;
            color: #17a2b8; /* Teal for hint text */
            background-color: #e2f6f8;
            padding: 8px;
            border-radius: 4px;
            font-style: italic;
            white-space: pre-wrap; /* Allow line breaks in hints */
            text-align: left; /* Align hint text left */
        }

        /* Feedback colors */
        .correct {
            color: #28a745; /* Green */
        }

        .incorrect {
            color: #dc3545; /* Red */
        }

        .info {
            color: #0056b3; /* Blue for info like correct answer */
        }

        .hidden {
            display: none;
        }

        /* Summary Table */
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #007bff;
            color: white;
            text-align: center;
        }

        tbody tr:nth-child(odd) {
            background-color: #f2f2f2;
        }
    </style>
    </head>
<body>

    <div id="game-container">
        <h1>TrÃ² ChÆ¡i Ã”n Táº­p Tiáº¿ng Trung ğŸ‡¨ğŸ‡³</h1>

        <div id="welcome-screen">
            <p>ChÃ o má»«ng báº¡n! TrÃ² chÆ¡i gá»“m 2 pháº§n:</p>
            <ul>
                <li><b>Pháº§n 1:</b> Äiá»n chá»¯ HÃ¡n dá»±a vÃ o hÃ¬nh áº£nh vÃ  Pinyin (3 láº§n Ä‘oÃ¡n sai).</li>
                <li><b>Pháº§n 2:</b> Sáº¯p xáº¿p láº¡i cÃ¢u tiáº¿ng Trung bá»‹ Ä‘áº£o lá»™n.</li>
            </ul>
            <button id="start-button">Báº¯t Äáº§u!</button>
        </div>

        <div id="part1-area" class="hidden">
            <h2>Pháº§n 1: Ã”n Táº­p Tá»« Vá»±ng</h2>
            <p id="vocab-counter"></p>
            <img id="vocab-image" src="" alt="HÃ¬nh áº£nh tá»« vá»±ng">
            <p><b>Pinyin:</b> <span id="pinyin-display"></span></p>
            <label for="hanzi-input">Nháº­p chá»¯ HÃ¡n:</label>
            <input type="text" id="hanzi-input" autocomplete="off">
            <button id="submit-part1">Kiá»ƒm Tra</button>
            <p id="feedback-part1"></p>
            <p id="attempts-left"></p>
        </div>

        <div id="part2-area" class="hidden">
            <h2>Pháº§n 2: Sáº¯p Xáº¿p CÃ¢u</h2>
            <p id="sentence-counter"></p>
            <p><b>CÃ¡c cá»¥m tá»« bá»‹ Ä‘áº£o lá»™n:</b></p>
            <p id="scrambled-sentence"></p>
            <label for="sentence-input">Nháº­p cÃ¢u Ä‘Ãºng:</label>
            <input type="text" id="sentence-input" autocomplete="off">
            <button id="submit-part2">Kiá»ƒm Tra</button>
            <button id="hint-button">Gá»£i Ã</button>
            <p id="feedback-part2"></p>
            <p id="hint-display" class="hidden"></p> </div>

        <div id="summary-area" class="hidden">
            <h2>ğŸ“Š Tá»•ng Káº¿t TrÃ² ChÆ¡i ğŸ“Š</h2>
            <table>
                <thead>
                    <tr>
                        <th>Pháº§n chÆ¡i</th>
                        <th>Ná»™i dung</th>
                        <th>Sá»‘ lÆ°á»£ng</th>
                        <th>Sá»‘ cÃ¢u/tá»« Ä‘Ãºng</th>
                        <th>Ghi chÃº</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Pháº§n 1</td>
                        <td>Ã”n táº­p Tá»« vá»±ng</td>
                        <td id="summary-p1-total"></td>
                        <td id="summary-p1-correct"></td>
                        <td id="summary-p1-notes"></td>
                    </tr>
                    <tr>
                        <td>Pháº§n 2</td>
                        <td>Sáº¯p xáº¿p cÃ¢u</td>
                        <td id="summary-p2-total"></td>
                        <td id="summary-p2-correct"></td>
                        <td id="summary-p2-notes"></td>
                    </tr>
                </tbody>
            </table>
            <button id="restart-button">ChÆ¡i Láº¡i</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ** NEW DATA ** ---
            const vocabData = [
                { hanzi: 'æ±‰è¯­', pinyin: 'HÃ n yÇ”', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTfoqvBj8X5Kp1m0D7VwKAHQdPu-n8N9FY_Ow&s' },
                { hanzi: 'å¿™', pinyin: 'mÃ¡ng', image: 'https://5b0988e595225.cdn.sohucs.com/q_70,c_zoom,w_640/images/20191012/ce94debabde74e01ac1e82ff6d6925f4.jpeg' },
                { hanzi: 'ç´¯', pinyin: 'lÃ¨i', image: 'https://p3-pc-sign.douyinpic.com/tos-cn-i-0813/o0DAQD5bW5eIKSA9Jx6k7A8PgAfniHgAAd8NSC~tplv-dy-aweme-images:q75.webp?biz_tag=aweme_images&from=327834062&lk3s=138a59ce&s=PackSourceEnum_SEARCH&sc=image&se=false&x-expires=1747098000&x-signature=R9Sd1m4ejOo5lxpBsocmDOjQ43M%3D' },
                { hanzi: 'å¥½', pinyin: 'hÇo', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSB-hnhmHCigmm4d_woj729jRQCUiblDyBuaw&s' },
                { hanzi: 'ä»–', pinyin: 'TÄ', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR-tw9iZZgNla6wilh2iopPoaSAjIrC2FPu9w&s' },
                { hanzi: 'å¥¹', pinyin: 'TÄ', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRF4dJR4-ADUaYdVzkNCM2NYo6n0_kS-TRRmw&s' },
                { hanzi: 'ç”·', pinyin: 'NÃ¡n', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQwCbnK9z5HKzZZmLLpjka1csWmlSoKKqyBtQ&s' },
                { hanzi: 'å¥³', pinyin: 'NÇš', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSHSTQLezhAjhf515pGBYHvboyfK5BjmZ_RZQ&s' },
                { hanzi: 'çˆ¸çˆ¸', pinyin: 'BÃ ba', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTUarQEuHN8aV8zWgjlsP7Ju0HbgPwURan3Og&s' },
                { hanzi: 'å¦ˆå¦ˆ', pinyin: 'MÄma', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRs_H0os62bjrhhfxQh2GFTlPOYFbGX0PNTmg&s' },
                { hanzi: 'å§å§', pinyin: 'JiÄ›jie', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTnfZSFhToXRWk4Bt4CUvA6bcMeKc_xImIIpQ&s' },
                { hanzi: 'å¼Ÿå¼Ÿ', pinyin: 'DÃ¬di', image: 'https://img.freepik.com/premium-vector/old-brother-annoy-his-younger-brother-because-too-short_10045-317.jpg' },
                { hanzi: 'å“¥å“¥', pinyin: 'GÄ“ge', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRraVCUeAN-e7EQeFH_zPfG5_QE80LHSqdREw&s' },
                { hanzi: 'å¦¹å¦¹', pinyin: 'MÃ¨imei', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTWreM5C8zPoKMJ27SssJME1b-cYBKWIrrbkw&s' }
            ];

            const sentenceData = [
                { correct: 'æ±‰è¯­éš¾å—', pinyin: 'HÃ n yÇ” nÃ¡n ma', scrambled: 'éš¾å—/æ±‰è¯­', translation: 'Tiáº¿ng Trung cÃ³ khÃ³ khÃ´ng?' },
                { correct: 'æ±‰è¯­å¾ˆéš¾', pinyin: 'HÃ n yÇ” hÄ›n nÃ¡n', scrambled: 'å¾ˆéš¾/æ±‰è¯­', translation: 'Tiáº¿ng Trung ráº¥t khÃ³' },
                { correct: 'ä½ å¿™å—', pinyin: 'NÇ mÃ¡ng ma', scrambled: 'å¿™å—/ä½ ', translation: 'Báº¡n cÃ³ báº­n khÃ´ng?' },
                { correct: 'æˆ‘å¾ˆå¿™', pinyin: 'WÇ’ hÄ›n mÃ¡ng', scrambled: 'å¿™/å¾ˆ/æˆ‘', translation: 'TÃ´i ráº¥t báº­n' },
                { correct: 'æˆ‘ä¸å¿™', pinyin: 'WÇ’ bÃ¹ mÃ¡ng', scrambled: 'å¿™/ä¸/æˆ‘', translation: 'TÃ´i khÃ´ng báº­n' },
                { correct: 'ä½ ç´¯å—', pinyin: 'NÇ lÃ¨i ma', scrambled: 'ç´¯å—/ä½ ', translation: 'Báº¡n cÃ³ má»‡t khÃ´ng?' },
                { correct: 'æˆ‘ä¸ç´¯', pinyin: 'WÇ’ bÃ¹ lÃ¨i', scrambled: 'ç´¯/ä¸/æˆ‘', translation: 'TÃ´i khÃ´ng má»‡t' },
                { correct: 'æ±‰è¯­éš¾å—', pinyin: 'HÃ n yÇ” nÃ¡n ma', scrambled: 'éš¾å—/æ±‰è¯­', translation: 'Tiáº¿ng Trung cÃ³ khÃ³ khÃ´ng?' }, // CÃ¢u láº·p láº¡i nhÆ° Ä‘Æ°á»£c cung cáº¥p
                { correct: 'ä¸å¤ªå¿™', pinyin: 'BÃº tÃ i mÃ¡ng', scrambled: 'å¿™/ä¸å¤ª', translation: 'KhÃ´ng quÃ¡ báº­n' }, // ChÃº Ã½ pinyin BÃº
                { correct: 'ä¸å¤ªå¥½', pinyin: 'BÃ¹ tÃ i hÇo', scrambled: 'å¥½/ä¸å¤ª', translation: 'KhÃ´ng quÃ¡ tá»‘t' },
                { correct: 'æˆ‘å¾ˆå¥½', pinyin: 'WÇ’ hÄ›n hÇo', scrambled: 'å¥½/å¾ˆ/æˆ‘', translation: 'TÃ´i ráº¥t khá»e' },
                { correct: 'æˆ‘çˆ¸çˆ¸å¾ˆå¥½', pinyin: 'WÇ’ bÃ ba hÄ›n hÇo', scrambled: 'å¥½/å¾ˆ/çˆ¸çˆ¸/æˆ‘', translation: 'Bá»‘ tÃ´i ráº¥t khá»e' },
                { correct: 'æˆ‘æœ‰å“¥å“¥', pinyin: 'WÇ’ yÇ’u gÄ“ge', scrambled: 'å“¥å“¥/æœ‰/æˆ‘', translation: 'TÃ´i cÃ³ anh trai' },
                { correct: 'æˆ‘æ²¡æœ‰å§å§', pinyin: 'WÇ’ mÃ©iyÇ’u jiÄ›jie', scrambled: 'å§å§/æ²¡æœ‰/æˆ‘', translation: 'TÃ´i khÃ´ng cÃ³ chá»‹ gÃ¡i' },
                { correct: 'æˆ‘æœ‰çˆ¸çˆ¸å¦ˆå¦ˆ', pinyin: 'WÇ’ yÇ’u bÃ ba mÄma', scrambled: 'çˆ¸çˆ¸å¦ˆå¦ˆ/æœ‰/æˆ‘', translation: 'TÃ´i cÃ³ bá»‘ vÃ  máº¹' },
                { correct: 'çˆ¸çˆ¸å¦ˆå¦ˆå¾ˆå¥½', pinyin: 'BÃ ba mÄma hÄ›n hÇo', scrambled: 'å¾ˆå¥½/çˆ¸çˆ¸å¦ˆå¦ˆ', translation: 'Bá»‘ vÃ  máº¹ ráº¥t tá»‘t' }
           ];
            // --- ** END NEW DATA ** ---


            // --- DOM Elements ---
            const welcomeScreen = document.getElementById('welcome-screen');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');

            const part1Area = document.getElementById('part1-area');
            const vocabCounter = document.getElementById('vocab-counter');
            const vocabImage = document.getElementById('vocab-image');
            const pinyinDisplay = document.getElementById('pinyin-display');
            const hanziInput = document.getElementById('hanzi-input');
            const submitPart1 = document.getElementById('submit-part1');
            const feedbackPart1 = document.getElementById('feedback-part1');
            const attemptsLeftDisplay = document.getElementById('attempts-left');

            const part2Area = document.getElementById('part2-area');
            const sentenceCounter = document.getElementById('sentence-counter');
            const scrambledSentence = document.getElementById('scrambled-sentence');
            const sentenceInput = document.getElementById('sentence-input');
            const submitPart2 = document.getElementById('submit-part2');
            const hintButton = document.getElementById('hint-button');
            const feedbackPart2 = document.getElementById('feedback-part2');
            const hintDisplay = document.getElementById('hint-display');

            const summaryArea = document.getElementById('summary-area');
            const summaryP1Total = document.getElementById('summary-p1-total');
            const summaryP1Correct = document.getElementById('summary-p1-correct');
            const summaryP1Notes = document.getElementById('summary-p1-notes');
            const summaryP2Total = document.getElementById('summary-p2-total');
            const summaryP2Correct = document.getElementById('summary-p2-correct');
            const summaryP2Notes = document.getElementById('summary-p2-notes');

            // --- Game State ---
            let currentPart = 0; // 0: Welcome, 1: Vocab, 2: Sentence, 3: Summary
            let currentWordIndex = 0;
            let currentSentenceIndex = 0;
            let attemptsLeft = 3;
            let scorePart1 = 0;
            let scorePart2 = 0;
            let part1CorrectFirstTry = 0; // Track correct on first attempt for Part 1
            let part1Revealed = 0; // Track answers revealed after 3 fails
            let hintsUsed = 0;
            let shuffledVocab = [];
            let shuffledSentences = [];

            // --- Utility Functions ---
            function shuffleArray(array) {
                // Simple Fisher-Yates shuffle
                let currentIndex = array.length, randomIndex;
                while (currentIndex !== 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            }


            function hideAllSections() {
                welcomeScreen.classList.add('hidden');
                part1Area.classList.add('hidden');
                part2Area.classList.add('hidden');
                summaryArea.classList.add('hidden');
            }

            function updateFeedback(element, message, type) {
                element.innerHTML = message.replace(/\n/g, '<br>'); // Replace newline chars with <br> for HTML display
                element.className = type; // 'correct', 'incorrect', 'info'
            }

            // --- Game Logic Functions ---

            function startGame() {
                // Reset state
                currentPart = 1;
                currentWordIndex = 0;
                currentSentenceIndex = 0;
                scorePart1 = 0;
                scorePart2 = 0;
                part1CorrectFirstTry = 0;
                part1Revealed = 0;
                hintsUsed = 0;

                // Shuffle data for variety
                shuffledVocab = shuffleArray([...vocabData]);
                shuffledSentences = shuffleArray([...sentenceData]);

                hideAllSections();
                part1Area.classList.remove('hidden');
                loadVocabQuestion();
            }

            function loadVocabQuestion() {
                if (currentWordIndex >= shuffledVocab.length) {
                    startPart2(); // Move to part 2 if vocab is done
                    return;
                }

                const currentWord = shuffledVocab[currentWordIndex];
                vocabCounter.textContent = `Tá»« ${currentWordIndex + 1} / ${shuffledVocab.length}`;
                vocabImage.src = currentWord.image;
                 // Handle potential image loading errors
                vocabImage.onerror = function() {
                    this.alt = `Lá»—i táº£i áº£nh cho: ${currentWord.pinyin}`;
                    this.src = ''; // Clear broken image source maybe? Or show placeholder?
                    console.error("Lá»—i táº£i áº£nh:", currentWord.image);
                };
                vocabImage.alt = `HÃ¬nh áº£nh cho ${currentWord.pinyin}`;
                pinyinDisplay.textContent = currentWord.pinyin;
                hanziInput.value = '';
                feedbackPart1.textContent = '';
                feedbackPart1.className = '';
                attemptsLeft = 3;
                attemptsLeftDisplay.textContent = `Sá»‘ láº§n thá»­ cÃ²n láº¡i: ${attemptsLeft}`;
                hanziInput.focus(); // Focus input for convenience
                hanziInput.disabled = false;
                submitPart1.disabled = false;
            }

            function checkVocabAnswer() {
                const userAnswer = hanziInput.value.trim();
                const correctAnswer = shuffledVocab[currentWordIndex].hanzi;

                if (!userAnswer) return; // Do nothing if input is empty

                if (userAnswer === correctAnswer) {
                    updateFeedback(feedbackPart1, 'ChÃ­nh xÃ¡c! ğŸ‘', 'correct');
                    // Only increment score once per word
                    if (hanziInput.disabled === false) { // Check if it wasn't already answered correctly
                       scorePart1++;
                        if (attemptsLeft === 3) { // Count if correct on the very first try
                            part1CorrectFirstTry++;
                        }
                    }

                    hanziInput.disabled = true; // Disable input after correct answer
                    submitPart1.disabled = true; // Disable button
                    setTimeout(() => { // Wait a moment before next question
                        currentWordIndex++;
                        loadVocabQuestion();
                    }, 1200);
                } else {
                    attemptsLeft--;
                    attemptsLeftDisplay.textContent = `Sá»‘ láº§n thá»­ cÃ²n láº¡i: ${attemptsLeft}`;
                    if (attemptsLeft > 0) {
                        updateFeedback(feedbackPart1, `Sai rá»“i, thá»­ láº¡i nhÃ©.`, 'incorrect');
                        hanziInput.select(); // Select text for easy retyping
                    } else {
                        part1Revealed++; // Count revealed answers
                        updateFeedback(feedbackPart1, `Háº¿t lÆ°á»£t rá»“i! ÄÃ¡p Ã¡n Ä‘Ãºng lÃ : ${correctAnswer}`, 'info');
                        hanziInput.disabled = true; // Disable input after failing
                        submitPart1.disabled = true; // Disable button
                        attemptsLeftDisplay.textContent = 'Sá»‘ láº§n thá»­ cÃ²n láº¡i: 0';
                        setTimeout(() => { // Wait a moment before next question
                            currentWordIndex++;
                            loadVocabQuestion();
                        }, 2000); // Longer delay to read the answer
                    }
                }
            }

            function startPart2() {
                currentPart = 2;
                hideAllSections();
                part2Area.classList.remove('hidden');
                loadSentenceQuestion();
            }

            function loadSentenceQuestion() {
                if (currentSentenceIndex >= shuffledSentences.length) {
                    showSummary(); // Move to summary if sentences are done
                    return;
                }
                const currentSentence = shuffledSentences[currentSentenceIndex];
                sentenceCounter.textContent = `CÃ¢u ${currentSentenceIndex + 1} / ${shuffledSentences.length}`;
                scrambledSentence.textContent = currentSentence.scrambled;
                sentenceInput.value = '';
                feedbackPart2.textContent = '';
                feedbackPart2.className = '';
                hintDisplay.textContent = ''; // Clear previous hint
                hintDisplay.classList.add('hidden'); // Hide hint area
                hintButton.disabled = false; // Re-enable hint button
                sentenceInput.disabled = false;
                submitPart2.disabled = false;
                sentenceInput.focus();
            }

            function checkSentenceAnswer() {
                 // Normalize answers: remove common punctuation and spaces for comparison
                const normalize = (str) => str.trim().replace(/[ï¼Ÿã€‚ï¼ï¼Œ,\s]/g, '');
                const userAnswer = normalize(sentenceInput.value);
                const correctAnswer = normalize(shuffledSentences[currentSentenceIndex].correct);

                const fullCorrectSentence = shuffledSentences[currentSentenceIndex].correct;
                const pinyin = shuffledSentences[currentSentenceIndex].pinyin;
                const translation = shuffledSentences[currentSentenceIndex].translation;

                if (!userAnswer) return; // Do nothing if input is empty

                if (userAnswer === correctAnswer) {
                    updateFeedback(feedbackPart2, `HoÃ n háº£o! âœ…\n${fullCorrectSentence}\n(${pinyin})\nNghÄ©a: ${translation}`, 'correct');
                     // Only score once per sentence
                    if (sentenceInput.disabled === false) {
                       scorePart2++;
                    }
                    sentenceInput.disabled = true;
                    submitPart2.disabled = true;
                    hintButton.disabled = true;
                    setTimeout(() => {
                        currentSentenceIndex++;
                        loadSentenceQuestion();
                    }, 3000); // Longer delay to read feedback
                } else {
                    updateFeedback(feedbackPart2, 'ChÆ°a Ä‘Ãºng láº¯m, thá»­ láº¡i xem nÃ o hoáº·c dÃ¹ng gá»£i Ã½.', 'incorrect');
                    sentenceInput.select();
                }
            }

            function showHint() {
                if (currentSentenceIndex < shuffledSentences.length) {
                    const currentSentence = shuffledSentences[currentSentenceIndex];
                    // Show Pinyin and Translation in the hint area
                    updateFeedback(hintDisplay, `Gá»£i Ã½ Pinyin: ${currentSentence.pinyin}\nNghÄ©a: ${currentSentence.translation}`, 'info');
                    hintDisplay.classList.remove('hidden'); // Show hint area
                     // Only count hint use once per question
                    if (hintButton.disabled === false) {
                       hintsUsed++;
                    }
                    hintButton.disabled = true; // Disable after one use per question
                }
            }

            function showSummary() {
                currentPart = 3;
                hideAllSections();
                summaryArea.classList.remove('hidden');

                summaryP1Total.textContent = shuffledVocab.length;
                summaryP1Correct.textContent = scorePart1;
                summaryP1Notes.textContent = `ÄÃºng láº§n Ä‘áº§u: ${part1CorrectFirstTry}, Hiá»‡n Ä‘Ã¡p Ã¡n: ${part1Revealed}`;

                summaryP2Total.textContent = shuffledSentences.length;
                summaryP2Correct.textContent = scorePart2;
                summaryP2Notes.textContent = `Sá»­ dá»¥ng gá»£i Ã½: ${hintsUsed} láº§n`;
            }


            // --- Event Listeners ---
            startButton.addEventListener('click', startGame);
            submitPart1.addEventListener('click', checkVocabAnswer);
            // Allow pressing Enter in input field for Part 1
            hanziInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !submitPart1.disabled) { // Check if button is enabled
                    e.preventDefault(); // Prevent default form submission if wrapped in form
                    checkVocabAnswer();
                }
            });

            submitPart2.addEventListener('click', checkSentenceAnswer);
            // Allow pressing Enter in input field for Part 2
            sentenceInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !submitPart2.disabled) { // Check if button is enabled
                    e.preventDefault(); // Prevent default form submission
                    checkSentenceAnswer();
                }
            });
            hintButton.addEventListener('click', showHint);
            restartButton.addEventListener('click', startGame); // Restart button calls startGame again

        });
    </script>
    </body>
</html>