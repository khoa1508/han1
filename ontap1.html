<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã”n Táº­p Tiáº¿ng Trung Vui Nhá»™n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nunito:wght@700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff;
        }
        .nunito {
            font-family: 'Nunito', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 24px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05), 0 6px 6px rgba(0,0,0,0.07);
        }
        .btn {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .option-btn, .input-field {
            border: 2px solid #e5e7eb;
        }
        .feedback-correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }
        .feedback-incorrect {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        .btn:disabled, .input-field:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        #summary-screen .wrong-answer-card {
            background-color: #fff1f2;
            border-left: 4px solid #f43f5e;
        }
        .badge {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-3xl mx-auto">
        <!-- MÃ n hÃ¬nh báº¯t Ä‘áº§u -->
        <div id="start-screen" class="card text-center p-8 md:p-12">
            <h1 class="text-4xl md:text-5xl font-bold text-sky-600 nunito">Ã”n Táº­p Tiáº¿ng Trung ğŸ¼</h1>
            <p class="mt-4 text-lg text-gray-600">Sáºµn sÃ ng cho má»™t thá»­ thÃ¡ch toÃ n diá»‡n chÆ°a? CÃ¹ng lÃ m tráº¯c nghiá»‡m, Ä‘iá»n tá»« vÃ  viáº¿t vÄƒn Ä‘á»ƒ nháº­n huy hiá»‡u Ä‘Ã¡ng yÃªu nhÃ©! âœ¨</p>
            <div class="text-5xl mt-6">ğŸ‰ğŸ“ğŸš€</div>
            <button id="start-btn" class="btn mt-8 w-full md:w-auto bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-10 rounded-full text-xl">
                Báº¯t Ä‘áº§u ngay!
            </button>
        </div>

        <!-- MÃ n hÃ¬nh cÃ¢u há»i tráº¯c nghiá»‡m/Ä‘iá»n tá»« -->
        <div id="quiz-screen" class="hidden">
            <div class="card p-6 md:p-8">
                <!-- Header -->
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <div class="text-lg font-semibold text-gray-700">
                        CÃ¢u há»i <span id="question-number" class="font-bold text-sky-600">1</span> / <span id="total-questions">10</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2 bg-yellow-100 text-yellow-800 font-bold px-4 py-2 rounded-full"><span>â­</span> <span id="score">0</span></div>
                        <div class="flex items-center gap-2 bg-blue-100 text-blue-800 font-bold px-4 py-2 rounded-full"><span>â±ï¸</span> <span id="timer">00:00</span></div>
                    </div>
                </div>
                <!-- Ná»™i dung cÃ¢u há»i -->
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 text-center"></h2>
                </div>
                <!-- Khu vá»±c tráº£ lá»i -->
                <div id="answer-area" class="mt-6"></div>
                <div id="feedback-area" class="mt-4 text-center font-semibold hidden"></div>
                <!-- Äiá»u hÆ°á»›ng -->
                <div class="mt-8 flex flex-col md:flex-row items-center justify-between gap-4">
                    <button id="hint-btn" class="btn bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-full flex items-center gap-2"><span>ğŸ’¡</span> Gá»£i Ã½</button>
                    <button id="next-btn" class="btn w-full md:w-auto bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-10 rounded-full text-lg hidden">CÃ¢u tiáº¿p theo</button>
                </div>
                <div id="hint-box" class="mt-4 p-4 bg-amber-100 text-amber-800 rounded-lg text-center hidden"><p id="hint-text"></p></div>
            </div>
        </div>

        <!-- MÃ n hÃ¬nh tá»•ng káº¿t tráº¯c nghiá»‡m -->
        <div id="summary-screen" class="hidden">
             <div class="card text-center p-8 md:p-12">
                <h1 class="text-4xl md:text-5xl font-bold text-green-600 nunito">HoÃ n thÃ nh tráº¯c nghiá»‡m! ğŸ¥³</h1>
                <p class="mt-3 text-lg text-gray-600">Báº¡n Ä‘Ã£ lÃ m ráº¥t tá»‘t pháº§n Ä‘áº§u! CÃ¹ng xem káº¿t quáº£ vÃ  chuáº©n bá»‹ cho pháº§n viáº¿t nhÃ©.</p>
                <div id="badge-container" class="my-6"></div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-lg my-8">
                    <div class="bg-blue-100 p-4 rounded-xl"><div class="font-bold text-blue-800">Tá»•ng thá»i gian</div><div id="summary-time" class="text-2xl font-extrabold text-blue-600"></div></div>
                    <div class="bg-green-100 p-4 rounded-xl"><div class="font-bold text-green-800">Sá»‘ cÃ¢u Ä‘Ãºng</div><div id="summary-correct" class="text-2xl font-extrabold text-green-600"></div></div>
                    <div class="bg-red-100 p-4 rounded-xl"><div class="font-bold text-red-800">Sá»‘ cÃ¢u sai</div><div id="summary-incorrect" class="text-2xl font-extrabold text-red-600"></div></div>
                </div>
                <div id="wrong-answers-container" class="mt-6 text-left"></div>
                <div class="flex flex-col md:flex-row gap-4 justify-center mt-8">
                    <button id="restart-quiz-btn" class="btn w-full md:w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full text-xl">LÃ m láº¡i tráº¯c nghiá»‡m</button>
                    <button id="writing-section-btn" class="btn w-full md:w-auto bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-full text-xl">Tiáº¿p tá»¥c pháº§n Viáº¿t âœï¸</button>
                </div>
            </div>
        </div>
        
        <!-- MÃ n hÃ¬nh Viáº¿t -->
        <div id="writing-screen" class="hidden">
            <div class="card p-6 md:p-8">
                <h1 class="text-3xl font-bold text-sky-600 nunito text-center">Pháº§n Tá»± Luáº­n</h1>
                <p class="text-center text-gray-600 mt-2">HÃ£y thá»ƒ hiá»‡n kháº£ nÄƒng viáº¿t cá»§a báº¡n nhÃ©. Sau khi hoÃ n thÃ nh, hÃ£y lÆ°u bÃ i lÃ m láº¡i.</p>
                <div id="writing-tasks-container" class="mt-6 space-y-8">
                    <!-- CÃ¡c bÃ i táº­p viáº¿t sáº½ Ä‘Æ°á»£c thÃªm vÃ o Ä‘Ã¢y -->
                </div>
                <div class="mt-8 text-center">
                    <button id="save-pdf-btn" class="btn w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-10 rounded-full text-xl">
                        LÆ°u bÃ i lÃ m (PDF)
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- Dá»¯ liá»‡u ---
        const quizData = [
            {
                type: 'I',
                questionType: 'input',
                question: "Viáº¿t phiÃªn Ã¢m vÃ  HÃ¡n tá»± cho 'du há»c sinh':",
                answer: ["ç•™å­¦ç”Ÿ", "liÃºxuÃ©shÄ“ng", "ç•™å­¦ç”ŸliÃºxuÃ©shÄ“ng", "ç•™å­¦ç”Ÿ (liÃºxuÃ©shÄ“ng)"],
                hint: "Tá»« nÃ y cÃ³ nghÄ©a lÃ  'há»c sinh á»Ÿ láº¡i há»c'."
            },
            {
                type: 'I',
                questionType: 'input',
                question: "Viáº¿t phiÃªn Ã¢m vÃ  HÃ¡n tá»± cho 'phÃ²ng há»c':",
                answer: ["æ•™å®¤", "jiÃ oshÃ¬", "æ•™å®¤jiÃ oshÃ¬", "æ•™å®¤ (jiÃ oshÃ¬)"],
                hint: "Tá»« nÃ y cÃ³ nghÄ©a lÃ  'phÃ²ng Ä‘á»ƒ dáº¡y há»c'."
            },
            {
                type: 'III',
                questionType: 'mcq',
                question: "Biáº¿n Ä‘á»•i cÃ¢u sau thÃ nh cÃ¢u nghi váº¥n: 'ç›ä¸½çš„æ±‰è¯­ç­æœ‰å…«ä¸ªå¤–å›½åŒå­¦ã€‚'",
                options: ["ç›ä¸½çš„æ±‰è¯­ç­æœ‰å¤šå°‘ä¸ªå¤–å›½åŒå­¦ï¼Ÿ", "ç›ä¸½çš„æ±‰è¯­ç­æœ‰ä»€ä¹ˆå¤–å›½åŒå­¦ï¼Ÿ", "è°çš„æ±‰è¯­ç­æœ‰å…«ä¸ªå¤–å›½åŒå­¦ï¼Ÿ", "ç›ä¸½çš„æ±‰è¯­ç­æœ‰å¤–å›½åŒå­¦å—ï¼Ÿ"],
                answer: "ç›ä¸½çš„æ±‰è¯­ç­æœ‰å¤šå°‘ä¸ªå¤–å›½åŒå­¦ï¼Ÿ",
                hint: "Sá»­ dá»¥ng 'å¤šå°‘' Ä‘á»ƒ há»i vá» sá»‘ lÆ°á»£ng lá»›n hÆ¡n 10."
            },
            {
                type: 'III',
                questionType: 'mcq',
                question: "Biáº¿n Ä‘á»•i cÃ¢u sau thÃ nh cÃ¢u nghi váº¥n: 'å¼ è€å¸ˆåœ¨æ–‡éƒå¤§å­¦æ•™æ±‰è¯­ã€‚'",
                options: ["å¼ è€å¸ˆåœ¨å“ªå„¿æ•™æ±‰è¯­ï¼Ÿ", "å¼ è€å¸ˆæ•™ä»€ä¹ˆï¼Ÿ", "è°åœ¨æ–‡éƒå¤§å­¦æ•™æ±‰è¯­ï¼Ÿ", "Cáº£ 3 cÃ¢u trÃªn Ä‘á»u Ä‘Ãºng"],
                answer: "Cáº£ 3 cÃ¢u trÃªn Ä‘á»u Ä‘Ãºng",
                hint: "CÃ³ thá»ƒ há»i vá» 'ai', 'á»Ÿ Ä‘Ã¢u', hoáº·c 'cÃ¡i gÃ¬' tá»« cÃ¢u gá»‘c."
            },
            {
                type: 'IV',
                questionType: 'input',
                question: "Viáº¿t láº¡i cÃ¢u sau cho Ä‘Ãºng: 'æ˜å¤©æœ‰äº”ä½æ–°å­¦ç”Ÿæ¥æˆ‘ä»¬ç­ä¹Ÿå­¦ä¹ æ±‰è¯­ã€‚'",
                answer: ["æ˜å¤©æœ‰äº”ä½æ–°å­¦ç”Ÿä¹Ÿæ¥æˆ‘ä»¬ç­å­¦ä¹ æ±‰è¯­ã€‚"],
                hint: "Tráº¡ng tá»« 'ä¹Ÿ' thÆ°á»ng Ä‘á»©ng ngay trÆ°á»›c Ä‘á»™ng tá»«."
            },
            {
                type: 'IV',
                questionType: 'input',
                question: "Sá»­a láº¡i pháº§n gáº¡ch chÃ¢n cho Ä‘Ãºng: 'æˆ‘ä»‹ç»ä¸€ä¸‹ï¼Œè¿™ä½æ˜¯ç›ä¸½çš„ç”·æœ‹å‹ï¼Œä»–æ˜¯<underline>å›½å¤–äºº</underline>ã€‚'",
                answer: ["å¤–å›½äºº"],
                hint: "'NgÆ°á»i nÆ°á»›c ngoÃ i' trong tiáº¿ng Trung nÃ³i nhÆ° tháº¿ nÃ o nhá»‰?"
            }
        ];

        const writingData = [
            {
                title: "II. Äáº·t cÃ¢u vá»›i cÃ¡c tá»« sau:",
                prompts: ["æ”¯", "æ•™", "æ—§", "è®¤è¯†", "èº«ä½“", "æ¥", "ä»‹ç»", "ç©å„¿"]
            },
            {
                title: "V. Viáº¿t má»™t Ä‘oáº¡n vÄƒn",
                prompts: ["Giá»›i thiá»‡u vá» tÃ¬nh hÃ¬nh báº£n thÃ¢n, báº¡n bÃ¨, gia Ä‘Ã¬nh, sá»Ÿ thÃ­ch cá»§a mÃ¬nh. Sá»­ dá»¥ng cÃ¡c tá»« sau: ä½åœ¨ï¼Œå­¦æ ¡ï¼Œå–œæ¬¢ï¼Œè§‰å¾—ï¼Œå®¹æ˜“ï¼Œå¤šï¼Œå°‘"]
            }
        ];

        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const summaryScreen = document.getElementById('summary-screen');
        const writingScreen = document.getElementById('writing-screen');
        
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const hintBtn = document.getElementById('hint-btn');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');
        const writingSectionBtn = document.getElementById('writing-section-btn');
        const savePdfBtn = document.getElementById('save-pdf-btn');

        const questionNumberEl = document.getElementById('question-number');
        const totalQuestionsEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const timerEl = document.getElementById('timer');
        const questionTextEl = document.getElementById('question-text');
        const answerArea = document.getElementById('answer-area');
        const feedbackArea = document.getElementById('feedback-area');
        const hintBox = document.getElementById('hint-box');
        const hintTextEl = document.getElementById('hint-text');

        // --- Game State ---
        let currentQuestionIndex = 0;
        let score = 0;
        let timerInterval;
        let secondsElapsed = 0;
        let wrongAnswers = [];

        // --- Functions ---
        function startTimer() {
            secondsElapsed = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                secondsElapsed++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
            const seconds = (secondsElapsed % 60).toString().padStart(2, '0');
            timerEl.textContent = `${minutes}:${seconds}`;
        }

        function startQuiz() {
            startScreen.classList.add('hidden');
            writingScreen.classList.add('hidden');
            summaryScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            currentQuestionIndex = 0;
            score = 0;
            wrongAnswers = [];
            scoreEl.textContent = score;
            totalQuestionsEl.textContent = quizData.length;
            
            startTimer();
            showQuestion();
        }

        function showQuestion() {
            // Reset UI
            nextBtn.classList.add('hidden');
            hintBox.classList.add('hidden');
            feedbackArea.classList.add('hidden');
            answerArea.innerHTML = '';

            const questionData = quizData[currentQuestionIndex];
            questionNumberEl.textContent = currentQuestionIndex + 1;
            questionTextEl.innerHTML = questionData.question.replace('<underline>', '<span class="underline decoration-wavy decoration-red-500">');
            hintTextEl.textContent = questionData.hint;

            if (questionData.questionType === 'mcq') {
                const optionsGrid = document.createElement('div');
                optionsGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
                questionData.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = 'option-btn btn w-full p-4 rounded-lg text-lg text-left font-semibold';
                    button.onclick = () => selectMCQAnswer(button, option, questionData.answer);
                    optionsGrid.appendChild(button);
                });
                answerArea.appendChild(optionsGrid);
            } else if (questionData.questionType === 'input') {
                const inputContainer = document.createElement('div');
                inputContainer.className = 'flex flex-col sm:flex-row gap-4 items-center';
                const inputField = document.createElement('input');
                inputField.type = 'text';
                inputField.id = 'text-answer-input';
                inputField.className = 'input-field w-full p-4 rounded-lg text-lg font-semibold';
                inputField.placeholder = 'Nháº­p cÃ¢u tráº£ lá»i cá»§a báº¡n...';
                
                const checkBtn = document.createElement('button');
                checkBtn.textContent = 'Kiá»ƒm tra';
                checkBtn.className = 'btn bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-full text-lg w-full sm:w-auto';
                checkBtn.onclick = () => checkInputAction(inputField, checkBtn, questionData.answer);
                
                inputContainer.appendChild(inputField);
                inputContainer.appendChild(checkBtn);
                answerArea.appendChild(inputContainer);
                inputField.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        checkBtn.click();
                    }
                });
            }
        }

        function selectMCQAnswer(button, selectedOption, correctAnswer) {
            const isCorrect = selectedOption === correctAnswer;
            processAnswer(isCorrect, selectedOption, correctAnswer);
            
            const parent = button.parentElement;
            Array.from(parent.children).forEach(btn => {
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('feedback-correct');
                }
                btn.disabled = true;
            });
        }

        function checkInputAction(inputField, checkBtn, correctAnswers) {
            const userAnswer = inputField.value.trim().replace(/[\s()]/g, ''); // Normalize user answer
            const isCorrect = correctAnswers.some(ans => {
                const normalizedCorrectAns = ans.trim().replace(/[\s()]/g, ''); // Normalize correct answer
                return userAnswer.toLowerCase() === normalizedCorrectAns.toLowerCase();
            });
            
            processAnswer(isCorrect, inputField.value, correctAnswers[0]);
            inputField.disabled = true;
            checkBtn.disabled = true;
        }

        function processAnswer(isCorrect, userAnswer, correctAnswer) {
            feedbackArea.classList.remove('hidden');
            if (isCorrect) {
                score += 10;
                scoreEl.textContent = score;
                feedbackArea.textContent = 'ChÃ­nh xÃ¡c! ğŸ‰';
                feedbackArea.className = 'mt-4 text-center font-semibold p-3 rounded-lg feedback-correct';
            } else {
                feedbackArea.innerHTML = `ChÆ°a Ä‘Ãºng rá»“i! ÄÃ¡p Ã¡n Ä‘Ãºng lÃ : <strong class="block mt-1">${correctAnswer}</strong>`;
                feedbackArea.className = 'mt-4 text-center font-semibold p-3 rounded-lg feedback-incorrect';
                wrongAnswers.push({
                    question: quizData[currentQuestionIndex].question,
                    yourAnswer: userAnswer,
                    correctAnswer: correctAnswer
                });
            }
            nextBtn.classList.remove('hidden');
        }
        
        function showNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                showQuestion();
            } else {
                showSummary();
            }
        }

        function showHint() {
            hintBox.classList.toggle('hidden');
        }

        function showSummary() {
            stopTimer();
            quizScreen.classList.add('hidden');
            summaryScreen.classList.remove('hidden');

            const correctCount = (score / 10);
            const incorrectCount = wrongAnswers.length;

            document.getElementById('summary-time').textContent = timerEl.textContent;
            document.getElementById('summary-correct').textContent = `${correctCount} / ${quizData.length}`;
            document.getElementById('summary-incorrect').textContent = `${incorrectCount} / ${quizData.length}`;
            
            const badgeContainer = document.getElementById('badge-container');
            const percentage = (correctCount / quizData.length) * 100;
            if (percentage >= 90) badgeContainer.innerHTML = `<div class="text-6xl badge">ğŸ¥‡</div><p class="text-xl font-bold text-amber-500 mt-2">Huy hiá»‡u VÃ ng!</p>`;
            else if (percentage >= 60) badgeContainer.innerHTML = `<div class="text-6xl badge">ğŸ¥ˆ</div><p class="text-xl font-bold text-slate-500 mt-2">Huy hiá»‡u Báº¡c!</p>`;
            else badgeContainer.innerHTML = `<div class="text-6xl badge">ğŸ¥‰</div><p class="text-xl font-bold text-orange-700 mt-2">Huy hiá»‡u Äá»“ng!</p>`;

            const wrongAnswersContainer = document.getElementById('wrong-answers-container');
            wrongAnswersContainer.innerHTML = wrongAnswers.length > 0 ? '<h3 class="text-xl font-bold text-gray-800 mb-4">CÃ¹ng xem láº¡i cÃ¡c cÃ¢u sai nhÃ©:</h3>' : '';
            if (wrongAnswers.length === 0) {
                wrongAnswersContainer.innerHTML += '<p class="text-green-600 font-semibold">Tuyá»‡t vá»i! Báº¡n khÃ´ng sai cÃ¢u nÃ o cáº£! ğŸ‰</p>';
            } else {
                wrongAnswers.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'wrong-answer-card p-4 rounded-lg mb-3';
                    card.innerHTML = `<p class="font-semibold text-gray-700">${item.question}</p><p class="text-sm mt-2"><b>Báº¡n tráº£ lá»i:</b> <span class="text-red-600">${item.yourAnswer}</span></p><p class="text-sm"><b>ÄÃ¡p Ã¡n Ä‘Ãºng:</b> <span class="text-green-600">${item.correctAnswer}</span></p>`;
                    wrongAnswersContainer.appendChild(card);
                });
            }
        }
        
        function showWritingScreen() {
            summaryScreen.classList.add('hidden');
            writingScreen.classList.remove('hidden');
            const container = document.getElementById('writing-tasks-container');
            container.innerHTML = '';

            writingData.forEach((task, taskIndex) => {
                const taskDiv = document.createElement('div');
                taskDiv.innerHTML = `<h2 class="text-xl font-bold text-gray-800">${task.title}</h2>`;
                
                task.prompts.forEach((prompt, promptIndex) => {
                    const promptDiv = document.createElement('div');
                    promptDiv.className = 'mt-4';
                    
                    if (task.title.includes("Äáº·t cÃ¢u")) {
                        promptDiv.innerHTML = `<label for="writing-${taskIndex}-${promptIndex}" class="font-semibold text-gray-700">${promptIndex + 1}) ${prompt}:</label>
                                           <input type="text" id="writing-${taskIndex}-${promptIndex}" class="input-field w-full p-3 rounded-lg mt-1" />`;
                    } else {
                        promptDiv.innerHTML = `<label for="writing-${taskIndex}-${promptIndex}" class="font-semibold text-gray-700">${prompt}</label>
                                           <textarea id="writing-${taskIndex}-${promptIndex}" rows="8" class="input-field w-full p-3 rounded-lg mt-1"></textarea>`;
                    }
                    taskDiv.appendChild(promptDiv);
                });
                container.appendChild(taskDiv);
            });
        }

        function saveWorkAsPDF() {
            let content = `
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>BÃ i lÃ m cá»§a há»c viÃªn</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; line-height: 1.6; padding: 2rem; }
                        h1 { font-size: 1.5rem; border-bottom: 2px solid #333; padding-bottom: 0.5rem; }
                        h2 { font-size: 1.2rem; margin-top: 2rem; }
                        .task { margin-bottom: 1.5rem; }
                        .prompt { font-weight: bold; }
                        .answer { margin-left: 1rem; margin-top: 0.5rem; white-space: pre-wrap; }
                    </style>
                </head>
                <body>
                    <h1>BÃ i lÃ m Tiáº¿ng Trung</h1>
                    <p><strong>Thá»i gian hoÃ n thÃ nh tráº¯c nghiá»‡m:</strong> ${timerEl.textContent}</p>
                    <p><strong>Äiá»ƒm tráº¯c nghiá»‡m:</strong> ${score} / ${quizData.length * 10}</p>
            `;

            writingData.forEach((task, taskIndex) => {
                content += `<div class="task"><h2>${task.title}</h2>`;
                task.prompts.forEach((prompt, promptIndex) => {
                    const element = document.getElementById(`writing-${taskIndex}-${promptIndex}`);
                    if (element) {
                        content += `<div class="prompt">${task.title.includes("Äáº·t cÃ¢u") ? `${promptIndex + 1}) ${prompt}:` : prompt}</div>`;
                        content += `<div class="answer">${element.value || '(ChÆ°a tráº£ lá»i)'}</div>`;
                    }
                });
                content += `</div>`;
            });

            content += `
                    <script>
                        window.onload = function() {
                            document.body.insertAdjacentHTML('afterbegin', '<p style="background: #ffc; padding: 1rem; border: 1px solid #e0a800; border-radius: 5px;">Máº¹o: Sá»­ dá»¥ng chá»©c nÄƒng <b>In</b> cá»§a trÃ¬nh duyá»‡t (phÃ­m táº¯t <b>Ctrl+P</b> hoáº·c <b>Cmd+P</b>) vÃ  chá»n '<b>LÆ°u dÆ°á»›i dáº¡ng PDF</b>' Ä‘á»ƒ táº£i bÃ i lÃ m vá» mÃ¡y.</p>');
                        }
                    <\/script>
                </body>
                </html>
            `;

            const newWindow = window.open();
            newWindow.document.open();
            newWindow.document.write(content);
            newWindow.document.close();
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', startQuiz);
        nextBtn.addEventListener('click', showNextQuestion);
        hintBtn.addEventListener('click', showHint);
        restartQuizBtn.addEventListener('click', startQuiz);
        writingSectionBtn.addEventListener('click', showWritingScreen);
        savePdfBtn.addEventListener('click', saveWorkAsPDF);
    </script>
</body>
</html>
