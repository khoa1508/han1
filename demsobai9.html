<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p ƒê·∫øm S·ªë Ti·∫øng Trung üî¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* Light blue background */
        }
        .exercise-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out;
        }
        .exercise-card:hover {
            transform: translateY(-5px);
        }
        .btn {
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: 500;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #3b82f6; /* Blue-500 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb; /* Blue-600 */
        }
        .btn-secondary {
            background-color: #6b7280; /* Gray-500 */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563; /* Gray-600 */
        }
        .btn-hint {
            background-color: #f59e0b; /* Amber-500 */
            color: white;
        }
        .btn-hint:hover {
            background-color: #d97706; /* Amber-600 */
        }
        .input-hanzi {
            border: 1px solid #d1d5db; /* Gray-300 */
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            font-size: 1.1rem;
        }
        .feedback-correct {
            color: #16a34a; /* Green-600 */
            font-weight: 600;
        }
        .feedback-incorrect {
            color: #dc2626; /* Red-600 */
            font-weight: 600;
        }
        .badge-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; /* 10% from the top and centered */
            padding: 25px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {opacity: 0; transform: scale(0.9);}
            to {opacity: 1; transform: scale(1);}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="text-gray-800 p-4 sm:p-8">
    <div class="container mx-auto max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-600 mb-2">üî¢ Chinh Ph·ª•c C√°c Con S·ªë Ti·∫øng Trung! ÊåëÊàòÊï∞Â≠óÔºÅ</h1>
            <p class="text-lg text-gray-600">Ch√†o c√°c b·∫°n nh·ªè! üëã H√£y c√πng th·ª≠ th√°ch kh·∫£ nƒÉng ƒë·∫øm s·ªë b·∫±ng ch·ªØ H√°n nh√©. ƒêi·ªÅn ƒë√°p √°n v√† xem m√¨nh gi·ªèi ƒë·∫øn ƒë√¢u n√†o! üöÄ</p>
        </header>

        <div id="exercise-container" class="space-y-10">
            </div>

        <div class="mt-12 text-center">
            <button id="finish-exercise-btn" class="btn btn-primary text-xl py-3 px-8">üéâ Ho√†n Th√†nh & Xem K·∫øt Qu·∫£ üéâ</button>
        </div>

        <div id="summary-modal" class="modal">
            <div class="modal-content">
                <span class="close-button" onclick="closeModal()">&times;</span>
                <h2 class="text-3xl font-bold text-center text-blue-600 mb-6">üéâ K·∫øt Qu·∫£ B√†i L√†m üéâ</h2>
                <div id="summary-content" class="space-y-3 text-lg">
                    <p>‚è≥ <strong class="text-gray-700">T·ªïng th·ªùi gian l√†m b√†i:</strong> <span id="total-time" class="font-semibold"></span></p>
                    <p>üéØ <strong class="text-gray-700">T·ªïng s·ªë c√¢u h·ªèi:</strong> <span id="total-questions-summary" class="font-semibold"></span></p>
                    <p>‚úÖ <strong class="text-gray-700">S·ªë c√¢u ƒë√∫ng:</strong> <span id="correct-answers-summary" class="font-semibold text-green-600"></span></p>
                    <p>‚ùå <strong class="text-gray-700">S·ªë c√¢u sai:</strong> <span id="incorrect-answers-summary" class="font-semibold text-red-600"></span></p>
                    
                    <div class="text-center my-6">
                        <div id="badge-icon-summary" class="badge-icon"></div>
                        <p id="badge-name-summary" class="text-2xl font-semibold text-amber-500"></p>
                    </div>

                    <div id="incorrect-questions-list" class="mt-4">
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">Xem l·∫°i c√°c c√¢u sai n√®:</h3>
                        </div>
                </div>
                <div class="mt-8 text-center">
                    <button onclick="closeModal()" class="btn btn-secondary py-2 px-6">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const exercises = [
            // Section 1: Numbers up to 10,000
            { id: 's1q1', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '10', answer: 'ÂçÅ', pinyin: 'sh√≠' },
            { id: 's1q2', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '15', answer: 'ÂçÅ‰∫î', pinyin: 'sh√≠ w«î' },
            { id: 's1q3', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '19', answer: 'ÂçÅ‰πù', pinyin: 'sh√≠ ji«î' },
            { id: 's1q4', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '22', answer: '‰∫åÂçÅ‰∫å', pinyin: '√®r sh√≠ √®r' },
            { id: 's1q5', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '44', answer: 'ÂõõÂçÅÂõõ', pinyin: 's√¨ sh√≠ s√¨' },
            { id: 's1q6', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '58', answer: '‰∫îÂçÅÂÖ´', pinyin: 'w«î sh√≠ bƒÅ' },
            { id: 's1q7', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '97', answer: '‰πùÂçÅ‰∏É', pinyin: 'ji«î sh√≠ qƒ´' },
            { id: 's1q8', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '100', answer: '‰∏ÄÁôæ', pinyin: 'yƒ´ b«éi' },
            { id: 's1q9', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '105', answer: '‰∏ÄÁôæÈõ∂‰∫î', pinyin: 'yƒ´ b«éi l√≠ng w«î' },
            { id: 's1q10', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '238', answer: '‰∫åÁôæ‰∏âÂçÅÂÖ´', pinyin: '√®r b«éi sƒÅn sh√≠ bƒÅ' },
            { id: 's1q11', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '498', answer: 'ÂõõÁôæ‰πùÂçÅÂÖ´', pinyin: 's√¨ b«éi ji«î sh√≠ bƒÅ' },
            { id: 's1q12', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '999', answer: '‰πùÁôæ‰πùÂçÅ‰πù', pinyin: 'ji«î b«éi ji«î sh√≠ ji«î' },
            { id: 's1q13', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '1076', answer: '‰∏ÄÂçÉÈõ∂‰∏ÉÂçÅÂÖ≠', pinyin: 'yƒ´ qiƒÅn l√≠ng qƒ´ sh√≠ li√π' },
            { id: 's1q14', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '2856', answer: '‰∫åÂçÉÂÖ´Áôæ‰∫îÂçÅÂÖ≠', pinyin: '√®r qiƒÅn bƒÅ b«éi w«î sh√≠ li√π' },
            { id: 's1q15', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '2988', answer: '‰∫åÂçÉ‰πùÁôæÂÖ´ÂçÅÂÖ´', pinyin: '√®r qiƒÅn ji«î b«éi bƒÅ sh√≠ bƒÅ' },
            { id: 's1q16', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '3644', answer: '‰∏âÂçÉÂÖ≠ÁôæÂõõÂçÅÂõõ', pinyin: 'sƒÅn qiƒÅn li√π b«éi s√¨ sh√≠ s√¨' },
            { id: 's1q17', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '8976', answer: 'ÂÖ´ÂçÉ‰πùÁôæ‰∏ÉÂçÅÂÖ≠', pinyin: 'bƒÅ qiƒÅn ji«î b«éi qƒ´ sh√≠ li√π' },
            { id: 's1q18', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '9827', answer: '‰πùÂçÉÂÖ´Áôæ‰∫åÂçÅ‰∏É', pinyin: 'ji«î qiƒÅn bƒÅ b«éi √®r sh√≠ qƒ´' },
            { id: 's1q19', section: 'Âü∫Á°ÄÊï∞Â≠ó (ƒê·∫øn 10,000)', number: '9876', answer: '‰πùÂçÉÂÖ´Áôæ‰∏ÉÂçÅÂÖ≠', pinyin: 'ji«î qiƒÅn bƒÅ b«éi qƒ´ sh√≠ li√π' },

            { id: 's2q1', section: '‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Ngh√¨n)', number: '10000', answer: '‰∏Ä‰∏á', pinyin: 'yƒ´ w√†n' },
            { id: 's2q2', section: '‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Ngh√¨n)', number: '15049', answer: '‰∏Ä‰∏á‰∫îÂçÉÈõ∂ÂõõÂçÅ‰πù', pinyin: 'yƒ´ w√†n w«î qiƒÅn l√≠ng s√¨ sh√≠ ji«î' },
            { id: 's2q3', section: '‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Ngh√¨n)', number: '23475', answer: '‰∫å‰∏á‰∏âÂçÉÂõõÁôæ‰∏ÉÂçÅ‰∫î', pinyin: '√®r w√†n sƒÅn qiƒÅn s√¨ b«éi qƒ´ sh√≠ w«î' },
            { id: 's2q4', section: '‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Ngh√¨n)', number: '87654', answer: 'ÂÖ´‰∏á‰∏ÉÂçÉÂÖ≠Áôæ‰∫îÂçÅÂõõ', pinyin: 'bƒÅ w√†n qƒ´ qiƒÅn li√π b«éi w«î sh√≠ s√¨' },
            { id: 's2q5', section: '‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Ngh√¨n)', number: '99887', answer: '‰πù‰∏á‰πùÂçÉÂÖ´ÁôæÂÖ´ÂçÅ‰∏É', pinyin: 'ji«î w√†n ji«î qiƒÅn bƒÅ b«éi bƒÅ sh√≠ qƒ´' },

            { id: 's3q1', section: 'ÂçÅ‰∏á‰ΩçÊï∞Â≠ó (TrƒÉm Ngh√¨n)', number: '100000', answer: 'ÂçÅ‰∏á', pinyin: 'sh√≠ w√†n' },
            { id: 's3q2', section: 'ÂçÅ‰∏á‰ΩçÊï∞Â≠ó (TrƒÉm Ngh√¨n)', number: '120985', answer: 'ÂçÅ‰∫å‰∏áÈõ∂‰πùÁôæÂÖ´ÂçÅ‰∫î', pinyin: 'sh√≠ √®r w√†n l√≠ng ji«î b«éi bƒÅ sh√≠ w«î' },
            { id: 's3q3', section: 'ÂçÅ‰∏á‰ΩçÊï∞Â≠ó (TrƒÉm Ngh√¨n)', number: '215124', answer: '‰∫åÂçÅ‰∏Ä‰∏á‰∫îÂçÉ‰∏ÄÁôæ‰∫åÂçÅÂõõ', pinyin: '√®r sh√≠ yƒ´ w√†n w«î qiƒÅn yƒ´ b«éi √®r sh√≠ s√¨' },
            { id: 's3q4', section: 'ÂçÅ‰∏á‰ΩçÊï∞Â≠ó (TrƒÉm Ngh√¨n)', number: '295486', answer: '‰∫åÂçÅ‰πù‰∏á‰∫îÂçÉÂõõÁôæÂÖ´ÂçÅÂÖ≠', pinyin: '√®r sh√≠ ji«î w√†n w«î qiƒÅn s√¨ b«éi bƒÅ sh√≠ li√π' },
            { id: 's3q5', section: 'ÂçÅ‰∏á‰ΩçÊï∞Â≠ó (TrƒÉm Ngh√¨n)', number: '754652', answer: '‰∏ÉÂçÅ‰∫î‰∏áÂõõÂçÉÂÖ≠Áôæ‰∫îÂçÅ‰∫å', pinyin: 'qƒ´ sh√≠ w«î w√†n s√¨ qiƒÅn li√π b«éi w«î sh√≠ √®r' },
            { id: 's3q6', section: 'ÂçÅ‰∏á‰ΩçÊï∞Â≠ó (TrƒÉm Ngh√¨n)', number: '987547', answer: '‰πùÂçÅÂÖ´‰∏á‰∏ÉÂçÉ‰∫îÁôæÂõõÂçÅ‰∏É', pinyin: 'ji«î sh√≠ bƒÅ w√†n qƒ´ qiƒÅn w«î b«éi s√¨ sh√≠ qƒ´' },

            { id: 's4q1', section: 'Áôæ‰∏á‰ΩçÊï∞Â≠ó (Tri·ªáu)', number: '1000000', answer: '‰∏ÄÁôæ‰∏á', pinyin: 'yƒ´ b«éi w√†n' },
            { id: 's4q2', section: 'Áôæ‰∏á‰ΩçÊï∞Â≠ó (Tri·ªáu)', number: '1347865', answer: '‰∏ÄÁôæ‰∏âÂçÅÂõõ‰∏á‰∏ÉÂçÉÂÖ´ÁôæÂÖ≠ÂçÅ‰∫î', pinyin: 'yƒ´ b«éi sƒÅn sh√≠ s√¨ w√†n qƒ´ qiƒÅn bƒÅ b«éi li√π sh√≠ w«î' },
            { id: 's4q3', section: 'Áôæ‰∏á‰ΩçÊï∞Â≠ó (Tri·ªáu)', number: '2542753', answer: '‰∫åÁôæ‰∫îÂçÅÂõõ‰∏á‰∫åÂçÉ‰∏ÉÁôæ‰∫îÂçÅ‰∏â', pinyin: '√®r b«éi w«î sh√≠ s√¨ w√†n √®r qiƒÅn qƒ´ b«éi w«î sh√≠ sƒÅn' },
            { id: 's4q4', section: 'Áôæ‰∏á‰ΩçÊï∞Â≠ó (Tri·ªáu)', number: '3125853', answer: '‰∏âÁôæ‰∏ÄÂçÅ‰∫å‰∏á‰∫îÂçÉÂÖ´Áôæ‰∫îÂçÅ‰∏â', pinyin: 'sƒÅn b«éi yƒ´ sh√≠ √®r w√†n w«î qiƒÅn bƒÅ b«éi w«î sh√≠ sƒÅn' },
            { id: 's4q5', section: 'Áôæ‰∏á‰ΩçÊï∞Â≠ó (Tri·ªáu)', number: '6235789', answer: 'ÂÖ≠Áôæ‰∫åÂçÅ‰∏â‰∏á‰∫îÂçÉ‰∏ÉÁôæÂÖ´ÂçÅ‰πù', pinyin: 'li√π b«éi √®r sh√≠ sƒÅn w√†n w«î qiƒÅn qƒ´ b«éi bƒÅ sh√≠ ji«î' },
            { id: 's4q6', section: 'Áôæ‰∏á‰ΩçÊï∞Â≠ó (Tri·ªáu)', number: '9321264', answer: '‰πùÁôæ‰∏âÂçÅ‰∫å‰∏á‰∏ÄÂçÉ‰∫åÁôæÂÖ≠ÂçÅÂõõ', pinyin: 'ji«î b«éi sƒÅn sh√≠ √®r w√†n yƒ´ qiƒÅn √®r b«éi li√π sh√≠ s√¨' },

            { id: 's5q1', section: 'ÂçÉ‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Tri·ªáu)', number: '10000000', answer: '‰∏ÄÂçÉ‰∏á', pinyin: 'yƒ´ qiƒÅn w√†n' },
            { id: 's5q2', section: 'ÂçÉ‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Tri·ªáu)', number: '15205202', answer: '‰∏ÄÂçÉ‰∫îÁôæ‰∫åÂçÅ‰∏á‰∫îÂçÉ‰∫åÁôæÈõ∂‰∫å', pinyin: 'yƒ´ qiƒÅn w«î b«éi √®r sh√≠ w√†n w«î qiƒÅn √®r b«éi l√≠ng √®r' },
            { id: 's5q3', section: 'ÂçÉ‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Tri·ªáu)', number: '17232796', answer: '‰∏ÄÂçÉ‰∏ÉÁôæ‰∫åÂçÅ‰∏â‰∏á‰∫åÂçÉ‰∏ÉÁôæ‰πùÂçÅÂÖ≠', pinyin: 'yƒ´ qiƒÅn qƒ´ b«éi √®r sh√≠ sƒÅn w√†n √®r qiƒÅn qƒ´ b«éi ji«î sh√≠ li√π' },
            { id: 's5q4', section: 'ÂçÉ‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Tri·ªáu)', number: '18265321', answer: '‰∏ÄÂçÉÂÖ´Áôæ‰∫åÂçÅÂÖ≠‰∏á‰∫îÂçÉ‰∏âÁôæ‰∫åÂçÅ‰∏Ä', pinyin: 'yƒ´ qiƒÅn bƒÅ b«éi √®r sh√≠ li√π w√†n w«î qiƒÅn sƒÅn b«éi √®r sh√≠ yƒ´' },
            { id: 's5q5', section: 'ÂçÉ‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Tri·ªáu)', number: '87169264', answer: 'ÂÖ´ÂçÉ‰∏ÉÁôæ‰∏ÄÂçÅÂÖ≠‰∏á‰πùÂçÉ‰∫åÁôæÂÖ≠ÂçÅÂõõ', pinyin: 'bƒÅ qiƒÅn qƒ´ b«éi yƒ´ sh√≠ li√π w√†n ji«î qiƒÅn √®r b«éi li√π sh√≠ s√¨' },
            { id: 's5q6', section: 'ÂçÉ‰∏á‰ΩçÊï∞Â≠ó (Ch·ª•c Tri·ªáu)', number: '91125386', answer: '‰πùÂçÉ‰∏ÄÁôæ‰∏ÄÂçÅ‰∫å‰∏á‰∫îÂçÉ‰∏âÁôæÂÖ´ÂçÅÂÖ≠', pinyin: 'ji«î qiƒÅn yƒ´ b«éi yƒ´ sh√≠ √®r w√†n w«î qiƒÅn sƒÅn b«éi bƒÅ sh√≠ li√π' }
        ];

        const exerciseContainer = document.getElementById('exercise-container');
        const userAnswers = new Map(); // To store user's answers and status {isCorrect: boolean, userAnswer: string}
        let startTime;
        let timerInterval;

        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000); // Update timer every second
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }
        
        function updateTimer() {
            // This function can be used to display a live timer if needed.
            // For now, we just calculate total time at the end.
        }

        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes} ph√∫t ${seconds} gi√¢y`;
        }

        function loadExercises() {
            startTimer();
            const groupedExercises = exercises.reduce((acc, ex) => {
                if (!acc[ex.section]) {
                    acc[ex.section] = [];
                }
                acc[ex.section].push(ex);
                return acc;
            }, {});

            for (const sectionTitle in groupedExercises) {
                const sectionDiv = document.createElement('div');
                sectionDiv.innerHTML = `<h2 class="text-2xl font-semibold text-sky-700 mb-4">${sectionTitle} üåü</h2>`;
                
                const gridDiv = document.createElement('div');
                gridDiv.className = 'grid grid-cols-1 md:grid-cols-2 gap-6';

                groupedExercises[sectionTitle].forEach((ex, index) => {
                    const card = document.createElement('div');
                    card.className = 'exercise-card p-5';
                    card.innerHTML = `
                        <p class="text-lg font-medium mb-1">C√¢u ${index + 1}:</p>
                        <p class="text-2xl font-bold text-indigo-600 mb-3">S·ªë: ${ex.number.replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</p>
                        <input type="text" id="input-${ex.id}" class="input-hanzi mb-3" placeholder="‚úèÔ∏è Nh·∫≠p ch·ªØ H√°n...">
                        <div class="flex flex-wrap gap-2 mb-3">
                            <button onclick="showHint('${ex.id}')" class="btn btn-hint text-sm">üí° G·ª£i √Ω</button>
                            <button onclick="checkAnswer('${ex.id}')" class="btn btn-secondary text-sm">‚úîÔ∏è Ki·ªÉm tra</button>
                        </div>
                        <p id="feedback-${ex.id}" class="text-sm min-h-[20px]"></p>
                        <p id="pinyin-${ex.id}" class="text-sm text-gray-500 min-h-[20px]"></p>
                    `;
                    gridDiv.appendChild(card);
                });
                sectionDiv.appendChild(gridDiv);
                exerciseContainer.appendChild(sectionDiv);
            }
        }

        window.showHint = (exerciseId) => {
            const exercise = exercises.find(ex => ex.id === exerciseId);
            const feedbackEl = document.getElementById(`feedback-${exerciseId}`);
            if (exercise) {
                feedbackEl.textContent = `G·ª£i √Ω: ƒê√°p √°n b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ "${exercise.answer[0]}" üòâ`;
                feedbackEl.className = 'text-sm text-amber-600';
            }
        }

        window.checkAnswer = (exerciseId) => {
            const exercise = exercises.find(ex => ex.id === exerciseId);
            const inputEl = document.getElementById(`input-${exerciseId}`);
            const feedbackEl = document.getElementById(`feedback-${exerciseId}`);
            const pinyinEl = document.getElementById(`pinyin-${exerciseId}`);
            const userAnswer = inputEl.value.trim();

            if (!exercise || !inputEl || !feedbackEl) return;

            if (userAnswer === "") {
                feedbackEl.textContent = "ü§î B·∫°n ch∆∞a nh·∫≠p c√¢u tr·∫£ l·ªùi!";
                feedbackEl.className = 'text-sm text-yellow-500';
                pinyinEl.textContent = '';
                return;
            }
            
            // Normalize answers: remove spaces, convert to a consistent form if needed (e.g. for ‰∏§/‰∫å)
            // For this example, direct comparison is used. More complex normalization might be needed.
            // For example, accepting both ‰∫åÁôæ‰∏âÂçÅÂÖ´ and ‰∏§Áôæ‰∏âÂçÅÂÖ´ for 238.
            // For simplicity, we'll stick to the defined answer.
            const isCorrect = userAnswer === exercise.answer;

            userAnswers.set(exercise.id, { 
                isCorrect: isCorrect, 
                userAnswer: userAnswer,
                correctAnswer: exercise.answer,
                number: exercise.number,
                pinyin: exercise.pinyin
            });

            if (isCorrect) {
                feedbackEl.textContent = "üéâ Ch√≠nh x√°c! Gi·ªèi qu√°!";
                feedbackEl.className = 'feedback-correct text-sm';
                pinyinEl.textContent = `Pinyin: ${exercise.pinyin}`;
                inputEl.disabled = true; // Disable input after correct answer
                inputEl.classList.add('bg-green-50', 'border-green-300');
                // Disable buttons for this question
                const hintButton = inputEl.parentElement.querySelector('.btn-hint');
                const checkButton = inputEl.parentElement.querySelector('.btn-secondary');
                if(hintButton) hintButton.disabled = true;
                if(checkButton) checkButton.disabled = true;

            } else {
                feedbackEl.textContent = `üòï Ch∆∞a ƒë√∫ng r·ªìi. Th·ª≠ l·∫°i xem! G·ª£i √Ω: ${exercise.answer[0]}...`;
                feedbackEl.className = 'feedback-incorrect text-sm';
                pinyinEl.textContent = '';
                inputEl.classList.add('border-red-300');
            }
        }
        
        document.getElementById('finish-exercise-btn').addEventListener('click', showSummary);

        function showSummary() {
            stopTimer();
            const totalTime = new Date() - startTime;
            let correctCount = 0;
            const incorrectQuestions = [];

            exercises.forEach(ex => {
                const userAnswerData = userAnswers.get(ex.id);
                if (userAnswerData && userAnswerData.isCorrect) {
                    correctCount++;
                } else if (userAnswerData && !userAnswerData.isCorrect) {
                    incorrectQuestions.push({
                        number: ex.number,
                        userAnswer: userAnswerData.userAnswer,
                        correctAnswer: ex.answer,
                        pinyin: ex.pinyin
                    });
                } else { // Question not attempted or only hint viewed
                     incorrectQuestions.push({
                        number: ex.number,
                        userAnswer: "Ch∆∞a tr·∫£ l·ªùi",
                        correctAnswer: ex.answer,
                        pinyin: ex.pinyin
                    });
                }
            });
            
            const totalQuestions = exercises.length;
            const incorrectCount = totalQuestions - correctCount; // All non-correct answers are considered incorrect for summary
            const scorePercentage = totalQuestions > 0 ? (correctCount / totalQuestions) * 100 : 0;

            document.getElementById('total-time').textContent = formatTime(totalTime);
            document.getElementById('total-questions-summary').textContent = totalQuestions;
            document.getElementById('correct-answers-summary').textContent = `${correctCount} (${scorePercentage.toFixed(1)}%)`;
            document.getElementById('incorrect-answers-summary').textContent = incorrectCount;

            const incorrectListEl = document.getElementById('incorrect-questions-list');
            incorrectListEl.innerHTML = '<h3 class="text-xl font-semibold mb-2 text-gray-700">Xem l·∫°i c√°c c√¢u sai ho·∫∑c ch∆∞a tr·∫£ l·ªùi n√®:</h3>';
            if (incorrectQuestions.length > 0) {
                const ul = document.createElement('ul');
                ul.className = 'list-disc pl-5 space-y-1 text-sm';
                incorrectQuestions.forEach(q => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>S·ªë ${q.number.replace(/\B(?=(\d{3})+(?!\d))/g, ",")}:</strong> B·∫°n vi·∫øt: <span class="text-red-500">${q.userAnswer}</span>. ƒê√°p √°n ƒë√∫ng: <strong class="text-green-500">${q.correctAnswer}</strong> (<em>${q.pinyin}</em>)`;
                    ul.appendChild(li);
                });
                incorrectListEl.appendChild(ul);
            } else {
                incorrectListEl.innerHTML += '<p class="text-green-600">üéâ Yay! B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng h·∫øt t·∫•t c·∫£ c√°c c√¢u! Si√™u qu√°!</p>';
            }

            // Badge logic
            const badgeIconEl = document.getElementById('badge-icon-summary');
            const badgeNameEl = document.getElementById('badge-name-summary');
            if (scorePercentage >= 90) {
                badgeIconEl.textContent = 'üèÜ';
                badgeNameEl.textContent = 'B·∫≠c Th·∫ßy Ch·ªØ S·ªë!';
            } else if (scorePercentage >= 60) {
                badgeIconEl.textContent = 'üåü';
                badgeNameEl.textContent = 'Chuy√™n Gia ƒê·∫øm S·ªë!';
            } else if (scorePercentage >= 30) {
                badgeIconEl.textContent = 'üëç';
                badgeNameEl.textContent = 'Ti·∫øn B·ªô R·ªìi!';
            } else {
                badgeIconEl.textContent = 'üê£';
                badgeNameEl.textContent = 'Ng∆∞·ªùi M·ªõi T·∫≠p ƒê·∫øm';
            }
            
            document.getElementById('summary-modal').style.display = 'block';
        }

        window.closeModal = () => {
            document.getElementById('summary-modal').style.display = 'none';
        }

        // Close modal if user clicks outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('summary-modal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Load exercises when the page loads
        window.onload = loadExercises;

    </script>
</body>
</html>
