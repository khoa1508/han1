<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în t·∫≠p b√†i 3 ƒë·∫ßu gi·ªù - Ch·∫°m ƒë·ªÉ n·ªëi</title> <style>
        /* CSS c·∫≠p nh·∫≠t */
        body {
            font-family: sans-serif;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            /* Ch·ªëng double-tap zoom tr√™n mobile */
            touch-action: manipulation;
        }

        h1, h2, p, .subtitle {
            text-align: center;
            color: #333;
        }

        .subtitle {
            font-size: 1.3em;
            font-weight: normal;
            color: #555;
            margin-top: -10px;
            margin-bottom: 15px;
        }

        .game-status {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 1000px;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }

        #timer-display { color: #17a2b8; }
        #score-display { color: #dc3545; }

        .game-container {
            display: flex;
            justify-content: space-around;
            width: 90%;
            max-width: 1000px;
            margin-top: 10px;
            gap: 30px;
        }

        .container {
            border: 2px dashed #ccc;
            padding: 15px;
            width: 45%;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            min-height: 550px;
            /* Cho ph√©p cu·ªôn n·∫øu n·ªôi dung qu√° d√†i tr√™n mobile */
             overflow-y: auto;
             max-height: 70vh; /* Gi·ªõi h·∫°n chi·ªÅu cao ƒë·ªÉ lu√¥n th·∫•y c·∫£ 2 c·ªôt khi x·∫øp ch·ªìng */
        }

        /* --- C·∫≠p nh·∫≠t CSS cho √¥ ch·ªØ --- */
        .word-item {
            border: 2px solid #007bff; /* Vi·ªÅn d√†y h∆°n ch√∫t */
            background-color: #e7f3ff;
            padding: 10px 15px;
            cursor: pointer; /* ƒê·ªïi con tr·ªè th√†nh pointer */
            border-radius: 8px; /* Bo tr√≤n h∆°n */
            text-align: center;
            transition: background-color 0.2s, opacity 0.2s, border-color 0.2s; /* Th√™m transition cho border */
            width: 85%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }

        /* Ki·ªÉu khi √¥ ch·ªØ ƒë∆∞·ª£c ch·ªçn */
        .word-item.selected {
            background-color: #ffc107; /* M√†u v√†ng n·ªïi b·∫≠t khi ch·ªçn */
            border-color: #e0a800;
        }

        .hanzi {
            font-size: 1.8em;
            font-weight: bold;
            display: block;
            line-height: 1.2;
            color: #0056b3;
             pointer-events: none; /* Tr√°nh s·ª± ki·ªán click v√†o text con */
        }

        .pinyin {
            font-size: 0.9em;
            display: block;
            color: #555;
            margin-top: 2px;
             pointer-events: none; /* Tr√°nh s·ª± ki·ªán click v√†o text con */
        }

        /* B·ªè ki·ªÉu :active c≈© c·ªßa k√©o th·∫£ */
        /* .word-item:active { ... } */

        /* --- C·∫≠p nh·∫≠t CSS cho √¥ ·∫£nh --- */
        .image-box {
            border: 2px solid #ccc;
            width: 140px;
            height: 140px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f9f9f9;
            border-radius: 8px; /* Bo tr√≤n h∆°n */
            position: relative;
            transition: border-color 0.2s, background-color 0.2s, transform 0.1s; /* Th√™m transform */
            cursor: pointer; /* Th√™m con tr·ªè pointer */
        }
         /* Hi·ªáu ·ª©ng nh·∫π khi nh·∫•n v√†o ·∫£nh */
         .image-box:active {
            transform: scale(0.97);
         }


        .image-box img {
            max-width: 90%;
            max-height: 90%;
            display: block;
            pointer-events: none;
        }

        /* B·ªè ki·ªÉu .drag-over */
        /* .image-box.drag-over { ... } */

        .image-box.dropped {
            border-color: #28a745;
            background-color: #e9f7ec;
            cursor: default; /* Kh√¥ng cho click n·ªØa khi ƒë√£ gh√©p */
             opacity: 0.7; /* L√†m m·ªù ƒëi ch√∫t khi ƒë√£ gh√©p */
        }
         /* L√†m m·ªù lu√¥n ·∫£nh b√™n trong khi ƒë√£ gh√©p */
         .image-box.dropped img {
            opacity: 0.6;
         }


        .image-box .matched-text {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(40, 167, 69, 0.9); /* ƒê·∫≠m h∆°n ch√∫t */
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.95em;
            white-space: nowrap;
             pointer-events: none; /* Kh√¥ng cho text n√†y b·∫Øt s·ª± ki·ªán */
        }

        .feedback {
            margin-top: 35px;
            font-size: 1.3em;
            font-weight: bold;
            min-height: 30px;
            text-align: center;
            color: #17a2b8;
        }

        .feedback.correct { color: green; }
        .feedback.incorrect { color: red; }

        .word-item.matched {
            opacity: 0.4; /* M·ªù h∆°n */
            cursor: default; /* Kh√¥ng cho click */
            background-color: #e9ecef;
            border-color: #ced4da;
            pointer-events: none;
        }
         /* L√†m m·ªù ch·ªØ b√™n trong khi ƒë√£ gh√©p */
         .word-item.matched .hanzi,
         .word-item.matched .pinyin {
            opacity: 0.7;
         }


        /* C·∫≠p nh·∫≠t l·ªõp game-over ƒë·ªÉ v√¥ hi·ªáu h√≥a click */
        .game-over .word-item,
        .game-over .image-box {
            pointer-events: none; /* Quan tr·ªçng: V√¥ hi·ªáu h√≥a click */
            opacity: 0.6 !important; /* D√πng !important ƒë·ªÉ ghi ƒë√® c√°c opacity kh√°c */
            cursor: default !important;
        }
        /* Kh√¥ng c·∫ßn d√≤ng d∆∞·ªõi n·ªØa v√¨ pointer-events: none ƒë√£ ƒë·ªß */
        /* .game-over .word-item:not(.matched) { cursor: not-allowed; } */

        #reset-button {
            margin-top: 25px;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        #reset-button:hover { background-color: #0056b3; }

        /* Responsive */
        @media (max-width: 768px) {
            .subtitle { font-size: 1.1em; }
            .game-status {
                flex-direction: column;
                align-items: center;
                gap: 5px;
                font-size: 1.1em;
            }
            .game-container {
                flex-direction: column; /* X·∫øp ch·ªìng 2 c·ªôt */
                width: 95%;
                gap: 20px;
                max-height: none; /* B·ªè gi·ªõi h·∫°n chi·ªÅu cao chung */
            }
            .container {
                width: 100%;
                min-height: auto; /* Chi·ªÅu cao t·ª± ƒë·ªông */
                max-height: 45vh; /* Gi·ªõi h·∫°n chi·ªÅu cao m·ªói c·ªôt khi x·∫øp ch·ªìng */
                overflow-y: auto; /* Cho ph√©p cu·ªôn trong t·ª´ng c·ªôt */
                padding-bottom: 30px;
                border-style: solid; /* Hi·ªán border r√µ h∆°n tr√™n mobile */
            }
            .word-item { width: 90%; min-height: 45px; }
            .hanzi { font-size: 1.5em; }
            .pinyin { font-size: 0.8em; }

             .image-box {
                width: 100px;
                height: 100px;
            }
             .image-box .matched-text {
                 font-size: 0.8em;
                 bottom: -20px;
                 padding: 2px 8px;
             }
             .feedback { font-size: 1.1em; margin-top: 25px;}
             #reset-button { padding: 10px 20px; font-size: 1em; margin-top: 20px;}
        }
         @media (max-width: 480px) {
             .hanzi { font-size: 1.3em; }
             .pinyin { font-size: 0.75em; }
             .image-box { width: 85px; height: 85px; }
             .image-box .matched-text { font-size: 0.7em; bottom: -18px; }
             .container { max-height: 40vh; } /* Gi·∫£m chi·ªÅu cao c·ªôt tr√™n m√†n h√¨nh r·∫•t nh·ªè */
         }

    </style>
</head>
<body>

    <h1>Gh√©p Ng√¥n ng·ªØ v√†o H√¨nh ·∫£nh T∆∞∆°ng ·ª©ng</h1>
    <h2 class="subtitle">√în t·∫≠p b√†i 3 ƒë·∫ßu gi·ªù</h2>
    <p>Ch·∫°m v√†o T·ª´ v·ª±ng r·ªìi ch·∫°m v√†o H√¨nh ·∫£nh ƒë√∫ng.</p> <div class="game-status">
        <div id="timer-display">Th·ªùi gian: 00:00</div>
        <div id="score-display">S·ªë l·∫ßn sai: 0</div>
    </div>

    <div class="game-container" id="game-area">
        <div id="word-container" class="container">
            <h2>T·ª´ v·ª±ng</h2>
        </div>
        <div id="image-container" class="container">
            <h2>H√¨nh ·∫£nh</h2>
        </div>
    </div>

    <div id="feedback" class="feedback"></div>

    <button id="reset-button">Ch∆°i l·∫°i</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // D·ªØ li·ªáu kh√¥ng ƒë·ªïi
             const data = [
                 { hanzi: "Ëã±ËØ≠", pinyin: "Yƒ´ngy«î", img: "https://news.seehua.com/wp-content/uploads/2019/08/istockphoto-1047570732-612x612.jpg", id: "en" },
                { hanzi: "ÈòøÊãâ‰ºØËØ≠", pinyin: "ƒÄlƒÅb√≥y«î", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS1KhD1oV_sPdPIM9Bv16yc4xXCzKsABljWXA&s", id: "ar" },
                { hanzi: "‰øÑËØ≠", pinyin: "√ây«î", img: "https://d37sy4vufic209.cloudfront.net/website/_next/static/dynamic/9964e31df577bd0d9ef38d59c7016678/700.jpg", id: "ru" },
                { hanzi: "Âæ∑ËØ≠", pinyin: "D√©y«î", img: "https://imgcache.dealmoon.com/thumbimg.dealmoon.com/dealmoon/749/f05/79a/0090e42ad16301c0eb18429.jpg_1000_560_13_dc5b.jpg", id: "de" },
                { hanzi: "Ê≥ïËØ≠", pinyin: "F«éy«î", img: "https://aixue.us/wp-content/uploads/2021/09/French-1.png", id: "fr" },
                { hanzi: "Êó•ËØ≠", pinyin: "R√¨y«î", img: "https://wwwupload.gaodunwangxiao.com/uploads/220223/6329-220223144011K0.png", id: "ja" },
                { hanzi: "Èü©ÂõΩËØ≠", pinyin: "H√°ngu√≥y«î", img: "https://newsroom.korea.net/upload/content/editImage/20210930175734784_QESCNQ4V.jpg", id: "ko" },
                { hanzi: "Ë∂äÂçóËØ≠", pinyin: "Yu√®n√°ny«î", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Flag_of_Vietnam.svg/1200px-Flag_of_Vietnam.svg.png", id: "vi" },
                { hanzi: "Ë•øÁè≠ÁâôËØ≠", pinyin: "Xƒ´bƒÅny√°y«î", img: "https://casvischool.cn/wp-content/uploads/2023/07/%E8%A5%BF%E7%8F%AD%E7%89%99%E8%AF%AD%E4%BA%8C%E5%A4%96.png", id: "es" }
            ];

            // DOM Elements kh√¥ng ƒë·ªïi
            const wordContainer = document.getElementById('word-container');
            const imageContainer = document.getElementById('image-container');
            const feedback = document.getElementById('feedback');
            const resetButton = document.getElementById('reset-button');
            const timerDisplay = document.getElementById('timer-display');
            const scoreDisplay = document.getElementById('score-display');
            const gameArea = document.getElementById('game-area');

            // Bi·∫øn tr·∫°ng th√°i game
            // --- B·ªè draggedItem ---
            let selectedWordElement = null; // Bi·∫øn l∆∞u tr·ªØ √¥ ch·ªØ ƒëang ƒë∆∞·ª£c ch·ªçn
            let correctMatches = 0;
            let incorrectAttempts = 0;
            let timerIntervalId = null;
            let elapsedTime = 0;
            let gameActive = false;

            // --- C√°c h√†m ti·ªán √≠ch kh√¥ng ƒë·ªïi ---
            function shuffle(array) { /* ... */ for(let i = array.length-1;i>0;i--){const j = Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}}
            function formatTime(seconds) { /* ... */ const m = Math.floor(seconds/60); const s = seconds%60; return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;}
            function updateScoreDisplay() { scoreDisplay.textContent = `S·ªë l·∫ßn sai: ${incorrectAttempts}`; }
            function startTimer() { /* ... */ elapsedTime=0; timerDisplay.textContent=`Th·ªùi gian: ${formatTime(elapsedTime)}`; if(timerIntervalId)clearInterval(timerIntervalId); timerIntervalId=setInterval(()=>{elapsedTime++;timerDisplay.textContent=`Th·ªùi gian: ${formatTime(elapsedTime)}`},1000);}
            function endGame() { /* ... */ gameActive=false; clearInterval(timerIntervalId); gameArea.classList.add('game-over'); feedback.textContent=`üéâ Ho√†n th√†nh! Th·ªùi gian: ${formatTime(elapsedTime)}. S·ªë l·∫ßn sai: ${incorrectAttempts}.`; feedback.className='feedback correct';}

            // --- H√†m x·ª≠ l√Ω s·ª± ki·ªán click ---
            function handleWordClick(event) {
                if (!gameActive) return; // Game ch∆∞a b·∫Øt ƒë·∫ßu ho·∫∑c ƒë√£ k·∫øt th√∫c

                const clickedWord = event.currentTarget; // L·∫•y ph·∫ßn t·ª≠ div.word-item ƒë∆∞·ª£c click

                // B·ªè qua n·∫øu click v√†o t·ª´ ƒë√£ gh√©p ƒë√∫ng
                if (clickedWord.classList.contains('matched')) return;

                // N·∫øu ƒë√£ c√≥ t·ª´ ƒëang ƒë∆∞·ª£c ch·ªçn -> b·ªè ch·ªçn t·ª´ ƒë√≥
                if (selectedWordElement && selectedWordElement !== clickedWord) {
                    selectedWordElement.classList.remove('selected');
                }

                // Ch·ªçn t·ª´ m·ªõi (ho·∫∑c b·ªè ch·ªçn n·∫øu click l·∫°i ch√≠nh n√≥)
                 if (selectedWordElement === clickedWord) {
                    // Click l·∫°i t·ª´ ƒëang ch·ªçn -> b·ªè ch·ªçn
                    selectedWordElement.classList.remove('selected');
                    selectedWordElement = null;
                 } else {
                    // Ch·ªçn t·ª´ m·ªõi
                    clickedWord.classList.add('selected');
                    selectedWordElement = clickedWord;
                 }
            }

            function handleImageClick(event) {
                if (!gameActive) return; // Game ch∆∞a b·∫Øt ƒë·∫ßu ho·∫∑c ƒë√£ k·∫øt th√∫c

                const clickedImage = event.currentTarget; // L·∫•y ph·∫ßn t·ª≠ div.image-box ƒë∆∞·ª£c click

                 // B·ªè qua n·∫øu ch∆∞a ch·ªçn t·ª´ n√†o ho·∫∑c click v√†o ·∫£nh ƒë√£ gh√©p ƒë√∫ng
                if (!selectedWordElement || clickedImage.classList.contains('dropped')) {
                    // C√≥ th·ªÉ th√™m ph·∫£n h·ªìi nh·∫π nh√†ng n·∫øu ch∆∞a ch·ªçn t·ª´
                     if (!selectedWordElement && !clickedImage.classList.contains('dropped')) {
                         feedback.textContent = "H√£y ch·ªçn m·ªôt t·ª´ v·ª±ng tr∆∞·ªõc.";
                         feedback.className = 'feedback';
                         setTimeout(() => { if (!feedback.classList.contains('correct') && !feedback.classList.contains('incorrect')) feedback.textContent = ''; }, 1500);
                     }
                    return;
                }

                const selectedWordId = selectedWordElement.dataset.id;
                const targetImageId = clickedImage.dataset.id;

                // --- So s√°nh ID ---
                if (selectedWordId === targetImageId) {
                    // Gh√©p ƒë√∫ng
                    feedback.textContent = 'ƒê√∫ng r·ªìi!';
                    feedback.className = 'feedback correct';

                    // ƒê√°nh d·∫•u c·∫£ hai l√† ƒë√£ gh√©p
                    selectedWordElement.classList.add('matched');
                    selectedWordElement.classList.remove('selected'); // B·ªè l·ªõp selected
                    clickedImage.classList.add('dropped');

                    // Hi·ªÉn th·ªã text d∆∞·ªõi ·∫£nh
                    const matchedText = document.createElement('span');
                    matchedText.classList.add('matched-text');
                    const hanziSpan = selectedWordElement.querySelector('.hanzi');
                    const pinyinSpan = selectedWordElement.querySelector('.pinyin');
                    if (hanziSpan && pinyinSpan) {
                        matchedText.textContent = `${hanziSpan.textContent} ${pinyinSpan.textContent}`;
                    }
                    const existingText = clickedImage.querySelector('.matched-text');
                    if (existingText) clickedImage.removeChild(existingText);
                    if(matchedText.textContent) clickedImage.appendChild(matchedText);

                    correctMatches++;
                    selectedWordElement = null; // Reset l·ª±a ch·ªçn t·ª´

                    // X√≥a ph·∫£n h·ªìi ƒë√∫ng sau 1.5s
                    setTimeout(() => { if(feedback.classList.contains('correct')) { feedback.textContent = ''; feedback.className = 'feedback'; } }, 1500);

                    // Ki·ªÉm tra ho√†n th√†nh game
                    if (correctMatches === data.length) {
                        endGame();
                    }

                } else {
                    // Gh√©p sai
                    incorrectAttempts++;
                    updateScoreDisplay();
                    feedback.textContent = 'Sai r·ªìi, th·ª≠ l·∫°i nh√©!';
                    feedback.className = 'feedback incorrect';

                    // B·ªè ch·ªçn t·ª´ hi·ªán t·∫°i ƒë·ªÉ ng∆∞·ªùi d√πng ch·ªçn l·∫°i
                     selectedWordElement.classList.remove('selected');
                     selectedWordElement = null;


                    // Rung nh·∫π (n·∫øu tr√¨nh duy·ªát h·ªó tr·ª£) ƒë·ªÉ b√°o sai - t√πy ch·ªçn
                    if (navigator.vibrate) {
                        navigator.vibrate(100); // Rung 100ms
                    }

                    // X√≥a ph·∫£n h·ªìi sai sau 2s
                    setTimeout(() => { if (feedback.classList.contains('incorrect')) { feedback.textContent = ''; feedback.className = 'feedback'; } }, 2000);
                }
            }


            // --- H√†m kh·ªüi t·∫°o game ---
            function initGame() {
                gameActive = true;
                correctMatches = 0;
                incorrectAttempts = 0;
                selectedWordElement = null; // Reset t·ª´ ƒëang ch·ªçn
                gameArea.classList.remove('game-over');

                wordContainer.innerHTML = '<h2>T·ª´ v·ª±ng</h2>'; // Ch·ªâ gi·ªØ ti√™u ƒë·ªÅ
                imageContainer.innerHTML = '<h2>H√¨nh ·∫£nh</h2>'; // Ch·ªâ gi·ªØ ti√™u ƒë·ªÅ
                feedback.textContent = '';
                feedback.className = 'feedback';
                updateScoreDisplay();

                if (timerIntervalId) clearInterval(timerIntervalId);
                startTimer();

                const shuffledWords = [...data];
                const shuffledImages = [...data];
                shuffle(shuffledWords);
                shuffle(shuffledImages);

                // T·∫°o √¥ ch·ªØ - *** THAY ƒê·ªîI: G·∫Øn s·ª± ki·ªán click ***
                shuffledWords.forEach(item => {
                    const wordDiv = document.createElement('div');
                    wordDiv.classList.add('word-item');
                    // B·ªè draggable="true"
                    wordDiv.dataset.id = item.id;
                    wordDiv.innerHTML = `<span class="hanzi">${item.hanzi}</span><span class="pinyin">(${item.pinyin})</span>`;

                    // G·∫Øn s·ª± ki·ªán click thay v√¨ dragstart/dragend
                    wordDiv.addEventListener('click', handleWordClick);

                    wordContainer.appendChild(wordDiv);
                });

                // T·∫°o √¥ ·∫£nh - *** THAY ƒê·ªîI: G·∫Øn s·ª± ki·ªán click ***
                shuffledImages.forEach(item => {
                    const imgBox = document.createElement('div');
                    imgBox.classList.add('image-box');
                    imgBox.dataset.id = item.id;
                    const imgElement = document.createElement('img');
                    imgElement.src = item.img;
                    imgElement.alt = `H√¨nh ·∫£nh cho ${item.hanzi}`;
                    imgElement.onerror = function() { console.error(`L·ªói t·∫£i ·∫£nh: ${item.hanzi}`); imgBox.innerHTML = `(L·ªói ·∫£nh: ${item.id})`; };
                    imgBox.appendChild(imgElement);

                    // G·∫Øn s·ª± ki·ªán click thay v√¨ dragover/drop
                    imgBox.addEventListener('click', handleImageClick);

                    imageContainer.appendChild(imgBox);
                });
            }

            // Ch·∫°y game l·∫ßn ƒë·∫ßu v√† g·∫Øn s·ª± ki·ªán cho n√∫t reset
            initGame();
            resetButton.addEventListener('click', initGame);
        });
    </script>

</body>
</html>
