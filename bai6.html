<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ Ch∆°i √în T·∫≠p Ti·∫øng Trung</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f8ff;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .game-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            text-align: center;
        }
        .section {
            display: none; /* ·∫®n t·∫•t c·∫£ c√°c ph·∫ßn ban ƒë·∫ßu */
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .section.active {
            display: block; /* Hi·ªÉn th·ªã ph·∫ßn hi·ªán t·∫°i */
        }
        h1, h2 {
            color: #007bff;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        /* CSS cho control-buttons c√≥ th·ªÉ b·ªè ƒëi n·∫øu kh√¥ng c√≤n n√∫t n√†o kh√°c */
        /* .control-buttons button {
            background-color: #28a745; 
        }
        .control-buttons button:hover {
            background-color: #1e7e34;
        } */
        #timerDisplay, #hintArea {
            margin: 15px 0;
            font-size: 18px;
            color: #dc3545; 
        }
        input[type="text"] {
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        .feedback {
            margin-top: 10px;
            font-weight: bold;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
        .pinyin-hint {
            font-style: italic;
            color: #555;
            margin-bottom: 10px;
        }
        .sentence-words button {
            background-color: #ffc107; 
            color: #333;
            margin: 5px;
        }
        .sentence-words button:hover {
            background-color: #e0a800;
        }
        .drop-area {
            border: 2px dashed #007bff;
            padding: 10px;
            min-height: 50px;
            margin-top: 10px;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }
        .drop-area span {
            padding: 8px;
            background-color: #e9ecef;
            margin: 3px;
            border-radius: 4px;
            cursor: pointer;
        }
        .dialogue-text {
            text-align: left;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e9f7fd;
            border-left: 5px solid #007bff;
            line-height: 1.6;
        }
        .hanzi-line {
            margin-bottom: 2px; 
        }
        .pinyin-dialogue-line {
            font-size: 0.9em;
            color: #555555;
            margin-bottom: 8px; 
        }
        .question-container {
            margin-bottom:15px;
            text-align: left;
        }
        .options button {
            display: block;
            width: calc(100% - 10px);
            margin: 5px 0;
            text-align: left;
            background-color: #6c757d;
        }
        .options button:hover {
            background-color: #5a6268;
        }
        #summaryPage ul {
            list-style-type: none;
            padding: 0;
            text-align: left;
        }
        #summaryPage li {
            margin-bottom: 8px;
            font-size: 16px;
        }
        .error-detail {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
            padding: .75rem 1.25rem;
            margin-top: .5rem;
            border: 1px solid transparent;
            border-radius: .25rem;
        }
        .cute-icon {
            font-size: 20px; 
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1><span class="cute-icon">üèÆ</span> Tr√≤ Ch∆°i √în T·∫≠p Ti·∫øng Trung <span class="cute-icon">üèÆ</span></h1>
        
        <div id="timerDisplay">Th·ªùi gian: 00:00</div>
        <div id="hintArea">üí° G·ª£i √Ω s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y!</div>

        <div id="startPage" class="section active">
            <h2>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi tr√≤ ch∆°i! <span class="cute-icon">üéâ</span></h2>
            <p>H√£y s·∫µn s√†ng ƒë·ªÉ √¥n t·∫≠p ki·∫øn th·ª©c ti·∫øng Trung c·ªßa m√¨nh nh√©!</p>
            <button onclick="startGame()">B·∫Øt ƒë·∫ßu ch∆°i <span class="cute-icon">üöÄ</span></button>
        </div>

        <div id="part1" class="section">
            <h2>Ph·∫ßn 1: ƒêi·ªÅn T·ª´ <span class="cute-icon">‚úçÔ∏è</span></h2>
            <p id="part1Instruction">H√£y ƒëi·ªÅn ch·ªØ H√°n t∆∞∆°ng ·ª©ng v·ªõi nghƒ©a ti·∫øng Vi·ªát v√† g·ª£i √Ω Pinyin nh√©. C·ªë l√™n n√†o! <span class="cute-icon">üí™</span></p>
            <div id="p1QuestionArea">
                <p>Nghƒ©a ti·∫øng Vi·ªát: <strong id="p1VietMeaning"></strong></p>
                <p class="pinyin-hint">Pinyin: <em id="p1PinyinHint"></em></p>
                <input type="text" id="p1AnswerInput" placeholder="Nh·∫≠p ch·ªØ H√°n">
                <button onclick="checkPart1Answer()">Ki·ªÉm tra</button>
            </div>
            <div id="p1Feedback" class="feedback"></div>
        </div>

        <div id="part2" class="section">
            <h2>Ph·∫ßn 2: S·∫Øp X·∫øp C√¢u <span class="cute-icon">üß©</span></h2>
            <p id="part2Instruction">H√£y s·∫Øp x·∫øp c√°c t·ª´ b·ªã x√°o tr·ªôn ƒë·ªÉ t·∫°o th√†nh c√¢u ƒë√∫ng nghƒ©a. K√©o v√† th·∫£ ho·∫∑c click ƒë·ªÉ ch·ªçn nh√©! <span class="cute-icon">üëç</span></p>
            <p>Nghƒ©a ti·∫øng Vi·ªát tham kh·∫£o: <strong id="p2VietMeaningRef"></strong></p>
            <div id="p2ScrambledWords" class="sentence-words">
            </div>
            <p>C√¢u c·ªßa b·∫°n:</p>
            <div id="p2DropArea" class="drop-area">
            </div>
            <button onclick="clearDroppedWords()">L√†m l·∫°i</button>
            <button onclick="checkPart2Answer()">Ki·ªÉm tra</button>
            <div id="p2Feedback" class="feedback"></div>
        </div>

        <div id="part3" class="section">
            <h2>Ph·∫ßn 3: ƒê·ªçc Hi·ªÉu <span class="cute-icon">üìñ</span></h2>
            <p id="part3Instruction">ƒê·ªçc ƒëo·∫°n vƒÉn sau v√† ch·ªçn ƒë√°p √°n ƒë√∫ng cho c√¢u h·ªèi. Ch√∫ √Ω nh√©! <span class="cute-icon">üßê</span></p>
            <button id="showPinyinBtn" onclick="togglePinyin()">·∫®n/Hi·ªán Pinyin</button>
            <div id="p3Dialogue" class="dialogue-text">
            </div>
            <div id="p3QuestionContainer" class="question-container">
                <p id="p3QuestionText"></p>
                <div id="p3Options" class="options">
                </div>
            </div>
            <div id="p3Feedback" class="feedback"></div>
            <div id="p3VietTranslationOnError" class="feedback" style="color: blue; margin-top: 10px;"></div>
        </div>

        <div id="summaryPage" class="section">
            <h2>T·ªïng K·∫øt <span class="cute-icon">üèÜ</span></h2>
            <p>Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh tr√≤ ch∆°i! <span class="cute-icon">ü•≥</span></p>
            <p>T·ªïng th·ªùi gian l√†m b√†i: <span id="totalTime"></span></p>
            <p>S·ªë c√¢u ƒë√∫ng: <span id="correctAnswers"></span></p>
            <p>S·ªë c√¢u sai: <span id="incorrectAnswers"></span></p>
            <h3>Chi ti·∫øt l·ªói sai:</h3>
            <ul id="errorDetails">
            </ul>
            <button onclick="restartGame()">Ch∆°i l·∫°i <span class="cute-icon">üîÅ</span></button>
        </div>

        </div>

    <script>
        // D·ªØ li·ªáu cho tr√≤ ch∆°i
        const vocabList = [
            { hanzi: "Ë∂äÂçó", pinyin: "Yu√®n√°n", viet: "Vi·ªát Nam" },
            { hanzi: "‰∏≠ÂõΩ", pinyin: "Zh≈çnggu√≥", viet: "Trung Qu·ªëc" },
            { hanzi: "Âæ∑ÂõΩ", pinyin: "D√©gu√≥", viet: "ƒê·ª©c" },
            { hanzi: "Êó•Êú¨", pinyin: "R√¨bƒõn", viet: "Nh·∫≠t B·∫£n" },
            { hanzi: "Ê≥ïÂõΩ", pinyin: "F«égu√≥", viet: "Ph√°p" },
            { hanzi: "ÁæéÂõΩ", pinyin: "Mƒõigu√≥", viet: "M·ªπ" },
            { hanzi: "Èü©ÂõΩ", pinyin: "H√°ngu√≥", viet: "H√†n Qu·ªëc" },
            { hanzi: "‰øÑÁΩóÊñØ", pinyin: "√âlu√≥sƒ´", viet: "Nga" },
            { hanzi: "Ë•øÁè≠Áâô", pinyin: "Xƒ´bƒÅny√°", viet: "T√¢y Ban Nha" },
            { hanzi: "Ëã±ÂõΩ", pinyin: "Yƒ´nggu√≥", viet: "Anh" },
            { hanzi: "‰π¶", pinyin: "Sh≈´", viet: "S√°ch" },
            { hanzi: "ÊùÇÂøó", pinyin: "Z√°zh√¨", viet: "T·∫°p ch√≠" },
            { hanzi: "Ë∞Å", pinyin: "Sh√©i", viet: "Ai" },
            { hanzi: "ËÆ§ËØÜ", pinyin: "R√®nshi", viet: "Bi·∫øt" },
            { hanzi: "È´òÂÖ¥", pinyin: "GƒÅox√¨ng", viet: "Vui v·∫ª" }
        ];

        const sentenceList = [
            { correct: "‰ªñÈóÆÊàë„ÄÇ", pinyin: "TƒÅ w√®n w«í.", scrambledParts: ["ÈóÆ", "Êàë", "‰ªñ", "„ÄÇ"], viet: "Anh ·∫•y h·ªèi t√¥i." },
            { correct: "‰ªñÈóÆ‰Ω†‰ªÄ‰πàÔºü", pinyin: "TƒÅ w√®n n«ê sh√©nme?", scrambledParts: ["ÈóÆ", "‰Ω†", "‰ªñ", "‰ªÄ‰πà", "Ôºü"], viet: "Anh ·∫•y h·ªèi b·∫°n c√°i g√¨?" },
            { correct: "ËØ∑ÈóÆÔºåÊÇ®Ë¥µÂßìÔºü", pinyin: "Q«êngw√®n, n√≠n gu√¨x√¨ng?", scrambledParts: ["Ë¥µÂßì", "ÊÇ®", "Ôºå", "ËØ∑ÈóÆ", "Ôºü"], viet: "Xin h·ªèi, qu√Ω danh c·ªßa ng√†i l√† g√¨?" },
            { correct: "ËØ∑ÈóÆÔºå‰Ω†Ë¥µÂßìÔºü", pinyin: "Q«êngw√®n, n«ê gu√¨x√¨ng?", scrambledParts: ["Ë¥µÂßì", "‰Ω†", "Ôºå", "ËØ∑ÈóÆ", "Ôºü"], viet: "Xin h·ªèi, b·∫°n h·ªç g√¨?" },
            { correct: "‰Ω†Âßì‰ªÄ‰πàÔºü", pinyin: "N«ê x√¨ng sh√©nme?", scrambledParts: ["‰ªÄ‰πà", "‰Ω†", "Âßì", "Ôºü"], viet: "B·∫°n h·ªç g√¨?" },
            { correct: "ÊàëÂßìÂº†„ÄÇ", pinyin: "W«í x√¨ng ZhƒÅng.", scrambledParts: ["Âº†", "Êàë", "Âßì", "„ÄÇ"], viet: "T√¥i h·ªç Tr∆∞∆°ng." },
            { correct: "‰Ω†Âè´‰ªÄ‰πàÔºü", pinyin: "N«ê ji√†o sh√©nme?", scrambledParts: ["Âè´", "‰ªÄ‰πà", "‰Ω†", "Ôºü"], viet: "B·∫°n t√™n g√¨?" },
            { correct: "‰Ω†Âè´‰ªÄ‰πàÂêçÂ≠óÔºü", pinyin: "N«ê ji√†o sh√©nme m√≠ngzi?", scrambledParts: ["ÂêçÂ≠ó", "‰Ω†", "‰ªÄ‰πà", "Âè´", "Ôºü"], viet: "B·∫°n t√™n l√† g√¨?" },
            { correct: "‰Ω†ÁöÑÂêçÂ≠óÊòØ‰ªÄ‰πàÔºü", pinyin: "N«ê de m√≠ngzi sh√¨ sh√©nme?", scrambledParts: ["ÊòØ", "ÂêçÂ≠ó", "‰ªÄ‰πà", "‰Ω†", "ÁöÑ", "Ôºü"], viet: "T√™n c·ªßa b·∫°n l√† g√¨?" },
            { correct: "‰Ω†Â≠¶‰π†‰ªÄ‰πàÔºü", pinyin: "N«ê xu√©x√≠ sh√©nme?", scrambledParts: ["‰ªÄ‰πà", "‰Ω†", "Â≠¶‰π†", "Ôºü"], viet: "B·∫°n h·ªçc c√°i g√¨?" },
            { correct: "‰Ω†Âñù‰ªÄ‰πàÔºü", pinyin: "N«ê hƒì sh√©nme?", scrambledParts: ["Âñù", "‰ªÄ‰πà", "‰Ω†", "Ôºü"], viet: "B·∫°n u·ªëng g√¨?" },
            { correct: "‰Ω†ÊòØÂì™ÂõΩ‰∫∫Ôºü", pinyin: "N«ê sh√¨ n«é gu√≥ r√©n?", scrambledParts: ["‰∫∫", "‰Ω†", "ÂõΩ", "Âì™", "ÊòØ", "Ôºü"], viet: "B·∫°n l√† ng∆∞·ªùi n∆∞·ªõc n√†o?" },
            { correct: "ÊàëÊòØË∂äÂçó‰∫∫„ÄÇ", pinyin: "W«í sh√¨ Yu√®n√°n r√©n.", scrambledParts: ["‰∫∫", "Êàë", "Ë∂äÂçó", "ÊòØ", "„ÄÇ"], viet: "T√¥i l√† ng∆∞·ªùi Vi·ªát Nam." },
            { correct: "ËøôÊòØ‰π¶„ÄÇ", pinyin: "Zh√® sh√¨ sh≈´.", scrambledParts: ["‰π¶", "Ëøô", "ÊòØ", "„ÄÇ"], viet: "ƒê√¢y l√† s√°ch." },
            { correct: "ËøôÊòØ‰∏≠Êñá‰π¶„ÄÇ", pinyin: "Zh√® sh√¨ Zh≈çngw√©n sh≈´.", scrambledParts: ["‰π¶", "‰∏≠Êñá", "Ëøô", "ÊòØ", "„ÄÇ"], viet: "ƒê√¢y l√† s√°ch ti·∫øng Trung." },
            { correct: "ËøôÊòØËÄÅÂ∏àÁöÑ‰π¶„ÄÇ", pinyin: "Zh√® sh√¨ l«éoshƒ´ de sh≈´.", scrambledParts: ["ÁöÑ", "‰π¶", "ËÄÅÂ∏à", "Ëøô", "ÊòØ", "„ÄÇ"], viet: "ƒê√¢y l√† s√°ch c·ªßa gi√°o vi√™n." },
            { correct: "ËøôÊòØ‰ªÄ‰πàÔºü", pinyin: "Zh√® sh√¨ sh√©nme?", scrambledParts: ["ÊòØ", "Ëøô", "‰ªÄ‰πà", "Ôºü"], viet: "ƒê√¢y l√† c√°i g√¨?" },
            { correct: "ËøôÊòØ‰ªÄ‰πà‰π¶Ôºü", pinyin: "Zh√® sh√¨ sh√©nme sh≈´?", scrambledParts: ["‰π¶", "‰ªÄ‰πà", "Ëøô", "ÊòØ", "Ôºü"], viet: "ƒê√¢y l√† s√°ch g√¨?" },
            { correct: "ËøôÊòØË∞ÅÁöÑ‰π¶Ôºü", pinyin: "Zh√® sh√¨ sh√©i de sh≈´?", scrambledParts: ["ÁöÑ", "Ë∞Å", "‰π¶", "Ëøô", "ÊòØ", "Ôºü"], viet: "ƒê√¢y l√† s√°ch c·ªßa ai?" }
        ];
        
        const readingContent = {
            dialogueHanzi: "A: ‰Ω†Â•ΩÔºÅ\nB: ‰Ω†Â•ΩÔºÅ\nA: ËØ∑ÈóÆÔºå‰Ω†Âè´‰ªÄ‰πàÂêçÂ≠óÔºü\nB: ÊàëÂè´ÂÆâÂ®ú„ÄÇ\nA: ‰Ω†ÊòØÂì™ÂõΩ‰∫∫Ôºü\nB: ÊàëÊòØÁæéÂõΩ‰∫∫„ÄÇ‰Ω†ÊòØÂì™ÂõΩ‰∫∫Ôºü\nA: ÊàëÊòØÊó•Êú¨‰∫∫ÔºåÊàëÂè´Áî∞‰∏≠„ÄÇËÆ§ËØÜ‰Ω†ÂæàÈ´òÂÖ¥„ÄÇ\nB: ËÆ§ËØÜ‰Ω†ÔºåÊàë‰πüÂæàÈ´òÂÖ¥„ÄÇ\nA: ‰Ω†Â•ΩÔºÅÂÆâÂ®ú„ÄÇ\nB: ‰Ω†Â•ΩÔºÅÁî∞‰∏≠„ÄÇ\nA: ÂÆâÂ®úÔºåËøôÊòØË∞ÅÁöÑ‰π¶Ôºü\nB: ÊàëÁöÑ‰π¶„ÄÇ\nA: ËøôÊòØ‰Ω†ÁöÑËã±ÊñáÊùÇÂøóÂêóÔºü\nB: ‰∏çÊòØ„ÄÇ",
            dialoguePinyin: "A: N«ê h«éo!\nB: N«ê h«éo!\nA: Q«êngw√®n, n«ê ji√†o sh√©nme m√≠ngzi?\nB: W«í ji√†o ƒÄnn√†.\nA: N«ê sh√¨ n«é gu√≥ r√©n?\nB: W«í sh√¨ Mƒõigu√≥ r√©n. N«ê sh√¨ n«é gu√≥ r√©n?\nA: W«í sh√¨ R√¨bƒõn r√©n, w«í ji√†o Ti√°nzh≈çng. R√®nshi n«ê hƒõn gƒÅox√¨ng.\nB: R√®nshi n«ê, w«í yƒõ hƒõn gƒÅox√¨ng.\nA: N«ê h«éo! ƒÄnn√†.\nB: N«ê h«éo! Ti√°nzh≈çng.\nA: ƒÄnn√†, zh√® sh√¨ sh√©i de sh≈´?\nB: W«í de sh≈´.\nA: Zh√® sh√¨ n«ê de Yƒ´ngw√©n z√°zh√¨ ma?\nB: B√∫ sh√¨.",
            questions: [
                { 
                    questionText: "AÂè´‰ªÄ‰πàÂêçÂ≠óÔºü", 
                    options: [
                        { text: "ÂÆâÂ®ú", pinyin: "ƒÄnn√†", correct: false },
                        { text: "Áî∞‰∏≠", pinyin: "Ti√°nzh≈çng", correct: true },
                        { text: "‰∏≠Áî∞", pinyin: "Zh≈çngti√°n", correct: false },
                        { text: "Êó•Êú¨", pinyin: "R√¨bƒõn", correct: false }
                    ],
                    vietMeaning: "A t√™n l√† g√¨?"
                },
                { 
                    questionText: "BÂè´‰ªÄ‰πàÂêçÂ≠óÔºü", 
                    options: [
                        { text: "Áî∞‰∏≠", pinyin: "Ti√°nzh≈çng", correct: false },
                        { text: "ÂÆâÂ®ú", pinyin: "ƒÄnn√†", correct: true },
                        { text: "ÂÆâÂ¶Æ", pinyin: "ƒÄnnƒ´", correct: false },
                        { text: "ÁæéÂõΩ", pinyin: "Mƒõigu√≥", correct: false }
                    ],
                    vietMeaning: "B t√™n l√† g√¨?"
                },
                { 
                    questionText: "BÊòØÂì™ÂõΩ‰∫∫Ôºü", 
                    options: [
                        { text: "Êó•Êú¨‰∫∫", pinyin: "R√¨bƒõn r√©n", correct: false },
                        { text: "Ëã±ÂõΩ‰∫∫", pinyin: "Yƒ´nggu√≥ r√©n", correct: false },
                        { text: "ÁæéÂõΩ‰∫∫", pinyin: "Mƒõigu√≥ r√©n", correct: true },
                        { text: "Âä†ÊãøÂ§ß‰∫∫", pinyin: "JiƒÅn√°d√† r√©n", correct: false }
                    ],
                    vietMeaning: "B l√† ng∆∞·ªùi n∆∞·ªõc n√†o?"
                },
                { 
                    questionText: "AÊòØÂì™ÂõΩ‰∫∫Ôºü", 
                    options: [
                        { text: "ÁæéÂõΩ‰∫∫", pinyin: "Mƒõigu√≥ r√©n", correct: false },
                        { text: "Êó•Êú¨‰∫∫", pinyin: "R√¨bƒõn r√©n", correct: true },
                        { text: "Èü©ÂõΩ‰∫∫", pinyin: "H√°ngu√≥ r√©n", correct: false },
                        { text: "‰∏≠ÂõΩ‰∫∫", pinyin: "Zh≈çnggu√≥ r√©n", correct: false }
                    ],
                    vietMeaning: "A l√† ng∆∞·ªùi n∆∞·ªõc n√†o?"
                }
            ]
        };

        // Tr·∫°ng th√°i tr√≤ ch∆°i
        let currentPart = 0; 
        let currentQuestionIndex = 0;
        let score = 0;
        let errors = 0;
        let errorDetailsList = [];
        let timerInterval;
        let secondsElapsed = 0;
        let part1Attempts = 0;
        let pinyinVisible = false;

        // DOM Elements
        const sections = document.querySelectorAll('.section');
        const timerDisplay = document.getElementById('timerDisplay');
        const hintArea = document.getElementById('hintArea');
        
        const p1VietMeaningEl = document.getElementById('p1VietMeaning');
        const p1PinyinHintEl = document.getElementById('p1PinyinHint');
        const p1AnswerInputEl = document.getElementById('p1AnswerInput');
        const p1FeedbackEl = document.getElementById('p1Feedback');

        const p2VietMeaningRefEl = document.getElementById('p2VietMeaningRef');
        const p2ScrambledWordsEl = document.getElementById('p2ScrambledWords');
        const p2DropAreaEl = document.getElementById('p2DropArea');
        const p2FeedbackEl = document.getElementById('p2Feedback');
        let p2CurrentDroppedWords = [];

        const p3DialogueEl = document.getElementById('p3Dialogue');
        const showPinyinBtnEl = document.getElementById('showPinyinBtn');
        const p3QuestionTextEl = document.getElementById('p3QuestionText');
        const p3OptionsEl = document.getElementById('p3Options');
        const p3FeedbackEl = document.getElementById('p3Feedback');
        const p3VietTranslationOnErrorEl = document.getElementById('p3VietTranslationOnError');

        const totalTimeEl = document.getElementById('totalTime');
        const correctAnswersEl = document.getElementById('correctAnswers');
        const incorrectAnswersEl = document.getElementById('incorrectAnswers');
        const errorDetailsEl = document.getElementById('errorDetails');
        // const nextPartButton = document.getElementById('nextPartButton'); // ƒê√£ x√≥a


        function updateHint(newHint = "H√£y ch√∫ √Ω nh√©! üòâ") {
            hintArea.innerHTML = `üí° ${newHint}`;
        }

        function showSection(sectionId) {
            sections.forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            updateHint(); 
        }

        function startTimer() {
            secondsElapsed = 0;
            clearInterval(timerInterval); 
            timerInterval = setInterval(() => {
                secondsElapsed++;
                const minutes = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
                const seconds = (secondsElapsed % 60).toString().padStart(2, '0');
                timerDisplay.textContent = `Th·ªùi gian: ${minutes}:${seconds}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function startGame() {
            currentPart = 1; // B·∫Øt ƒë·∫ßu t·ª´ Ph·∫ßn 1
            score = 0;
            errors = 0;
            errorDetailsList = [];
            secondsElapsed = 0;
            startTimer();
            loadPart1();
            // nextPartButton.style.display = 'inline-block'; // ƒê√£ x√≥a
        }
        
        function restartGame() {
            currentPart = 0;
            showSection('startPage');
            // nextPartButton.style.display = 'none'; // ƒê√£ x√≥a
            stopTimer();
            timerDisplay.textContent = `Th·ªùi gian: 00:00`;
        }

        function loadPart1() {
            currentQuestionIndex = 0; 
            showSection('part1');
            displayVocabQuestion();
            updateHint("ƒêi·ªÅn ch·ªØ H√°n ƒë√∫ng n√†o! B·∫°n c√≥ 3 l·∫ßn th·ª≠ cho m·ªói t·ª´. üßê");
        }

        function displayVocabQuestion() {
            if (currentQuestionIndex < vocabList.length) {
                const currentVocab = vocabList[currentQuestionIndex];
                p1VietMeaningEl.textContent = currentVocab.viet;
                p1PinyinHintEl.textContent = currentVocab.pinyin;
                p1AnswerInputEl.value = '';
                p1FeedbackEl.textContent = '';
                part1Attempts = 0;
                p1AnswerInputEl.focus();
            } else {
                // alert("Ho√†n th√†nh Ph·∫ßn 1! üéâ"); // Th√¥ng b√°o n√†y c√≥ th·ªÉ kh√¥ng c·∫ßn thi·∫øt n·∫øu chuy·ªÉn ph·∫ßn t·ª± ƒë·ªông
                nextPart(); // T·ª± ƒë·ªông chuy·ªÉn sang ph·∫ßn ti·∫øp theo
            }
        }

        function checkPart1Answer() {
            const userAnswer = p1AnswerInputEl.value.trim();
            const correctAnswer = vocabList[currentQuestionIndex].hanzi;

            if (userAnswer === correctAnswer) {
                p1FeedbackEl.innerHTML = "ƒê√∫ng r·ªìi! <span class='cute-icon'>‚úÖ</span>";
                p1FeedbackEl.className = 'feedback correct';
                score++;
                setTimeout(() => {
                    currentQuestionIndex++;
                    displayVocabQuestion();
                }, 1000);
            } else {
                part1Attempts++;
                if (part1Attempts >= 3) {
                    p1FeedbackEl.innerHTML = `Sai r·ªìi <span class='cute-icon'>‚ùå</span>. ƒê√°p √°n ƒë√∫ng l√†: <strong>${correctAnswer}</strong>`;
                    p1FeedbackEl.className = 'feedback incorrect';
                    errors++;
                    errorDetailsList.push({ part: 1, question: `T·ª´: ${vocabList[currentQuestionIndex].viet}`, correctAnswer: correctAnswer, yourAnswer: userAnswer });
                    setTimeout(() => {
                        currentQuestionIndex++;
                        displayVocabQuestion();
                    }, 2500);
                } else {
                    p1FeedbackEl.innerHTML = `Sai r·ªìi <span class='cute-icon'>‚ùå</span>. B·∫°n c√≤n ${3 - part1Attempts} l·∫ßn th·ª≠.`;
                    p1FeedbackEl.className = 'feedback incorrect';
                }
            }
        }
        
        function loadPart2() {
            currentQuestionIndex = 0;
            showSection('part2');
            displaySentenceQuestion();
            updateHint("K√©o th·∫£ ho·∫∑c nh·∫•n v√†o c√°c t·ª´ ƒë·ªÉ s·∫Øp x·∫øp th√†nh c√¢u ho√†n ch·ªânh. C·ªë l√™n! ü§ó");
        }

        function displaySentenceQuestion() {
            if (currentQuestionIndex < sentenceList.length) {
                const currentSentence = sentenceList[currentQuestionIndex];
                p2VietMeaningRefEl.textContent = currentSentence.viet;
                p2ScrambledWordsEl.innerHTML = '';
                p2DropAreaEl.innerHTML = '';
                p2CurrentDroppedWords = [];
                p2FeedbackEl.textContent = '';

                let partsToDisplay = [...currentSentence.scrambledParts];
                partsToDisplay.forEach((word, index) => {
                    const wordButton = document.createElement('button');
                    wordButton.textContent = word;
                    wordButton.onclick = () => addWordToDropArea(word, wordButton);
                    p2ScrambledWordsEl.appendChild(wordButton);
                });
            } else {
                // alert("Ho√†n th√†nh Ph·∫ßn 2! üéâ");
                nextPart();
            }
        }
        
        function addWordToDropArea(word, buttonElement) {
            p2CurrentDroppedWords.push(word);
            const wordSpan = document.createElement('span');
            wordSpan.textContent = word;
            wordSpan.onclick = () => removeWordFromDropArea(word, wordSpan, buttonElement);
            p2DropAreaEl.appendChild(wordSpan);
            buttonElement.style.display = 'none'; 
            p2FeedbackEl.textContent = ''; 
        }

        function removeWordFromDropArea(word, spanElement, buttonElement) {
            p2DropAreaEl.removeChild(spanElement);
            const wordIndex = p2CurrentDroppedWords.indexOf(word);
            if (wordIndex > -1) {
                p2CurrentDroppedWords.splice(wordIndex, 1);
            }
            if (buttonElement) buttonElement.style.display = 'inline-block'; 
        }

        function clearDroppedWords() {
            p2DropAreaEl.innerHTML = '';
            p2CurrentDroppedWords = [];
            const buttons = p2ScrambledWordsEl.getElementsByTagName('button');
            for (let button of buttons) {
                button.style.display = 'inline-block';
            }
            p2FeedbackEl.textContent = '';
        }

        function checkPart2Answer() {
            const userAnswer = p2CurrentDroppedWords.join('');
            const correctAnswer = sentenceList[currentQuestionIndex].correct;

            if (userAnswer === correctAnswer) {
                p2FeedbackEl.innerHTML = "Ch√≠nh x√°c! <span class='cute-icon'>‚úÖ</span>";
                p2FeedbackEl.className = 'feedback correct';
                score++;
                setTimeout(() => {
                    currentQuestionIndex++;
                    displaySentenceQuestion();
                }, 1500);
            } else {
                p2FeedbackEl.innerHTML = `Ch∆∞a ƒë√∫ng r·ªìi <span class='cute-icon'>‚ùå</span>. ƒê√°p √°n ƒë√∫ng: <strong>${correctAnswer}</strong>`;
                p2FeedbackEl.className = 'feedback incorrect';
                errors++;
                 errorDetailsList.push({ part: 2, question: `C√¢u: ${sentenceList[currentQuestionIndex].viet}`, correctAnswer: correctAnswer, yourAnswer: userAnswer });
                setTimeout(() => { // C√≥ th·ªÉ cho ng∆∞·ªùi d√πng th·ª≠ l·∫°i thay v√¨ t·ª± ƒë·ªông chuy·ªÉn
                    currentQuestionIndex++;
                    displaySentenceQuestion();
                }, 3000);
            }
        }

        function loadPart3() {
            currentQuestionIndex = 0;
            pinyinVisible = false; 
            showPinyinBtnEl.textContent = "Hi·ªán Pinyin"; 
            showSection('part3');
            displayReadingQuestion();
            updateHint("ƒê·ªçc k·ªπ ƒëo·∫°n h·ªôi tho·∫°i v√† ch·ªçn ƒë√°p √°n ƒë√∫ng nh√©! ü§î");
        }
        
        function togglePinyin() {
            pinyinVisible = !pinyinVisible;
            displayDialogueContent(); 
            showPinyinBtnEl.textContent = pinyinVisible ? "·∫®n Pinyin" : "Hi·ªán Pinyin";
        }

        function displayDialogueContent() { 
            const hanziLines = readingContent.dialogueHanzi.split('\n');
            const pinyinLines = readingContent.dialoguePinyin.split('\n');
            let htmlOutput = "";

            for (let i = 0; i < hanziLines.length; i++) {
                if (hanziLines[i].trim() === "") { 
                    htmlOutput += "<br>"; 
                    continue;
                }
                htmlOutput += `<div class="hanzi-line">${hanziLines[i]}</div>`;
                if (pinyinVisible && pinyinLines[i]) { 
                    htmlOutput += `<div class="pinyin-dialogue-line">${pinyinLines[i]}</div>`;
                }
            }
            p3DialogueEl.innerHTML = htmlOutput;
        }

        function displayReadingQuestion() {
            displayDialogueContent(); 
            p3VietTranslationOnErrorEl.textContent = ''; 

            if (currentQuestionIndex < readingContent.questions.length) {
                const currentQ = readingContent.questions[currentQuestionIndex];
                p3QuestionTextEl.textContent = currentQ.questionText;
                p3OptionsEl.innerHTML = '';
                currentQ.options.forEach((option, index) => {
                    const optButton = document.createElement('button');
                    optButton.textContent = `${String.fromCharCode(65 + index)}. ${option.text} (${option.pinyin})`;
                    optButton.onclick = () => checkPart3Answer(option.correct, currentQ.vietMeaning);
                    p3OptionsEl.appendChild(optButton);
                });
                p3FeedbackEl.textContent = '';
            } else {
                // alert("Ho√†n th√†nh Ph·∫ßn 3! üéâ");
                nextPart();
            }
        }
        
        function checkPart3Answer(isCorrect, vietMeaning) {
            if (isCorrect) {
                p3FeedbackEl.innerHTML = "Tuy·ªát v·ªùi! <span class='cute-icon'>‚úÖ</span>";
                p3FeedbackEl.className = 'feedback correct';
                score++;
                setTimeout(() => {
                    currentQuestionIndex++;
                    displayReadingQuestion();
                }, 1000);
            } else {
                p3FeedbackEl.innerHTML = "Kh√¥ng ƒë√∫ng r·ªìi <span class='cute-icon'>‚ùå</span>.";
                p3FeedbackEl.className = 'feedback incorrect';
                p3VietTranslationOnErrorEl.textContent = `G·ª£i √Ω nghƒ©a c√¢u h·ªèi: ${vietMeaning}`;
                errors++;
                const currentQ = readingContent.questions[currentQuestionIndex];
                const correctOpt = currentQ.options.find(opt => opt.correct);
                errorDetailsList.push({ part: 3, question: currentQ.questionText, correctAnswer: correctOpt.text, yourAnswer: ' l·ª±a ch·ªçn sai' }); // C·∫ßn l·∫•y c√¢u tr·∫£ l·ªùi c·ªßa ng∆∞·ªùi d√πng
                 setTimeout(() => { 
                    currentQuestionIndex++;
                    displayReadingQuestion();
                }, 3000);
            }
        }

        function showSummary() {
            stopTimer();
            showSection('summaryPage');
            totalTimeEl.textContent = timerDisplay.textContent.replace('Th·ªùi gian: ', '');
            correctAnswersEl.textContent = score;
            incorrectAnswersEl.textContent = errors;
            
            errorDetailsEl.innerHTML = ''; 
            if (errorDetailsList.length > 0) {
                errorDetailsList.forEach(err => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>Ph·∫ßn ${err.part}</strong> - ${err.question}: B·∫°n ch·ªçn <span class="error-detail">${err.yourAnswer}</span>. ƒê√°p √°n ƒë√∫ng: <strong>${err.correctAnswer}</strong>`;
                    errorDetailsEl.appendChild(li);
                });
            } else {
                errorDetailsEl.innerHTML = "<li>B·∫°n kh√¥ng m·∫Øc l·ªói n√†o! Xu·∫•t s·∫Øc! <span class='cute-icon'>üåü</span></li>";
            }
            // nextPartButton.style.display = 'none'; // ƒê√£ x√≥a
            updateHint("Xem l·∫°i k·∫øt qu·∫£ c·ªßa m√¨nh n√†o! B·∫°n ƒë√£ l√†m r·∫•t t·ªët! üòä");
        }

        function nextPart() {
            // H√†m n√†y gi·ªù ch·ªâ ƒë∆∞·ª£c g·ªçi khi m·ªôt ph·∫ßn ho√†n th√†nh
            currentPart++;
            currentQuestionIndex = 0; 

            // B·ªè qua logic ki·ªÉm tra currentPart === 1 && document.getElementById('startPage').classList.contains('active')
            // v√¨ startGame s·∫Ω tr·ª±c ti·∫øp g·ªçi loadPart1()
            if (currentPart === 2) { // Sau khi Ph·∫ßn 1 ho√†n th√†nh
                loadPart2();
            } else if (currentPart === 3) { // Sau khi Ph·∫ßn 2 ho√†n th√†nh
                loadPart3();
            } else if (currentPart >= 4) { // Sau khi Ph·∫ßn 3 ho√†n th√†nh
                showSummary();
            }
        }

        // Kh·ªüi t·∫°o tr√≤ ch∆°i
        showSection('startPage');
        // nextPartButton.style.display = 'none'; // ƒê√£ x√≥a

    </script>
</body>
</html>