<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrÃ² ChÆ¡i Ã”n Táº­p Tiáº¿ng Trung - BÃ i 13: è¿™æ˜¯ä¸æ˜¯ä¸­è¯ï¼Ÿ</title>
    <style>
        :root {
            --primary-color: #4A90E2; /* MÃ u xanh dÆ°Æ¡ng hiá»‡n Ä‘áº¡i */
            --secondary-color: #50E3C2; /* MÃ u xanh ngá»c lam */
            --success-color: #7ED321; /* Xanh lÃ¡ cÃ¢y tÆ°Æ¡i sÃ¡ng */
            --warning-color: #F5A623; /* VÃ ng cam */
            --danger-color: #D0021B; /* Äá» */
            --light-color: #FDFDFD;
            --dark-color: #4A4A4A;
            --font-family: 'Helvetica Neue', Arial, sans-serif;
            --cute-yellow: #FFFACD; /* Lemon Chiffon */
            --cute-green: #98FB98; /* PaleGreen */
        }

        body {
            font-family: var(--font-family);
            background-color: #F4F7F6; /* Ná»n xÃ¡m ráº¥t nháº¡t */
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--dark-color);
            line-height: 1.7; /* TÄƒng line-height cho dá»… Ä‘á»c */
        }

        .game-container {
            background-color: var(--light-color);
            padding: 25px 35px;
            border-radius: 16px; /* Bo trÃ²n nhiá»u hÆ¡n */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* BÃ³ng Ä‘á»• má»m máº¡i hÆ¡n */
            width: 100%;
            max-width: 950px; /* Rá»™ng hÆ¡n cho nhiá»u ná»™i dung */
            box-sizing: border-box;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInGame 0.6s ease-out forwards 0.2s; /* Delay animation má»™t chÃºt */
        }

        @keyframes fadeInGame {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1, h2, h3 {
            text-align: center;
            font-weight: 600; /* Chá»¯ Ä‘áº­m vá»«a pháº£i */
        }
        h1 { color: var(--primary-color); font-size: 2.1em; margin-bottom: 15px; }
        h2 { color: var(--secondary-color); font-size: 1.7em; margin-top: 35px; margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); padding-bottom: 8px; }
        h3 { color: var(--dark-color); font-size: 1.4em; margin-top: 25px; margin-bottom: 15px; }

        .game-section {
            margin-bottom: 35px;
            padding: 20px;
            border: 1px solid #EAEAEA;
            border-radius: 12px;
            background-color: #FFFFFF; /* Ná»n tráº¯ng cho cÃ¡c section */
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .game-section.hidden { display: none; }

        .status-bar {
            display: flex;
            justify-content: space-around; /* CÃ¡ch Ä‘á»u cÃ¡c item */
            align-items: center;
            padding: 12px 15px;
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color)); /* Gradient background */
            color: white;
            border-radius: 10px;
            margin-bottom: 25px;
            font-size: 1.15em;
            box-shadow: 0 4px 10px rgba(74,144,226,0.3);
        }
        #timer, #score-display { font-weight: bold; }

        .instruction-text {
            font-size: 1.05em;
            color: #555;
            margin-bottom: 15px;
            background-color: var(--cute-yellow);
            padding: 12px 18px;
            border-radius: 8px;
            border-left: 5px solid var(--warning-color);
        }
        .instruction-text i { margin-right: 7px; font-style: normal; }

        /* Pháº§n 1: Ná»‘i chá»¯ HÃ¡n */
        .matching-game table {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0 5px; 
        }
        .matching-game th, .matching-game td {
            border: 1px solid #E0E0E0;
            padding: 10px 12px; 
            text-align: left;
        }
        .matching-game th {
            background-color: #F5F5F5;
            font-weight: 600;
        }
        .matching-game td:first-child { border-top-left-radius: 6px; border-bottom-left-radius: 6px;}
        .matching-game td:last-child { border-top-right-radius: 6px; border-bottom-right-radius: 6px;}

        .matching-game select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #CCC;
            width: 95%;
            box-sizing: border-box;
            font-size: 1em;
        }
        .pinyin-column span.pinyin-text { display: none; } /* áº¨n pinyin ban Ä‘áº§u */
        .pinyin-column span.pinyin-text.visible { display: inline; } /* Hiá»‡n khi cÃ³ class visible */


        /* Pháº§n 2: Tá»« vá»±ng vÃ  LÆ°á»£ng tá»« */
        .image-vocab-item { margin-bottom: 15px; text-align: center;}
        .image-vocab-item img { max-width: 120px; max-height: 90px; border: 1px solid #eee; border-radius: 6px; margin-bottom: 8px; }
        .image-vocab-item input[type="text"] { width: 150px; text-align: center; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        .image-vocab-item .pinyin-hint { font-size: 0.9em; color: #777; display: none; } /* áº¨n pinyin hint ban Ä‘áº§u */
        .image-vocab-item .pinyin-hint.visible { display: block; margin-top: 5px; }


        .quantifier-fill-item { margin-bottom: 10px; display: flex; align-items: center; }
        .quantifier-fill-item input[type="text"], .quantifier-fill-item select {
            width: 70px; text-align: center; margin: 0 8px; padding: 6px;
            border: 1px solid #ccc; border-radius: 5px;
        }

        /* Pháº§n 3: Máº«u cÃ¢u */
        .sentence-fill-item { margin-bottom: 15px; }
        .sentence-fill-item .options-inline button {
            margin: 0 5px 5px 0; padding: 6px 10px; font-size: 0.95em;
            border: 1px solid var(--primary-color); background-color: white; color: var(--primary-color);
            border-radius: 15px; cursor: pointer;
        }
        .sentence-fill-item .options-inline button.selected { background-color: var(--secondary-color); color: white; border-color: var(--secondary-color); }
        .sentence-fill-item .blank {
            display: inline-block; width: 80px; height: 20px;
            border-bottom: 2px solid var(--primary-color); margin: 0 5px;
            text-align: center; font-weight: bold; color: var(--danger-color);
        }
        .qna-item textarea { width: 95%; min-height: 40px; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        .youmeiyou-item { margin-bottom: 10px; }
        .youmeiyou-item input[type="text"] { width: 60px; text-align: center; margin: 0 5px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;}


        /* Pháº§n 4: Äá»c hiá»ƒu */
        .reading-comprehension .passage {
            background-color: #F9F9F9; padding: 15px; border-radius: 8px;
            margin-bottom: 15px; line-height: 1.8;
        }
        .reading-comprehension .question-item textarea { width: 95%; min-height: 30px; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }

        /* Pháº§n 5: MiÃªu táº£ */
        .describe-luggage-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .describe-luggage-item label { min-width: 50px; }
        .describe-luggage-item input[type="text"] { flex-grow: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }


        /* Chung */
        .feedback { margin-top: 8px; font-style: italic; font-size: 0.95em; }
        .feedback.correct { color: var(--success-color); }
        .feedback.incorrect { color: var(--danger-color); }

        .action-button, .toggle-pinyin-btn {
            padding: 12px 28px; 
            font-size: 1.15em; 
            color: white;
            border: none;
            border-radius: 28px; 
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 25px auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .action-button { background-image: linear-gradient(to right, var(--success-color), #5CB85C); }
        .toggle-pinyin-btn {
            background-image: linear-gradient(to right, var(--warning-color), #f0ad4e);
            font-size: 0.95em; padding: 10px 20px; margin-top: 10px;
        }

        .action-button:hover, .toggle-pinyin-btn:hover {
            transform: translateY(-3px) scale(1.03); 
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        .action-button:active, .toggle-pinyin-btn:active {
            transform: translateY(-1px) scale(1.01);
        }
        .action-button.next-section-btn { background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color)); }


        #final-summary {
            padding: 25px;
            background-color: var(--light-color);
            border: 3px solid var(--secondary-color); 
            border-radius: 12px;
            margin-top: 35px;
        }
        #final-summary h2 { color: var(--primary-color); }
        #final-summary ul { list-style-type: none; padding-left: 0; }
        #final-summary li { margin-bottom: 10px; padding: 8px 12px; border-radius: 6px; font-size: 1.05em; }
        #final-summary li.correct-ans { background-color: #E9F7EF; color: #1D6F42; border-left: 4px solid var(--success-color); }
        #final-summary li.incorrect-ans { background-color: #FDEDED; color: #A94442; border-left: 4px solid var(--danger-color); }
        #final-summary li.incorrect-ans .user-answer { text-decoration: line-through; margin-right: 8px;}
        #final-summary li .correct-value { font-weight: bold; color: #333; }

    </style>
</head>
<body>
    <div class="game-container">
        <h1>ä½ å¥½! ChÃ o má»«ng em Ä‘áº¿n vá»›i TrÃ² ChÆ¡i Ã”n Táº­p BÃ i 13: è¿™æ˜¯ä¸æ˜¯ä¸­è¯ï¼Ÿ ğŸ’Š</h1>
        <p style="text-align:center; font-size: 1.1em; color: var(--secondary-color);">
            è€å¸ˆ Ä‘Ã£ chuáº©n bá»‹ cÃ¡c thá»­ thÃ¡ch thÃº vá»‹ Ä‘á»ƒ giÃºp em Ã´n láº¡i kiáº¿n thá»©c bÃ i nÃ y. Cá»‘ gáº¯ng lÃªn nhÃ©! åŠ æ²¹! ğŸ’ª
        </p>

        <div class="status-bar">
            <div id="timer">â³ Thá»i gian: 00:00:00</div>
            <div id="score-display">Äiá»ƒm: 0</div>
        </div>

        <div id="section-hanzi" class="game-section">
            <h2>I. è®¤æ±‰å­— (RÃ¨n HÃ nzÃ¬ - Nháº­n biáº¿t chá»¯ HÃ¡n)</h2>
            <div id="hanzi-matching">
                <h3>1. æŠŠæ±‰å­—å’Œæ‹¼éŸ³è¿èµ·æ¥ (Ná»‘i chá»¯ HÃ¡n vÃ  phiÃªn Ã¢m):</h3>
                <p class="instruction-text">ğŸ’¡ HÃ£y chá»n phiÃªn Ã¢m (Pinyin) chÃ­nh xÃ¡c cho má»—i chá»¯ HÃ¡n trong báº£ng dÆ°á»›i Ä‘Ã¢y. Nháº¥n nÃºt "ğŸ’¡ Hiá»‡n/áº¨n Pinyin" Ä‘á»ƒ xem hoáº·c áº©n gá»£i Ã½ Pinyin cho cÃ¡c lá»±a chá»n nhÃ©!</p>
                <button class="toggle-pinyin-btn" onclick="togglePinyinVisibility('hanzi-matching-body', 'pinyin-text')">ğŸ’¡ Hiá»‡n/áº¨n Pinyin ÄÃ¡p Ãn</button>
                <table class="matching-game">
                    <thead><tr><th>æ±‰å­— (HÃ nzÃ¬)</th><th class="pinyin-column">æ‹¼éŸ³ (PÄ«nyÄ«n) - Chá»n</th><th>Káº¿t quáº£</th></tr></thead>
                    <tbody id="hanzi-matching-body"></tbody>
                </table>
                <button onclick="checkHanziMatching_B13()" class="action-button" style="background-image: linear-gradient(to right, var(--warning-color), #F0AD4E); margin-top:15px;">Kiá»ƒm tra Ná»‘i Tá»«</button>
            </div>
            </div>

        <div id="section-vocab-quantifier" class="game-section hidden">
            <h2>II. ç”Ÿè¯å’Œé‡è¯ (ShÄ“ngcÃ­ hÃ© LiÃ ngcÃ­ - Tá»« vá»±ng vÃ  LÆ°á»£ng tá»«)</h2>
            <div id="image-vocab-writing">
                <h3>1. çœ‹å›¾å†™è¯è¯­ (NhÃ¬n hÃ¬nh viáº¿t tá»«):</h3>
                <p class="instruction-text">ğŸ–¼ï¸ (è€å¸ˆ sáº½ sá»›m thÃªm hÃ¬nh áº£nh minh há»a nhÃ©!) HÃ£y viáº¿t tá»« tiáº¿ng Trung (HÃ¡n tá»±) tÆ°Æ¡ng á»©ng vá»›i gá»£i Ã½ Pinyin bÃªn dÆ°á»›i. Nháº¥n "ğŸ’¡ Hiá»‡n/áº¨n Pinyin Gá»£i Ã" náº¿u cáº§n!</p>
                <button class="toggle-pinyin-btn" onclick="togglePinyinVisibility('image-vocab-writing', 'pinyin-hint')">ğŸ’¡ Hiá»‡n/áº¨n Pinyin Gá»£i Ã</button>
                </div>
            <div id="quantifier-fill" style="margin-top: 25px;">
                <h3>2. ç”¨æ­£ç¡®çš„é‡è¯å¡«ç©º (DÃ¹ng lÆ°á»£ng tá»« Ä‘Ãºng Ä‘iá»n vÃ o chá»— trá»‘ng):</h3>
                <p class="instruction-text">ğŸ“ Chá»n hoáº·c Ä‘iá»n lÆ°á»£ng tá»« (measure word) phÃ¹ há»£p vÃ o má»—i chá»— trá»‘ng.</p>
                </div>
        </div>

        <div id="section-sentence-practice" class="game-section hidden">
            <h2>III. å¥å‹ç»ƒä¹  (JÃ¹xÃ­ng LiÃ nxÃ­ - Luyá»‡n táº­p máº«u cÃ¢u)</h2>
            <div id="sentence-fill-blanks">
                <h3>1. é€‰æ‹©åˆé€‚çš„è¯è¯­å¡«ç©º (Chá»n tá»« thÃ­ch há»£p Ä‘iá»n vÃ o chá»— trá»‘ng):</h3>
                <p class="instruction-text">ğŸ¤” HÃ£y chá»n tá»« Ä‘Ãºng trong cÃ¡c lá»±a chá»n Ä‘á»ƒ hoÃ n thÃ nh cÃ¡c cÃ¢u sau.</p>
                </div>
            <div id="sentence-qna" style="margin-top: 25px;">
                <h3>2. å›ç­”é—®é¢˜ (Tráº£ lá»i cÃ¢u há»i):</h3>
                <p class="instruction-text">ğŸ’¬ DÃ¹ng kiáº¿n thá»©c Ä‘Ã£ há»c Ä‘á»ƒ tráº£ lá»i cÃ¡c cÃ¢u há»i nÃ y báº±ng tiáº¿ng Trung nhÃ©! (Pháº§n nÃ y è€å¸ˆ sáº½ nháº­n xÃ©t sau nha ğŸ˜Š)</p>
                </div>
            <div id="sentence-completion-youmeiyou" style="margin-top: 25px;">
                <h3>3. ç”¨ "æœ‰" æˆ– "æ²¡æœ‰" å®Œæˆå¥å­ (DÃ¹ng "cÃ³" hoáº·c "khÃ´ng cÃ³" hoÃ n thÃ nh cÃ¢u):</h3>
                <p class="instruction-text">âœï¸ HoÃ n thÃ nh cÃ¡c cÃ¢u sau báº±ng cÃ¡ch Ä‘iá»n "æœ‰ (yÇ’u)" hoáº·c "æ²¡æœ‰ (mÃ©iyÇ’u)".</p>
                </div>
        </div>

        <div id="section-reading" class="game-section hidden">
            <h2>IV. é˜…è¯»ç†è§£ (YuÃ¨dÃº LÇjiÄ› - Äá»c hiá»ƒu)</h2>
            <div class="reading-comprehension">
                <h3>è¯¾æ–‡ (KÃ¨wÃ©n):</h3>
                <div class="passage">
                    A: ä½ æ²¡æœ‰ç®±å­å—ï¼Ÿ<br>
                    B: æœ‰å•Šã€‚æˆ‘çš„åœ¨è¿™å„¿å‘¢ã€‚<br>
                    A: æˆ‘çš„å¾ˆé‡ï¼Œä½ çš„é‡ä¸é‡ï¼Ÿ<br>
                    B: è¿™ä¸ªé»‘çš„å¾ˆé‡ï¼Œé‚£ä¸ªçº¢çš„æ¯”è¾ƒè½»ã€‚<br>
                    A: ä½ çš„ç®±å­å¾ˆæ–°ï¼Œæˆ‘çš„å¾ˆæ—§ã€‚<br>
                    B: é‚£ä¸ªæ–°çš„æ˜¯æœ‹å‹çš„ã€‚è¿™ä¸ªæ—§çš„æ˜¯æˆ‘çš„ã€‚
                </div>
                <h3>æ ¹æ®è¯¾æ–‡å›ç­”é—®é¢˜ (Dá»±a vÃ o Ä‘oáº¡n vÄƒn tráº£ lá»i cÃ¢u há»i):</h3>
                <p class="instruction-text">ğŸ“– Äá»c ká»¹ Ä‘oáº¡n há»™i thoáº¡i vÃ  tráº£ lá»i cÃ¡c cÃ¢u há»i báº±ng tiáº¿ng Trung. (Pháº§n nÃ y è€å¸ˆ sáº½ xem vÃ  gÃ³p Ã½ cho em sau nhÃ©!)</p>
                </div>
        </div>

        <div id="section-describe-luggage" class="game-section hidden">
            <h2>V. æè¿°ä½ çš„è¡Œæ (MiÃ¡oshÃ¹ nÇ de xÃ­nglÇ - MiÃªu táº£ hÃ nh lÃ½ cá»§a báº¡n)</h2>
            <p class="instruction-text">ğŸ’ Náº¿u Ä‘i du lá»‹ch, em sáº½ mang theo nhá»¯ng gÃ¬? HÃ£y liá»‡t kÃª 5 thá»©, mÃ u sáº¯c cá»§a chÃºng vÃ  khi nÃ o em dÃ¹ng Ä‘áº¿n chÃºng báº±ng tiáº¿ng Trung nhÃ©! (Pháº§n nÃ y Ä‘á»ƒ em tá»± do sÃ¡ng táº¡o, è€å¸ˆ sáº½ giÃºp em sá»­a sau nha!)</p>
            <div id="luggage-description-area">
                </div>
        </div>

        <button id="next-section-button" class="action-button next-section-btn" onclick="nextSection()">Tiáº¿p tá»¥c pháº§n sau ğŸš€</button>
        <button id="finish-game-button" class="action-button hidden" onclick="showFinalSummary_B13()">HoÃ n ThÃ nh & Xem Káº¿t Quáº£ ğŸ‰</button>

        <div id="final-summary" class="hidden">
            <h2>âœ¨ Báº£ng Tá»•ng Káº¿t ThÃ nh TÃ­ch âœ¨</h2>
            <p>ChÃºc má»«ng em Ä‘Ã£ hoÃ n thÃ nh táº¥t cáº£ cÃ¡c thá»­ thÃ¡ch! CÃ¹ng xem láº¡i káº¿t quáº£ nÃ o:</p>
            <p><strong>Tá»•ng thá»i gian lÃ m bÃ i:</strong> <span id="total-time-taken"></span></p>
            <p><strong>Tá»•ng Ä‘iá»ƒm:</strong> <span id="total-score"></span></p>
            <h3>Chi tiáº¿t cÃ¡c cÃ¢u tráº£ lá»i:</h3>
            <ul id="summary-details"></ul>
            <button onclick="restartGame()" class="action-button" style="background-image: linear-gradient(to right, var(--primary-color), #5BC0DE);">ChÆ¡i Láº¡i Tá»« Äáº§u ğŸ”</button>
        </div>
    </div>

    <script>
        // --- Dá»¯ liá»‡u cho trÃ² chÆ¡i BÃ i 13 ---
        const hanziMatchingData_B13 = [
            { id: 1, hanzi: "è¯", pinyin: "yÃ o" },
            { id: 2, hanzi: "ç®±å­", pinyin: "xiÄngzi" },
            { id: 3, hanzi: "é‡", pinyin: "zhÃ²ng" },
            { id: 4, hanzi: "è½»", pinyin: "qÄ«ng" },
            { id: 5, hanzi: "æ–°", pinyin: "xÄ«n" },
            { id: 6, hanzi: "æ—§", pinyin: "jiÃ¹" },
            { id: 7, hanzi: "èˆ’æœ", pinyin: "shÅ«fu" },
            { id: 8, hanzi: "è¡£æœ", pinyin: "yÄ«fu" },
            { id: 9, hanzi: "é¢œè‰²", pinyin: "yÃ¡nsÃ¨" },
            { id: 10, hanzi: "é‡Œè¾¹", pinyin: "lÇbian" }
        ];

        // Dá»¯ liá»‡u cho "NhÃ¬n nghÄ©a, viáº¿t chá»¯ HÃ¡n vÃ  phiÃªn Ã¢m" Ä‘Ã£ Ä‘Æ°á»£c bá»

        const imageVocabData_B13 = [
            { id: 'iv1', image_placeholder: "Thuá»‘c Báº¯c", answer: "ä¸­è¯", pinyin_hint: "zhÅngyÃ o" },
            { id: 'iv2', image_placeholder: "Thuá»‘c TÃ¢y", answer: "è¥¿è¯", pinyin_hint: "xÄ«yÃ o" },
            { id: 'iv3', image_placeholder: "Vali", answer: "è¡Œæç®±", pinyin_hint: "xÃ­nglÇxiÄng" },
            { id: 'iv4', image_placeholder: "BÃ n cháº£i", answer: "ç‰™åˆ·", pinyin_hint: "yÃ¡shuÄ" },
            { id: 'iv5', image_placeholder: "Ão quáº§n", answer: "è¡£æœ", pinyin_hint: "yÄ«fu" },
            { id: 'iv6', image_placeholder: "Ã”/DÃ¹", answer: "é›¨ä¼", pinyin_hint: "yÇ”sÇn" },
            { id: 'iv7', image_placeholder: "Äiá»‡n thoáº¡i", answer: "æ‰‹æœº", pinyin_hint: "shÇ’ujÄ«" },
            { id: 'iv8', image_placeholder: "Kem chá»‘ng náº¯ng", answer: "é˜²æ™’éœœ", pinyin_hint: "fÃ¡ngshÃ ishuÄng" }
        ];

        const quantifierFillData_B13 = [
            { id: 'qf1', sentence_before: "ä¸€", sentence_after: "è¡£æœ (yÄ«fu)", answer: "ä»¶", options: ["ä»¶", "æŠŠ", "æœ¬", "å¼ "] },
            { id: 'qf2', sentence_before: "ä¸€", sentence_after: "é›¨ä¼ (yÇ”sÇn)", answer: "æŠŠ", options: ["ä»¶", "æŠŠ", "æœ¬", "å¼ "] },
            { id: 'qf3', sentence_before: "ä¸€", sentence_after: "è¯å…¸ (cÃ­diÇn)", answer: "æœ¬", options: ["ä»¶", "æŠŠ", "æœ¬", "å¼ "] },
            { id: 'qf4', sentence_before: "å››", sentence_after: "é“¶è¡Œå¡ (yÃ­nhÃ¡ngkÇ)", answer: "å¼ ", options: ["ä»¶", "æŠŠ", "æœ¬", "å¼ "] },
            { id: 'qf5', sentence_before: "ä¸€", sentence_after: "ç¬” (bÇ)", answer: "æ”¯", options: ["æ”¯", "å°", "æ¡", "ç“¶"] },
            { id: 'qf6', sentence_before: "ä¸€", sentence_after: "ç”µè„‘ (diÃ nnÇo)", answer: "å°", options: ["æ”¯", "å°", "æ¡", "ç“¶"] },
            { id: 'qf7', sentence_before: "ä¸€", sentence_after: "ç‰™åˆ· (yÃ¡shuÄ)", answer: "æŠŠ", options: ["æ”¯", "å°", "æ¡", "æŠŠ"] },
            { id: 'qf8', sentence_before: "ä¸¤", sentence_after: "å•¤é…’ (pÃ­jiÇ”)", answer: "ç“¶", options: ["æ”¯", "å°", "æ¡", "ç“¶"] },
            { id: 'qf9', sentence_before: "ä¸‰", sentence_after: "é“…ç¬” (qiÄnbÇ)", answer: "æ”¯", options: ["æ”¯", "å°", "æ¡", "ç“¶"] },
            { id: 'qf10', sentence_before: "ä¸€", sentence_after: "è£¤å­ (kÃ¹zi)", answer: "æ¡", options: ["æ”¯", "å°", "æ¡", "ç“¶"] },
            { id: 'qf11', sentence_before: "å¾ˆå¤š", sentence_after: "å°é¸Ÿ (xiÇo niÇo)", answer: "åª", options: ["åª", "ç¾¤", "ä¸ª", "æ¡"] },
            { id: 'qf12', sentence_before: "ä¸€", sentence_after: "é¦™æ°´ (xiÄngshuÇ)", answer: "ç“¶", options: ["åª", "æ»´", "ä¸ª", "ç“¶"] }
        ];

        const sentenceFillBlanksData_B13 = [
            { id: 'sf1', sentence_parts: ["æˆ‘çš„ç®±å­å¾ˆ ", "ï¼Œä½ çš„ç®±å­æ¯”è¾ƒ ", "ã€‚"], options: ["é‡", "è½»"], answers: ["é‡", "è½»"] },
            { id: 'sf2', sentence_parts: ["è¿™ä»¶è¡£æœæ˜¯ ", " çš„ï¼Œé‚£ä»¶æ˜¯ ", " çš„ã€‚"], options: ["æ–°", "æ—§"], answers: ["æ–°", "æ—§"] },
            { id: 'sf3', sentence_parts: ["æˆ‘å–œæ¬¢ ", " è“è‰²çš„ï¼Œä¸å–œæ¬¢ ", " è“è‰²çš„ã€‚"], options: ["æ·±", "æµ…"], answers: ["æ·±", "æµ…"] },
            { id: 'sf4', sentence_parts: ["æˆ‘ç”Ÿç—…äº†ï¼Œè§‰å¾—å¾ˆ ", "ã€‚"], options: ["èˆ’æœ", "ä¸èˆ’æœ"], answers: ["ä¸èˆ’æœ"] },
            { id: 'sf5', sentence_parts: ["ä½ å–œæ¬¢åƒ ", " è¿˜æ˜¯ ", "ï¼Ÿ"], options: ["ä¸­è¯", "è¥¿è¯"], answers: ["ä¸­è¯", "è¥¿è¯"] },
            { id: 'sf6', sentence_parts: ["æˆ‘çš„æ‰‹æœºåœ¨ç®±å­", "ã€‚"], options: ["é‡Œè¾¹", "ä¸Šé¢", "æ—è¾¹"], answers: ["é‡Œè¾¹"] }
        ];

        const sentenceQnAData_B13 = [
            { id: 'qna1_b13', question: "ä½ ç”Ÿç—…çš„æ—¶å€™ï¼Œè§‰å¾—æ€ä¹ˆæ ·ï¼Ÿ", exampleAnswer: "æˆ‘è§‰å¾—ä¸èˆ’æœï¼Œå¤´ç–¼ã€‚" },
            { id: 'qna2_b13', question: "ä½ çš„ç®±å­é‡Œæœ‰ä»€ä¹ˆä¸œè¥¿ï¼Ÿ (å†™ä¸¤æ ·ä¸œè¥¿)", exampleAnswer: "æˆ‘çš„ç®±å­é‡Œæœ‰è¡£æœå’Œä¹¦ã€‚" },
            { id: 'qna3_b13', question: "è¿™ä¸ªé»‘ç®±å­é‡ä¸é‡ï¼Ÿ", exampleAnswer: "è¿™ä¸ªé»‘ç®±å­å¾ˆé‡ / ä¸é‡ã€‚" },
            { id: 'qna4_b13', question: "ä½ çš„æ‰‹æœºæ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ", exampleAnswer: "æˆ‘çš„æ‰‹æœºæ˜¯é»‘è‰²çš„ã€‚" },
            { id: 'qna5_b13', question: "ä½ å–œæ¬¢ç”¨ä¸­è¯è¿˜æ˜¯è¥¿è¯ï¼Ÿ", exampleAnswer: "æˆ‘å–œæ¬¢ç”¨è¥¿è¯ã€‚" }
        ];

        const youMeiyouData_B13 = [
            { id: 'ym1', parts: ["æˆ‘ ", " ä¸€ä¸ªæ–°æ‰‹æœºã€‚"], answer: "æœ‰" },
            { id: 'ym2', parts: ["ä»– ", " ä¸­è¯ï¼Œä»–æœ‰è¥¿è¯ã€‚"], answer: "æ²¡æœ‰" },
            { id: 'ym3', parts: ["å¦¹å¦¹ ", " è‹±è¯­ä¹¦å—ï¼Ÿå¥¹ ", " è‹±è¯­ä¹¦ã€‚"], answers: ["æœ‰", "æœ‰"] },
            { id: 'ym4', parts: ["ç®±å­é‡Œ ", " è¡£æœï¼Œä½†æ˜¯ ", " é›¨ä¼ã€‚"], answers: ["æœ‰", "æ²¡æœ‰"] }
        ];

        const readingQuestions_B13 = [
            { id: 'rq1', question: "B æœ‰ç®±å­å—ï¼Ÿ", correctAnswer: "æœ‰å•Šã€‚/ æœ‰ã€‚" },
            { id: 'rq2', question: "A çš„ç®±å­é‡ä¸é‡ï¼Ÿ", correctAnswer: "Açš„ç®±å­å¾ˆé‡ã€‚" },
            { id: 'rq3', question: "B æœ‰å‡ ä¸ªç®±å­ï¼Ÿå®ƒä»¬æ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ", correctAnswer: "Bæœ‰ä¸¤ä¸ªç®±å­ï¼Œä¸€ä¸ªæ˜¯é»‘çš„ï¼Œä¸€ä¸ªæ˜¯çº¢çš„ã€‚" },
            { id: 'rq4', question: "çº¢è‰²çš„ç®±å­æ€ä¹ˆæ ·ï¼Ÿ", correctAnswer: "çº¢è‰²çš„ç®±å­æ¯”è¾ƒè½»ã€‚" },
            { id: 'rq5', question: "B çš„æ–°ç®±å­æ˜¯è°çš„ï¼Ÿæ—§ç®±å­å‘¢ï¼Ÿ", correctAnswer: "Bçš„æ–°ç®±å­æ˜¯æœ‹å‹çš„ï¼Œæ—§ç®±å­æ˜¯ä»–çš„ã€‚" }
        ];

        let currentSectionIndex_B13 = 0;
        const sections_B13 = ['section-hanzi', 'section-vocab-quantifier', 'section-sentence-practice', 'section-reading', 'section-describe-luggage'];
        let score_B13 = 0;
        let timerInterval_B13;
        let secondsElapsed_B13 = 0;
        let userAnswers_B13 = {};

        document.addEventListener('DOMContentLoaded', () => {
            populateHanziMatching_B13();
            populateImageVocabWriting_B13();
            populateQuantifierFill_B13();
            populateSentenceFillBlanks_B13();
            populateSentenceQnA_B13();
            populateYouMeiyou_B13();
            populateReadingQuestions_B13();
            populateDescribeLuggage_B13();

            showSection_B13(currentSectionIndex_B13);
            startTimer_B13();
            updateScoreDisplay_B13();
        });

        function startTimer_B13() {
            if (timerInterval_B13) clearInterval(timerInterval_B13);
            secondsElapsed_B13 = 0;
            document.getElementById('timer').textContent = `â³ Thá»i gian: ${formatTime_B13(secondsElapsed_B13)}`;
            timerInterval_B13 = setInterval(() => {
                secondsElapsed_B13++;
                document.getElementById('timer').textContent = `â³ Thá»i gian: ${formatTime_B13(secondsElapsed_B13)}`;
            }, 1000);
        }
        function formatTime_B13(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        function updateScoreDisplay_B13() {
             document.getElementById('score-display').textContent = `Äiá»ƒm: ${score_B13}`;
        }
        function updateScore_B13(points) {
            score_B13 += points;
            updateScoreDisplay_B13();
        }

        function showSection_B13(index) {
            document.querySelectorAll('.game-section').forEach(sec => sec.classList.add('hidden'));
            const currentSectionElement = document.getElementById(sections_B13[index]);
            if (currentSectionElement) {
                currentSectionElement.classList.remove('hidden');
            }

            const nextButton = document.getElementById('next-section-button');
            const finishButton = document.getElementById('finish-game-button');

            // UPDATED: Correctly hide "Next" button and show "Finish" button on the last section
            if (index >= sections_B13.length - 1) {
                if(nextButton) nextButton.style.display = 'none'; // Use style.display for more reliable hiding
                if(finishButton) finishButton.classList.remove('hidden');
            } else {
                if(nextButton) nextButton.style.display = 'block'; // Or 'inline-block' or 'flex' depending on original display
                if(finishButton) finishButton.classList.add('hidden');
            }
        }

        function nextSection() {
            currentSectionIndex_B13++;
            if (currentSectionIndex_B13 < sections_B13.length) {
                showSection_B13(currentSectionIndex_B13);
            }
            // No longer calls showFinalSummary_B13 here
        }
         function restartGame() {
            currentSectionIndex_B13 = 0;
            score_B13 = 0;
            userAnswers_B13 = {};
            updateScoreDisplay_B13();

            document.querySelectorAll('input[type="text"], textarea, select').forEach(input => {
                if(input.tagName === 'SELECT') input.selectedIndex = 0;
                else input.value = '';
                input.disabled = false;
                if(input.style) input.style.borderColor = '#ccc';
            });
            document.querySelectorAll('.feedback').forEach(fb => {fb.textContent = ''; fb.className = 'feedback';});
            document.querySelectorAll('.correct-hanzi').forEach(ch => ch.textContent = '');
             document.querySelectorAll('.pinyin-text.visible').forEach(p => p.classList.remove('visible'));
             document.querySelectorAll('.pinyin-hint.visible').forEach(p => p.classList.remove('visible'));


            document.querySelectorAll('.action-button, .show-answer-btn, .toggle-pinyin-btn').forEach(btn => btn.disabled = false);
            const hanziMatchingButton = document.querySelector('#hanzi-matching button.action-button');
             if(hanziMatchingButton) hanziMatchingButton.disabled = false;

            document.getElementById('final-summary').classList.add('hidden');
            showSection_B13(currentSectionIndex_B13);
            startTimer_B13();
        }

        function togglePinyinVisibility(containerId, pinyinClass) {
            const container = document.getElementById(containerId);
            if (container) {
                container.querySelectorAll(`.${pinyinClass}`).forEach(span => {
                    span.classList.toggle('visible');
                });
            }
        }

        function populateHanziMatching_B13() {
            const tbody = document.getElementById('hanzi-matching-body');
            tbody.innerHTML = '';
            const allPinyinsForOptions = shuffleArray_B13([...new Set(hanziMatchingData_B13.map(item => item.pinyin))]);

            hanziMatchingData_B13.forEach(item => {
                const row = tbody.insertRow();
                // Pinyin is now part of the first cell, initially hidden
                row.innerHTML = `
                    <td>${item.id}. ${item.hanzi} (<span class="pinyin-text">${item.pinyin}</span>)</td>
                    <td>
                        <select id="b13-pinyin-select-${item.id}">
                            <option value="">Chá»n Pinyin</option>
                            ${allPinyinsForOptions.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </td>
                    <td id="b13-match-feedback-${item.id}" class="feedback"></td>
                `;
            });
        }
        function shuffleArray_B13(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function populateImageVocabWriting_B13() {
            const container = document.getElementById('image-vocab-writing');
            // Clear previous content and add title/button
            container.innerHTML = '<h3>1. çœ‹å›¾å†™è¯è¯­ (NhÃ¬n hÃ¬nh viáº¿t tá»«):</h3> <p class="instruction-text">ğŸ–¼ï¸ (è€å¸ˆ sáº½ sá»›m thÃªm hÃ¬nh áº£nh minh há»a nhÃ©!) HÃ£y viáº¿t tá»« tiáº¿ng Trung (HÃ¡n tá»±) tÆ°Æ¡ng á»©ng vá»›i gá»£i Ã½ Pinyin bÃªn dÆ°á»›i. Nháº¥n "ğŸ’¡ Hiá»‡n/áº¨n Pinyin Gá»£i Ã" náº¿u cáº§n!</p> <button class="toggle-pinyin-btn" onclick="togglePinyinVisibility(\'image-vocab-writing\', \'pinyin-hint\')">ğŸ’¡ Hiá»‡n/áº¨n Pinyin Gá»£i Ã</button>';
            imageVocabData_B13.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'image-vocab-item';
                div.innerHTML = `
                    <img src="https://placehold.co/120x90/E8DDCB/000000?text=${encodeURIComponent(item.image_placeholder)}" alt="${item.image_placeholder}">
                    <input type="text" id="b13-iv-${item.id}" placeholder="æ±‰å­—">
                    <div><small class="pinyin-hint">${item.pinyin_hint}</small></div>
                    <button class="action-button" style="font-size:0.9em; padding: 6px 12px; margin-top:5px;" onclick="checkImageVocab_B13('${item.id}', '${item.answer}', this)">Kiá»ƒm tra</button>
                    <div id="b13-iv-feedback-${item.id}" class="feedback"></div>
                `;
                container.appendChild(div);
            });
        }

        function populateQuantifierFill_B13() {
            const container = document.getElementById('quantifier-fill');
            container.innerHTML = '<h3>2. ç”¨æ­£ç¡®çš„é‡è¯å¡«ç©º (DÃ¹ng lÆ°á»£ng tá»« Ä‘Ãºng Ä‘iá»n vÃ o chá»— trá»‘ng):</h3> <p class="instruction-text">ğŸ“ Chá»n hoáº·c Ä‘iá»n lÆ°á»£ng tá»« (measure word) phÃ¹ há»£p vÃ o má»—i chá»— trá»‘ng.</p>';
            quantifierFillData_B13.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'quantifier-fill-item';
                let inputHtml = '';
                if (item.options && item.options.length > 0) {
                    inputHtml = `<select id="b13-qf-${item.id}">
                                    <option value="">Chá»n</option>
                                    ${item.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                                 </select>`;
                } else {
                    inputHtml = `<input type="text" id="b13-qf-${item.id}" placeholder="é‡è¯">`;
                }
                div.innerHTML = `
                    <span>${item.sentence_before}</span>
                    ${inputHtml}
                    <span>${item.sentence_after}</span>
                    <button class="action-button" style="font-size:0.8em; padding: 5px 10px; margin-left:10px;" onclick="checkQuantifier_B13('${item.id}', '${item.answer}', this)">Kiá»ƒm tra</button>
                    <span id="b13-qf-feedback-${item.id}" class="feedback"></span>
                `;
                container.appendChild(div);
            });
        }

        function populateSentenceFillBlanks_B13(){
            const container = document.getElementById('sentence-fill-blanks');
            container.innerHTML = '<h3>1. é€‰æ‹©åˆé€‚çš„è¯è¯­å¡«ç©º (Chá»n tá»« thÃ­ch há»£p Ä‘iá»n vÃ o chá»— trá»‘ng):</h3><p class="instruction-text">ğŸ¤” HÃ£y chá»n tá»« Ä‘Ãºng trong cÃ¡c lá»±a chá»n Ä‘á»ƒ hoÃ n thÃ nh cÃ¡c cÃ¢u sau.</p>';
            sentenceFillBlanksData_B13.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'sentence-fill-item';
                let sentenceHtml = '';
                item.sentence_parts.forEach((part, i) => {
                    sentenceHtml += `<span>${part}</span>`;
                    if (i < item.answers.length) {
                        sentenceHtml += `<span id="b13-sf-blank-${item.id}-${i}" class="blank">(chá»n)</span>`;
                    }
                });

                div.innerHTML = `
                    <p><strong>CÃ¢u ${index + 1}:</strong> ${sentenceHtml}</p>
                    <div class="options-inline">
                        ${item.options.map(opt => `<button onclick="selectSentenceFillOption(this, '${item.id}', '${opt}')">${opt}</button>`).join('')}
                    </div>
                    <button onclick="checkSentenceFill_B13('${item.id}', this)" class="action-button" style="font-size:0.9em; padding: 8px 15px; background-color:var(--cute-pink); margin-top:10px;">Kiá»ƒm tra cÃ¢u ${index+1}</button>
                    <div id="b13-sf-feedback-${item.id}" class="feedback"></div>
                `;
                container.appendChild(div);
                userAnswers_B13[`sentenceFill_${item.id}`] = { selected: Array(item.answers.length).fill(null) }; // Initialize based on number of blanks
            });
        }

        function populateSentenceQnA_B13(){
            const container = document.getElementById('sentence-qna');
            container.innerHTML = '<h3>2. å›ç­”é—®é¢˜ (Tráº£ lá»i cÃ¢u há»i):</h3> <p class="instruction-text">ğŸ’¬ DÃ¹ng kiáº¿n thá»©c Ä‘Ã£ há»c Ä‘á»ƒ tráº£ lá»i cÃ¡c cÃ¢u há»i nÃ y báº±ng tiáº¿ng Trung nhÃ©! (Pháº§n nÃ y è€å¸ˆ sáº½ nháº­n xÃ©t sau nha ğŸ˜Š)</p>';
            sentenceQnAData_B13.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'qna-item';
                div.innerHTML = `
                    <p><strong>${index + 1}. ${item.question}</strong></p>
                    <textarea id="b13-qna-ans-${item.id}" placeholder="${item.exampleAnswer}"></textarea>
                    <div class="feedback">ÄÃ¡p Ã¡n cá»§a em sáº½ Ä‘Æ°á»£c è€å¸ˆ xem sau.</div>
                `;
                container.appendChild(div);
                document.getElementById(`b13-qna-ans-${item.id}`).addEventListener('change', (e) => {
                    userAnswers_B13[`sentenceQnA_${item.id}`] = { question: item.question, userAnswer: e.target.value, isSelfAssessed: true };
                });
            });
        }

        function populateYouMeiyou_B13(){
            const container = document.getElementById('sentence-completion-youmeiyou');
            container.innerHTML = '<h3>3. ç”¨ "æœ‰" æˆ– "æ²¡æœ‰" å®Œæˆå¥å­ (DÃ¹ng "cÃ³" hoáº·c "khÃ´ng cÃ³" hoÃ n thÃ nh cÃ¢u):</h3> <p class="instruction-text">âœï¸ HoÃ n thÃ nh cÃ¡c cÃ¢u sau báº±ng cÃ¡ch Ä‘iá»n "æœ‰ (yÇ’u)" hoáº·c "æ²¡æœ‰ (mÃ©iyÇ’u)".</p>';
            youMeiyouData_B13.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'youmeiyou-item';
                let sentenceHtml = '';
                const numAnswers = Array.isArray(item.answers) ? item.answers.length : (item.answer ? 1 : 0);
                let partIndex = 0;
                for (let i = 0; i < numAnswers; i++) {
                    sentenceHtml += `<span>${item.parts[partIndex++]}</span>`;
                    sentenceHtml += `<input type="text" id="b13-ym-${item.id}-${i}" class="youmeiyou-blank" placeholder="æœ‰/æ²¡æœ‰">`;
                }
                if (partIndex < item.parts.length) { // Add remaining part if any
                    sentenceHtml += `<span>${item.parts[partIndex]}</span>`;
                }

                div.innerHTML = `
                    <p><strong>CÃ¢u ${index + 1}:</strong> ${sentenceHtml}</p>
                    <button onclick="checkYouMeiyou_B13('${item.id}', this)" class="action-button" style="font-size:0.9em; padding: 8px 15px; background-color:var(--cute-pink); margin-top:5px;">Kiá»ƒm tra</button>
                    <div id="b13-ym-feedback-${item.id}" class="feedback"></div>
                `;
                container.appendChild(div);
            });
        }

        function populateReadingQuestions_B13(){
            const container = document.querySelector('#section-reading .reading-comprehension');
            const h3Questions = container.querySelector('h3:nth-of-type(2)');
            // Clear previous questions if any, except for the h3 and p
            let currentElement = h3Questions.nextSibling;
            while(currentElement && currentElement.tagName !== 'P') { // Remove elements until the instruction P
                currentElement = currentElement.nextSibling;
            }
            if(currentElement && currentElement.tagName === 'P') currentElement = currentElement.nextSibling; // Move past the P

            while(currentElement) {
                let next = currentElement.nextSibling;
                currentElement.parentNode.removeChild(currentElement);
                currentElement = next;
            }


            readingQuestions_B13.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'question-item';
                div.innerHTML = `
                    <p><strong>${index + 1}. ${item.question}</strong></p>
                    <textarea id="b13-rq-${item.id}" placeholder="Tráº£ lá»i báº±ng tiáº¿ng Trung..."></textarea>
                    <div class="feedback">ÄÃ¡p Ã¡n cá»§a em sáº½ Ä‘Æ°á»£c è€å¸ˆ xem sau.</div>
                `;
                container.appendChild(div); // Append after all existing content within .reading-comprehension
                 document.getElementById(`b13-rq-${item.id}`).addEventListener('change', (e) => {
                    userAnswers_B13[`readingQuestion_${item.id}`] = { question: item.question, userAnswer: e.target.value, isSelfAssessed: true };
                });
            });
        }

        function populateDescribeLuggage_B13(){
            const container = document.getElementById('luggage-description-area');
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const div = document.createElement('div');
                div.className = 'describe-luggage-item';
                div.innerHTML = `
                    <label for="b13-luggage-item-${i}">ä¸œè¥¿ ${i}:</label>
                    <input type="text" id="b13-luggage-item-${i}" placeholder="TÃªn Ä‘á»“ váº­t (HÃ¡n tá»±)">
                    <label for="b13-luggage-color-${i}">é¢œè‰²:</label>
                    <input type="text" id="b13-luggage-color-${i}" placeholder="MÃ u sáº¯c (HÃ¡n tá»±)">
                    <label for="b13-luggage-usage-${i}">ä»€ä¹ˆæ—¶å€™ä½¿ç”¨:</label>
                    <input type="text" id="b13-luggage-usage-${i}" placeholder="Khi nÃ o dÃ¹ng (tiáº¿ng Trung)">
                `;
                container.appendChild(div);
                ['item', 'color', 'usage'].forEach(field => {
                    document.getElementById(`b13-luggage-${field}-${i}`).addEventListener('change', (e) => {
                        if (!userAnswers_B13[`describeLuggage_${i}`]) userAnswers_B13[`describeLuggage_${i}`] = {isSelfAssessed: true};
                        userAnswers_B13[`describeLuggage_${i}`][field] = e.target.value;
                    });
                });
            }
        }


        // --- Check Functions for Bai 13 (Examples) ---
        function checkHanziMatching_B13() {
            let sectionScore = 0;
            userAnswers_B13['hanziMatching_B13'] = [];
            hanziMatchingData_B13.forEach(item => {
                const pinyinSelect = document.getElementById(`b13-pinyin-select-${item.id}`);
                const feedbackEl = document.getElementById(`b13-match-feedback-${item.id}`);
                const userPinyin = pinyinSelect.value;
                let isCorrect = (userPinyin === item.pinyin);

                if (isCorrect) {
                    feedbackEl.textContent = 'ğŸ‰ ChÃ­nh xÃ¡c!';
                    feedbackEl.className = 'feedback correct';
                    sectionScore++;
                } else {
                    feedbackEl.textContent = `ğŸ˜¢ ChÆ°a Ä‘Ãºng. Pinyin Ä‘Ãºng: ${item.pinyin}`;
                    feedbackEl.className = 'feedback incorrect';
                }
                pinyinSelect.disabled = true;
                userAnswers_B13['hanziMatching_B13'].push({
                    id: item.id, hanzi: item.hanzi, userPinyin: userPinyin, correctPinyin: item.pinyin, isCorrect: isCorrect
                });
            });
            updateScore_B13(sectionScore);
            document.querySelector('#hanzi-matching button.action-button').disabled = true;
        }

        function normalizePinyin_B13(pinyin) {
            if (!pinyin) return "";
            let str = pinyin.toLowerCase();
            str = str.replace(/[ÄÃ¡ÇÃ ]/g, 'a').replace(/[Ä“Ã©Ä›Ã¨]/g, 'e').replace(/[Ä«Ã­ÇÃ¬]/g, 'i').replace(/[ÅÃ³Ç’Ã²]/g, 'o').replace(/[Å«ÃºÇ”Ã¹Ã¼Ç–Ç˜ÇšÇœ]/g, 'u').replace(/\s+/g, '');
            return str;
        }

        function checkImageVocab_B13(itemId, correctAnswer, buttonElement) {
            const inputEl = document.getElementById(`b13-iv-${itemId}`);
            const userAnswer = inputEl.value.trim();
            const feedbackEl = document.getElementById(`b13-iv-feedback-${itemId}`);
            let isCorrect = (userAnswer === correctAnswer);

            if(isCorrect) {
                feedbackEl.textContent = 'ğŸ–¼ï¸ğŸ‘ ChÃ­nh xÃ¡c!';
                feedbackEl.className = 'feedback correct';
                updateScore_B13(1);
            } else {
                feedbackEl.textContent = `ğŸ¤” Sai rá»“i. ÄÃ¡p Ã¡n: ${correctAnswer}`;
                feedbackEl.className = 'feedback incorrect';
            }
            inputEl.disabled = true;
            buttonElement.disabled = true;
            userAnswers_B13[`imageVocab_${itemId}`] = { userAnswer, correctAnswer, isCorrect };
        }

        function checkQuantifier_B13(itemId, correctAnswer, buttonElement) {
            const inputEl = document.getElementById(`b13-qf-${itemId}`);
            const userAnswer = inputEl.value.trim();
            const feedbackEl = document.getElementById(`b13-qf-feedback-${itemId}`);
            let isCorrect = (userAnswer === correctAnswer);

            if(isCorrect) {
                feedbackEl.textContent = 'ğŸ“âœ”ï¸ ÄÃºng rá»“i!';
                feedbackEl.className = 'feedback correct';
                updateScore_B13(1);
            } else {
                feedbackEl.textContent = `ğŸ¤” ChÆ°a Ä‘Ãºng. ÄÃ¡p Ã¡n: ${correctAnswer}`;
                feedbackEl.className = 'feedback incorrect';
            }
            inputEl.disabled = true;
            buttonElement.disabled = true;
            userAnswers_B13[`quantifierFill_${itemId}`] = { userAnswer, correctAnswer, isCorrect };
        }

        let selectedSentenceFillOptions = {};

        function selectSentenceFillOption(buttonEl, itemId, selectedOption) {
            const itemContainer = buttonEl.closest('.sentence-fill-item');
            const blanks = itemContainer.querySelectorAll('.blank');
            if (!selectedSentenceFillOptions[itemId]) {
                 selectedSentenceFillOptions[itemId] = Array(blanks.length).fill(null);
            }

            let filled = false;
            for (let i = 0; i < blanks.length; i++) {
                if (blanks[i].textContent === '(chá»n)' || blanks[i].dataset.filled !== 'true') {
                    blanks[i].textContent = selectedOption;
                    blanks[i].style.color = 'var(--primary-color)'; // Change color of filled blank
                    blanks[i].dataset.filled = 'true';
                    selectedSentenceFillOptions[itemId][i] = selectedOption;
                    filled = true;
                    break;
                }
            }
            if(filled) buttonEl.disabled = true;
        }

        function checkSentenceFill_B13(itemId, buttonElement) {
            const itemData = sentenceFillBlanksData_B13.find(i => i.id === itemId);
            const feedbackEl = document.getElementById(`b13-sf-feedback-${itemId}`);
            const userSelectedAnswers = selectedSentenceFillOptions[itemId] || [];
            let allCorrect = true;
            let scoreForThisItem = 0;

            itemData.answers.forEach((correctAnswer, i) => {
                if (userSelectedAnswers[i] !== correctAnswer) {
                    allCorrect = false;
                } else {
                    scoreForThisItem++;
                }
            });

            if (allCorrect && userSelectedAnswers.length === itemData.answers.length) {
                feedbackEl.textContent = 'ğŸ“âœ”ï¸ HoÃ n háº£o!';
                feedbackEl.className = 'feedback correct';
            } else {
                feedbackEl.textContent = `ğŸ¤” Xem láº¡i nhÃ©. ÄÃ¡p Ã¡n Ä‘Ãºng: ${itemData.answers.join(' / ')}`;
                feedbackEl.className = 'feedback incorrect';
            }
            updateScore_B13(scoreForThisItem);
            buttonElement.disabled = true;
            const itemContainer = document.getElementById(`b13-sf-feedback-${itemId}`).closest('.sentence-fill-item');
            if(itemContainer) itemContainer.querySelectorAll('.options-inline button').forEach(btn => btn.disabled = true);

            userAnswers_B13[`sentenceFill_${itemId}`] = { userAnswer: userSelectedAnswers.join(' / '), correctAnswer: itemData.answers.join(' / '), isCorrect: allCorrect };
        }


        function checkYouMeiyou_B13(itemId, buttonElement) {
            const itemData = youMeiyouData_B13.find(i => i.id === itemId);
            const feedbackEl = document.getElementById(`b13-ym-feedback-${itemId}`);
            let allCorrectInItem = true;
            let userAnswersArray = [];
            let scoreForThis = 0;

            const numBlanks = Array.isArray(itemData.answers) ? itemData.answers.length : 1;

            for (let i = 0; i < numBlanks; i++) {
                const inputEl = document.getElementById(`b13-ym-${itemId}-${i}`);
                const userAnswer = inputEl.value.trim();
                userAnswersArray.push(userAnswer);
                const correctAnswer = Array.isArray(itemData.answers) ? itemData.answers[i] : itemData.answer;
                if (userAnswer === correctAnswer) {
                    scoreForThis++;
                } else {
                    allCorrectInItem = false;
                }
                inputEl.disabled = true;
            }

            if (allCorrectInItem) {
                feedbackEl.textContent = 'ğŸ‘ ChÃ­nh xÃ¡c!';
                feedbackEl.className = 'feedback correct';
            } else {
                const correctAnswersText = Array.isArray(itemData.answers) ? itemData.answers.join(' / ') : itemData.answer;
                feedbackEl.textContent = `ğŸ¤” ChÆ°a Ä‘Ãºng. ÄÃ¡p Ã¡n: ${correctAnswersText}`;
                feedbackEl.className = 'feedback incorrect';
            }
            updateScore_B13(scoreForThis);
            buttonElement.disabled = true;
            userAnswers_B13[`youMeiyou_${itemId}`] = { userAnswer: userAnswersArray.join(' / '), correctAnswer: Array.isArray(itemData.answers) ? itemData.answers.join(' / ') : itemData.answer, isCorrect: allCorrectInItem };
        }


        function showFinalSummary_B13() {
            if(timerInterval_B13) clearInterval(timerInterval_B13);
            document.querySelectorAll('.game-section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById('next-section-button').classList.add('hidden');
            document.getElementById('finish-game-button').classList.add('hidden');

            document.getElementById('total-time-taken').textContent = formatTime_B13(secondsElapsed_B13);
            document.getElementById('total-score').textContent = score_B13;

            const detailsUl = document.getElementById('summary-details');
            detailsUl.innerHTML = '';

            if (userAnswers_B13.hanziMatching_B13) {
                const li = document.createElement('li');
                let correctCount = userAnswers_B13.hanziMatching_B13.filter(a => a.isCorrect).length;
                li.innerHTML = `<strong>Pháº§n I.1 - Ná»‘i Chá»¯ HÃ¡n:</strong> ${correctCount}/${hanziMatchingData_B13.length} Ä‘Ãºng.`;
                li.classList.add(correctCount === hanziMatchingData_B13.length ? 'correct-ans' : 'incorrect-ans');
                detailsUl.appendChild(li);
            }
            // ThÃªm tá»•ng káº¿t cho cÃ¡c pháº§n khÃ¡c tÆ°Æ¡ng tá»±...

            document.getElementById('final-summary').classList.remove('hidden');
            window.scrollTo(0, document.getElementById('final-summary').offsetTop - 20);
        }

    </script>
</body>
</html>
