<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo T·ª´ V·ª±ng Vi·ªát-Trung (B√†i 3 - 1 File - S·ª≠a L·ªói Hi·ªÉn Th·ªã)</title>

    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            background-color: #f8f9fa;
        }

        h1 {
            color: #343a40;
        }

        /* Ki·ªÉu cho b·ªô ƒë·∫øm th·ªùi gian */
        .timer {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
            padding: 8px 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            border: 1px solid #ced4da;
            min-width: 220px;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Ki·ªÉu khi th·ªùi gian s·∫Øp h·∫øt */
        .timer.low-time {
            color: #dc3545;
            background-color: #f8d7da;
            border-color: #f5c6cb;
            font-weight: bolder;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }


        .prompt-container {
            text-align: center;
            margin-bottom: 25px;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            min-width: 300px;
        }

        #prompt-language-helper {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        #prompt-word {
            color: #007bff;
            font-size: 2.2em;
            margin-top: 5px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 10px;
            width: 450px; /* Gi·ªØ nguy√™n k√≠ch th∆∞·ªõc l∆∞·ªõi */
            height: 450px; /* Gi·ªØ nguy√™n k√≠ch th∆∞·ªõc l∆∞·ªõi */
            margin-bottom: 20px;
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
            position: relative;
        }

        /* L·ªõp ph·ªß khi tr√≤ ch∆°i k·∫øt th√∫c */
        .grid-container.game-over::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(200, 200, 200, 0.5);
            border-radius: 8px;
            pointer-events: none;
            z-index: 10;
        }

        /* === KH·ªêI CSS ƒê√É S·ª¨A CHO √î ƒê√ÅP √ÅN === */
        .grid-cell {
            background-color: #fff;
            border: 1px solid #ced4da;
            border-radius: 5px;
            display: flex; /* S·ª≠ d·ª•ng flexbox ƒë·ªÉ cƒÉn ch·ªânh */
            justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
            align-items: center;    /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
            /* Gi·∫£m c·ª° ch·ªØ m·ªôt ch√∫t ƒë·ªÉ v·ª´a nhi·ªÅu ch·ªØ h∆°n */
            font-size: 1.2em; /* <-- Gi·∫£m t·ª´ 1.4em xu·ªëng 1.2em */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            text-align: center; /* CƒÉn ch·ªØ gi·ªØa trong tr∆∞·ªùng h·ª£p xu·ªëng d√≤ng */
            padding: 5px; /* Gi·ªØ padding ƒë·ªÉ ch·ªØ kh√¥ng s√°t vi·ªÅn */

            /* B·ªè c√°c thu·ªôc t√≠nh ngƒÉn xu·ªëng d√≤ng v√† ·∫©n ch·ªØ th·ª´a */
            /* overflow: hidden; */ /* --- D√≤ng n√†y ƒë√£ b·ªã lo·∫°i b·ªè ho·∫∑c comment */
            /* text-overflow: ellipsis; */ /* --- D√≤ng n√†y ƒë√£ b·ªã lo·∫°i b·ªè ho·∫∑c comment */
            /* white-space: nowrap; */ /* --- D√≤ng n√†y ƒë√£ b·ªã lo·∫°i b·ªè ho·∫∑c comment */

            /* Cho ph√©p ch·ªØ t·ª± ƒë·ªông xu·ªëng d√≤ng n·∫øu c·∫ßn */
            word-wrap: break-word; /* ƒê·∫£m b·∫£o t·ª´ d√†i b·ªã ng·∫Øt */
            overflow-wrap: break-word; /* T∆∞∆°ng t·ª± word-wrap, h·ªó tr·ª£ t·ªët h∆°n */
            hyphens: auto; /* T·ª± ƒë·ªông g·∫°ch n·ªëi t·ª´ (t√πy ch·ªçn, t√πy tr√¨nh duy·ªát) */

            position: relative;
            z-index: 1;
        }
        /* === K·∫æT TH√öC KH·ªêI CSS ƒê√É S·ª¨A === */

        .grid-cell:hover:not(.correct):not(.disabled) {
            background-color: #f1f3f5;
            transform: scale(1.03);
        }

        .correct {
            background-color: #28a745 !important;
            color: white;
            cursor: default;
            transform: scale(1);
            pointer-events: none;
        }

        .incorrect {
            animation: flash-red 0.5s;
        }

        .disabled {
            cursor: not-allowed !important;
            pointer-events: none !important;
            opacity: 0.6 !important;
             background-color: #e9ecef !important;
             color: #6c757d !important;
        }


        @keyframes flash-red {
            0%, 100% { background-color: #fff; color: black; }
            50% { background-color: #dc3545; color: white; }
        }

        .message {
            margin-top: 15px;
            font-size: 1.3em;
            font-weight: bold;
            color: #17a2b8;
            min-height: 25px;
        }

        /* Ki·ªÉu cho n√∫t B·∫Øt ƒë·∫ßu l·∫°i */
        .restart-btn {
            display: block;
            margin: 20px auto;
            padding: 12px 25px;
            font-size: 1.15em;
            font-weight: bold;
            color: #fff;
            background-color: #6c757d;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .restart-btn:hover {
            background-color: #5a6268;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .restart-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .restart-btn:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
            box-shadow: none;
        }
    </style>
    </head>
<body>

    <h1>Bingo T·ª´ V·ª±ng Vi·ªát-Trung</h1>

    <div id="timer-display" class="timer">Th·ªùi gian c√≤n l·∫°i: 03:00</div>

    <div class="prompt-container">
        <p id="prompt-language-helper"></p>
        <h2 id="prompt-word"></h2>
    </div>

    <div id="grid-container" class="grid-container">
        </div>

    <div id="message" class="message"></div>

    <button id="restart-button" class="restart-btn">B·∫Øt ƒë·∫ßu l·∫°i</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- T·ª´ v·ª±ng v√† Parsing ---
            const rawVocabularyString = `
Â≠¶ - h·ªçc
Ëã±ËØ≠ - ti·∫øng Anh
ÈòøÊãâ‰ºØËØ≠ - Ti·∫øng ·∫¢ R·∫≠p
Âæ∑ËØ≠ - Ti·∫øng ƒê·ª©c
‰øÑËØ≠ - Ti·∫øng Nga
Ê≥ïËØ≠ - Ti·∫øng Ph√°p
Êó•ËØ≠ - Ti·∫øng Nh·∫≠t
Èü©ÂõΩËØ≠ - Ti·∫øng H√†n
Ë∂äÂçóËØ≠ - Ti·∫øng Vi·ªát
Ë•øÁè≠ÁâôËØ≠ - Ti·∫øng T√¢y Ban Nha
Âåó‰∫¨ - B·∫Øc Kinh
Âéª - ƒêi
Èì∂Ë°å - Ng√¢n h√†ng
ÂèñÈí± - R√∫t ti·ªÅn
‰ªäÂ§© - H√¥m nay
Êò®Â§© - H√¥m qua
ÊòéÂ§© - Ng√†y mai
ËßÅ - G·∫∑p
            `;

            function parseVocabulary(rawString) {
                console.log("---- B·∫Øt ƒë·∫ßu Parse Vocabulary ----");
                if (!rawString || typeof rawString !== 'string') {
                     console.error("L·ªói: D·ªØ li·ªáu t·ª´ v·ª±ng ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá.");
                     return [];
                }
                const lines = rawString.trim().split('\n');
                const pairs = lines
                    .map(line => line.trim())
                    .filter(line => line && line.includes(' - '))
                    .map((line, index) => {
                        const parts = line.split(' - ');
                        if (parts.length === 2) {
                            const chinesePart = parts[0].trim();
                            const vietnamesePart = parts[1].trim();
                            if (chinesePart && vietnamesePart) {
                                return { chinese: chinesePart, vietnamese: vietnamesePart };
                            } else {
                                 console.warn(`B·ªè qua d√≤ng ${index + 1}: Ph·∫ßn t·ª≠ r·ªóng sau khi t√°ch "${line}"`);
                                 return null;
                            }
                        } else {
                            console.warn(`B·ªè qua d√≤ng ${index + 1}: Sai ƒë·ªãnh d·∫°ng "${line}" (S·ªë ph·∫ßn t·ª≠: ${parts.length})`);
                            return null;
                        }
                    })
                    .filter(pair => pair !== null);
                console.log(`---- Parse Vocabulary Ho√†n t·∫•t - T√¨m th·∫•y ${pairs.length} c·∫∑p t·ª´ ----`);
                return pairs;
            }


            // --- DOM References ---
            const gridContainer = document.getElementById('grid-container');
            const promptWordElement = document.getElementById('prompt-word');
            const promptLanguageHelperElement = document.getElementById('prompt-language-helper');
            const messageElement = document.getElementById('message');
            const timerDisplayElement = document.getElementById('timer-display');
            const restartButtonElement = document.getElementById('restart-button');

            // --- Constants ---
            const GRID_SIZE = 5;
            const TOTAL_CELLS = GRID_SIZE * GRID_SIZE;
            const TOTAL_TIME_SECONDS = 180; // 3 ph√∫t

            // --- Game State Variables ---
            let vocabulary = []; // S·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn sau khi parse
            let remainingPairs = [];
            let currentPair = null;
            let promptLanguage = '';
            let targetLanguage = '';
            let pairsFound = 0;
            let timerInterval = null;
            let timeLeft = TOTAL_TIME_SECONDS;
            let gameActive = false;

             // --- Timer Functions ---
             function updateTimerDisplay() {
                if (!timerDisplayElement) return;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                timerDisplayElement.textContent = `Th·ªùi gian c√≤n l·∫°i: ${formattedTime}`;
                if (timeLeft <= 30 && timeLeft > 0) { timerDisplayElement.classList.add('low-time'); }
                else { timerDisplayElement.classList.remove('low-time'); }
                if (timeLeft <= 0) { timerDisplayElement.classList.remove('low-time'); }
            }
            function stopTimer() { clearInterval(timerInterval); timerInterval = null; }
            function startTimer() {
                 stopTimer();
                 timeLeft = TOTAL_TIME_SECONDS;
                 updateTimerDisplay();
                 gameActive = true; // QUAN TR·ªåNG: ƒê√°nh d·∫•u game active KHI timer b·∫Øt ƒë·∫ßu
                 timerInterval = setInterval(() => {
                     timeLeft--;
                     updateTimerDisplay();
                     if (timeLeft <= 0) { endGame(false); }
                 }, 1000);
            }

            // --- Game Logic Functions ---
             function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; } }
             function endGame(isWin) {
                if (!gameActive && timerInterval == null) return; // Tr√°nh g·ªçi l·∫°i khi ƒë√£ k·∫øt th√∫c
                gameActive = false; // ƒê√°nh d·∫•u game kh√¥ng c√≤n active
                stopTimer();
                const cells = gridContainer.querySelectorAll('.grid-cell');
                cells.forEach(cell => { cell.classList.add('disabled'); });
                gridContainer.classList.add('game-over');
                if (isWin) {
                     messageElement.textContent = `üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh! üéâ`;
                     promptWordElement.textContent = "‚úîÔ∏è";
                     promptLanguageHelperElement.textContent = "Tuy·ªát v·ªùi!";
                     timerDisplayElement.classList.remove('low-time');
                 } else {
                     messageElement.textContent = "‚è∞ H·∫øt gi·ªù! Th·ª≠ l·∫°i nh√©! ‚è∞";
                     promptWordElement.textContent = "‚è≥";
                     promptLanguageHelperElement.textContent = "ƒê√£ h·∫øt th·ªùi gian";
                     timerDisplayElement.textContent = "Th·ªùi gian: 00:00";
                     timerDisplayElement.classList.remove('low-time');
                 }
             }
            function createGrid() {
                gridContainer.innerHTML = ''; // X√≥a s·∫°ch √¥ c≈©
                for (let i = 0; i < TOTAL_CELLS; i++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell'); // Ch·ªâ th√™m class c∆° b·∫£n
                    gridContainer.appendChild(cell);
                }
                gridContainer.classList.remove('game-over'); // X√≥a l·ªõp ph·ªß
            }
             function selectNextChallenge() {
                if (remainingPairs.length === 0) {
                    if(gameActive) endGame(true);
                    return false;
                }
                if (!gameActive && timerInterval != null) {
                    return false;
                }

                const randomIndex = Math.floor(Math.random() * remainingPairs.length);
                currentPair = remainingPairs[randomIndex];
                remainingPairs.splice(randomIndex, 1);
                promptLanguage = Math.random() < 0.5 ? 'vietnamese' : 'chinese';
                targetLanguage = promptLanguage === 'vietnamese' ? 'chinese' : 'vietnamese';
                promptLanguageHelperElement.textContent = `T√¨m t·ª´ ${targetLanguage === 'vietnamese' ? 'Ti·∫øng Vi·ªát' : 'Ti·∫øng Trung'} t∆∞∆°ng ·ª©ng:`;
                promptWordElement.textContent = currentPair[promptLanguage];
                populateGrid();
                return true;
            }
             function populateGrid() {
                 const correctWord = currentPair[targetLanguage];
                 const allTargetWords = vocabulary.map(pair => pair[targetLanguage]);
                 let distractors = allTargetWords.filter(word => word !== correctWord);
                 shuffleArray(distractors);
                 let gridWords = [correctWord];
                 let distractorIndex = 0;
                 while (gridWords.length < TOTAL_CELLS) {
                     if (distractors.length === 0 || vocabulary.length <= 1) {
                          gridWords.push(correctWord);
                     } else {
                          gridWords.push(distractors[distractorIndex % distractors.length]);
                          distractorIndex++;
                     }
                 }
                 shuffleArray(gridWords);
                 const cells = gridContainer.querySelectorAll('.grid-cell');
                 cells.forEach((cell, index) => {
                      cell.textContent = gridWords[index];
                      cell.className = 'grid-cell';
                      cell.style.pointerEvents = 'auto';
                      cell.removeEventListener('click', handleCellClick); // ƒê·∫£m b·∫£o listener c≈© b·ªã x√≥a
                      cell.addEventListener('click', handleCellClick); // Th√™m listener m·ªõi
                 });
             }
            function handleCellClick(event) {
                if (!gameActive) return;
                const clickedCell = event.target;
                if (!clickedCell.classList.contains('grid-cell') || clickedCell.classList.contains('correct') || clickedCell.classList.contains('disabled')) {
                    return;
                }
                const clickedWord = clickedCell.textContent;
                const expectedWord = currentPair[targetLanguage];
                if (clickedWord === expectedWord) {
                    clickedCell.classList.add('correct','disabled');
                    pairsFound++;
                    selectNextChallenge();
                } else {
                    clickedCell.classList.add('incorrect');
                    clickedCell.style.pointerEvents = 'none'; // T·∫°m th·ªùi v√¥ hi·ªáu h√≥a khi sai
                    setTimeout(() => {
                         if (clickedCell.classList.contains('incorrect')) {
                              clickedCell.classList.remove('incorrect');
                               if (!clickedCell.classList.contains('correct') && !clickedCell.classList.contains('disabled')) {
                                  clickedCell.style.pointerEvents = 'auto'; // K√≠ch ho·∫°t l·∫°i n·∫øu ch∆∞a b·ªã disable vƒ©nh vi·ªÖn
                              }
                         }
                    }, 500);
                }
            }

            // --- Initialization ---
            function initGame() {
                console.log("Initializing game...");
                stopTimer();
                gameActive = false;
                pairsFound = 0;
                // QUAN TR·ªåNG: ƒê·∫£m b·∫£o vocabulary ƒë√£ ƒë∆∞·ª£c parse tr∆∞·ªõc khi g·ªçi initGame
                if (!vocabulary || vocabulary.length === 0) {
                     console.error("Kh√¥ng th·ªÉ init game v√¨ vocabulary r·ªóng!");
                     messageElement.textContent = "L·ªói: Kh√¥ng c√≥ t·ª´ v·ª±ng.";
                     if(restartButtonElement) restartButtonElement.disabled = true;
                     return; // D·ª´ng init n·∫øu kh√¥ng c√≥ t·ª´
                }
                remainingPairs = [...vocabulary];
                shuffleArray(remainingPairs);
                messageElement.textContent = '';
                promptWordElement.textContent = '';
                promptLanguageHelperElement.textContent = 'ƒêang t·∫£i...';
                timerDisplayElement.classList.remove('low-time');
                timerDisplayElement.textContent = "Th·ªùi gian: 03:00";

                createGrid(); // T·∫°o l∆∞·ªõi tr·ªëng

                // Reset c√°c √¥ hi·ªán c√≥ (n·∫øu c√≥) v√† g·∫Øn listener
                 const cells = gridContainer.querySelectorAll('.grid-cell');
                 cells.forEach(cell => {
                     cell.className = 'grid-cell';
                     cell.textContent = '';
                     cell.style.pointerEvents = 'auto';
                     cell.removeEventListener('click', handleCellClick);
                     cell.addEventListener('click', handleCellClick);
                 });


                if (remainingPairs.length > 0) {
                     if (selectNextChallenge()) { // G·ªçi l·∫ßn ƒë·∫ßu ƒë·ªÉ populate grid
                          startTimer(); // Ch·ªâ b·∫Øt ƒë·∫ßu timer khi m·ªçi th·ª© s·∫µn s√†ng
                          promptLanguageHelperElement.textContent = 'T√¨m t·ª´ ƒëi!'; // C·∫≠p nh·∫≠t tr·∫°ng th√°i
                          if(restartButtonElement) restartButtonElement.disabled = false;
                     } else {
                         messageElement.textContent = "L·ªói khi b·∫Øt ƒë·∫ßu v√≤ng m·ªõi.";
                         if(restartButtonElement) restartButtonElement.disabled = true;
                     }
                } else {
                     // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p vocabulary c√≥ nh∆∞ng remainingPairs l·∫°i r·ªóng? (Kh√¥ng n√™n x·∫£y ra n·∫øu logic ƒë√∫ng)
                     messageElement.textContent = "L·ªói: Kh√¥ng c√≥ t·ª´ v·ª±ng ƒë·ªÉ b·∫Øt ƒë·∫ßu.";
                     promptLanguageHelperElement.textContent = 'L·ªói t·∫£i t·ª´';
                     timerDisplayElement.textContent = "Th·ªùi gian: --:--";
                     if(restartButtonElement) restartButtonElement.disabled = true;
                 }
            }

            // --- Event Listeners ---
            if(restartButtonElement) {
                 restartButtonElement.addEventListener('click', initGame);
            } else {
                 console.error("Kh√¥ng t√¨m th·∫•y n√∫t Restart (ID: restart-button)");
            }


            // --- Start Game on Load ---
            vocabulary = parseVocabulary(rawVocabularyString); // Parse ngay khi script ch·∫°y

            if (vocabulary.length === 0) {
                if(messageElement) messageElement.textContent = "L·ªói: Kh√¥ng th·ªÉ t·∫£i danh s√°ch t·ª´ v·ª±ng. (H√£y ki·ªÉm tra Console)";
                if(promptLanguageHelperElement) promptLanguageHelperElement.textContent = 'L·ªói t·∫£i t·ª´';
                if(timerDisplayElement) timerDisplayElement.textContent = "Th·ªùi gian: --:--";
                console.error("!!! L·ªói nghi√™m tr·ªçng: Danh s√°ch t·ª´ v·ª±ng r·ªóng sau khi parse. Tr√≤ ch∆°i kh√¥ng th·ªÉ b·∫Øt ƒë·∫ßu.");
                if(restartButtonElement) restartButtonElement.disabled = true;
            } else {
                console.log(`ƒê√£ t·∫£i th√†nh c√¥ng ${vocabulary.length} c·∫∑p t·ª´. Kh·ªüi t·∫°o tr√≤ ch∆°i...`);
                // ƒê·∫£m b·∫£o n√∫t kh√¥ng b·ªã disable n·∫øu c√≥ t·ª´ v·ª±ng
                 if(restartButtonElement) restartButtonElement.disabled = false;
                initGame(); // B·∫Øt ƒë·∫ßu tr√≤ ch∆°i l·∫ßn ƒë·∫ßu
            }
        });
    </script>
    </body>
</html>