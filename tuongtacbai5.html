<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện tập Hội thoại: Bài 5</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Sử dụng font Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS tùy chỉnh */
        body {
            font-family: 'Inter', sans-serif;
            /* Các lớp này sẽ được bật/tắt bằng JavaScript */
        }
        body.hide-pinyin .pinyin {
            display: none;
        }
        body.hide-vietnamese .dich-nghia {
            display: none;
        }
        
        /* Tạo kiểu cho dropdown thay thế từ */
        .substitute-select {
            @apply border border-gray-300 rounded-md p-1 shadow-sm bg-teal-50 text-teal-800 font-medium focus:ring-teal-500 focus:border-teal-500 mx-1;
        }
        /* Tạo kiểu cho placeholder của select */
        .substitute-select:invalid {
            @apply text-gray-400;
        }

        /* Định dạng dòng hội thoại */
        .dialogue-line {
            @apply flex items-start mb-4;
        }

        .speaker {
            @apply w-16 md:w-20 font-bold text-lg text-teal-700 flex-shrink-0; /* A: hoặc B: */
        }

        .content {
            @apply flex-1 text-lg text-gray-800;
        }

        .pinyin {
            @apply text-sm text-gray-500 mt-1 ml-16 md:ml-20 transition-all duration-200; /* Phiên âm */
        }

        .dich-nghia {
            @apply text-sm text-green-700 italic mt-1 ml-16 md:ml-20 transition-all duration-200; /* Thêm kiểu cho nghĩa TV */
        }

        /* Nút chế độ */
        .mode-btn {
            @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2;
        }
        
        .mode-btn.active {
            @apply bg-teal-600 text-white shadow-md;
        }

        .mode-btn.inactive {
            @apply bg-gray-200 text-gray-700 hover:bg-gray-300;
        }
        
        /* Nút bật/tắt mới */
        .toggle-btn {
            @apply px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 flex items-center space-x-2;
        }
        .toggle-btn.active {
            @apply bg-teal-600 text-white shadow-sm;
        }
        .toggle-btn.inactive {
            @apply bg-gray-200 text-gray-600 hover:bg-gray-300;
        }

        /* Icon SVG inline */
        .icon {
            @apply w-5 h-5;
        }
    </style>
</head>
<body class="bg-teal-50 min-h-screen p-4 md:p-8">

    <!-- Bố cục chính 2 cột -->
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row md:space-x-8">

        <!-- CỘT BÊN TRÁI (Hội thoại) -->
        <div class="flex-1">
            <!-- Tiêu đề -->
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-teal-900">
                    Bài 5: 这是王老师
                </h1>
                <p class="text-xl text-gray-600">Luyện tập Hội thoại Tương tác</p>
            </header>
            
            <!-- Bộ điều khiển -->
            <div class="bg-white rounded-xl shadow-lg p-4 mb-6 sticky top-4 z-10">
                <div class="flex flex-col sm:flex-row justify-center items-center sm:space-x-4 space-y-3 sm:space-y-0">
                    <!-- Nút chế độ -->
                    <div class="flex space-x-4">
                        <button id="mode-1-student" class="mode-btn inactive">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A1.125 1.125 0 0 1 18.374 21H5.626a1.125 1.125 0 0 1-1.125-.882Z" /></svg>
                            <span>1 Học viên</span>
                        </button>
                        <button id="mode-2-student" class="mode-btn active">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A9.065 9.065 0 0 1 6 18.719m12 0a9.049 9.049 0 0 0-12 0m12 0c.031-.046.062-.092.092-.137a9.09 9.09 0 0 0-2.86-1.57M6.092 18.582A9.09 9.09 0 0 1 3.14 17.013m3.05-1.479a9.09 9.09 0 0 1-2.86 1.57M12 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm0 0c0 1.657 1.343 3 3 3s3-1.343 3-3 0-6-3-6-3 1.343-3 3Zm0 0c0 1.657-1.343 3-3 3s-3-1.343-3-3 0-6 3-6 3 1.343 3 3Z" /></svg>
                            <span>2 Học viên</span>
                        </button>
                    </div>
                    <!-- Nút Bật/Tắt Pinyin & Nghĩa -->
                    <div class="flex space-x-4">
                        <button id="toggle-pinyin" class="toggle-btn active">
                            <svg class="icon icon-eye-open" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
                            <svg class="icon icon-eye-closed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="display: none;"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" /></svg>
                            <span class="btn-text">Ẩn Pinyin</span>
                        </button>
                        <button id="toggle-vietnamese" class="toggle-btn active">
                            <svg class="icon icon-eye-open" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
                            <svg class="icon icon-eye-closed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="display: none;"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" /></svg>
                            <span class="btn-text">Ẩn Nghĩa</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Khu vực hội thoại -->
            <main class="space-y-8">

                <!-- Hội thoại 1: Giới thiệu -->
                <section class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6 text-teal-800 border-b border-teal-100 pb-2">
                        Hội thoại 1: 介绍 (Giới thiệu)
                    </h2>

                    <!-- Dòng 1 (A) -->
                    <div class="dialogue-line role-A">
                        <span class="speaker">小林:</span>
                        <div class="content">
                            这是
                            <select id="sub-person-1" class="substitute-select" data-target-pinyin="#pinyin-person-1" data-target-vietnamese="#translation-person-1" required>
                                <option value="" data-pinyin="..." data-vietnamese="..." selected disabled>---chọn người---</option>
                                <option value="王老师" data-pinyin="Wáng lǎoshī" data-vietnamese="Thầy Vương">王老师</option>
                                <option value="朋友" data-pinyin="péngyou" data-vietnamese="bạn">朋友</option>
                                <option value="妈妈" data-pinyin="māmā" data-vietnamese="mẹ">妈妈</option>
                                <option value="哥哥" data-pinyin="gēge" data-vietnamese="anh trai">哥哥</option>
                            </select>
                            ，这是我
                            <select id="sub-family-1" class="substitute-select" data-target-pinyin="#pinyin-family-1" data-target-vietnamese="#translation-family-1" required>
                                <option value="" data-pinyin="..." data-vietnamese="..." selected disabled>---chọn người---</option>
                                <option value="爸爸" data-pinyin="bàba" data-vietnamese="bố">爸爸</option>
                                <option value="妈妈" data-pinyin="māmā" data-vietnamese="mẹ">妈妈</option>
                                <option value="哥哥" data-pinyin="gēge" data-vietnamese="anh trai">哥哥</option>
                                <option value="姐姐" data-pinyin="jiějie" data-vietnamese="chị gái">姐姐</option>
                                <option value="弟弟" data-pinyin="dìdi" data-vietnamese="em trai">弟弟</option>
                                <option value="妹妹" data-pinyin="mèimei" data-vietnamese="em gái">妹妹</option>
                            </select>
                            。
                        </div>
                    </div>
                    <div class="pinyin role-A">Zhè shì <span id="pinyin-person-1">...</span>, zhè shì wǒ <span id="pinyin-family-1">...</span>.</div>
                    <div class="dich-nghia role-A">Đây là <span id="translation-person-1">...</span>, đây là <span id="translation-family-1">...</span> của tôi.</div>

                    <!-- Dòng 2 (B) -->
                    <div class="dialogue-line role-B mt-4">
                        <span class="speaker">爸爸:</span>
                        <div class="content">
                            <select id="sub-person-2" class="substitute-select" data-target-pinyin="#pinyin-person-2" data-target-vietnamese="#translation-person-2" required>
                                <option value="" data-pinyin="..." data-vietnamese="..." selected disabled>---chọn người---</option>
                                <option value="王老师" data-pinyin="Wáng lǎoshī" data-vietnamese="Thầy Vương">王老师</option>
                                <option value="老师" data-pinyin="lǎoshī" data-vietnamese="thầy/cô">老师</option>
                                <option value="朋友" data-pinyin="péngyou" data-vietnamese="bạn">朋友</option>
                            </select>
                            ，您好！
                        </div>
                    </div>
                    <div class="pinyin role-B"><span id="pinyin-person-2">...</span>, nín hǎo!</div>
                    <div class="dich-nghia role-B"><span id="translation-person-2">...</span>, chào ngài!</div>
                    
                    <!-- Dòng 3 (A) -->
                    <div class="dialogue-line role-A mt-4">
                        <span class="speaker">王老师:</span>
                        <div class="content">
                            您好！请进！请坐！请
                            <select id="sub-action-1" class="substitute-select" data-target-pinyin="#pinyin-action-1" data-target-vietnamese="#translation-action-1" required>
                                <option value="" data-pinyin="..." data-vietnamese="..." selected disabled>---chọn đồ uống---</option>
                                <option value="喝茶" data-pinyin="hē chá" data-vietnamese="uống trà">喝茶</option>
                                <option value="喝奶茶" data-pinyin="hē nǎichá" data-vietnamese="uống trà sữa">喝奶茶</option>
                                <option value="喝牛奶" data-pinyin="hē niúnǎi" data-vietnamese="uống sữa">喝牛奶</option>
                                <option value="喝果汁" data-pinyin="hē guǒzhī" data-vietnamese="uống nước quả">喝果汁</option>
                                <option value="喝啤酒" data-pinyin="hē píjiǔ" data-vietnamese="uống bia">喝啤酒</option>
                                <option value="喝矿泉水" data-pinyin="hē kuàngquán shuǐ" data-vietnamese="uống nước khoáng">喝矿泉水</option>
                            </select>
                            ！
                        </div>
                    </div>
                    <div class="pinyin role-A">Nín hǎo! Qǐng jìn! Qǐng zuò! Qǐng <span id="pinyin-action-1">...</span>!</div>
                    <div class="dich-nghia role-A">Chào ngài! Mời vào! Mời ngồi! Mời <span id="translation-action-1">...</span>!</div>

                    <!-- Dòng 4 (B) -->
                    <div class="dialogue-line role-B mt-4">
                        <span class="speaker">爸爸:</span>
                        <div class="content">谢谢！</div>
                    </div>
                    <div class="pinyin role-B">Xièxie!</div>
                    <div class="dich-nghia role-B">Cảm ơn!</div>

                    <!-- Dòng 5 (A) -->
                    <div class="dialogue-line role-A mt-4">
                        <span class="speaker">王老师:</span>
                        <div class="content">不客气！</div>
                    </div>
                    <div class="pinyin role-A">Bú kèqi!</div>
                    <div class="dich-nghia role-A">Đừng khách sáo!</div>
                </section>

                <!-- Hội thoại 2: Hỏi thăm -->
                <section class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6 text-teal-800 border-b border-teal-100 pb-2">
                        Hội thoại 2: 问候 (Hỏi thăm)
                    </h2>
                    
                    <!-- Dòng 1 (A) -->
                    <div class="dialogue-line role-A">
                        <span class="speaker">王老师:</span>
                        <div class="content">
                            工作忙吗？
                        </div>
                    </div>
                    <div class="pinyin role-A">Gōngzuò máng ma?</div>
                    <div class="dich-nghia role-A">Công việc bận không?</div>

                    <!-- Dòng 2 (B) -->
                    <div class="dialogue-line role-B mt-4">
                        <span class="speaker">爸爸:</span>
                        <div class="content">
                            <select id="sub-work-a" class="substitute-select" data-target-pinyin="#pinyin-work-a" data-target-vietnamese="#translation-work-a" required>
                                <option value="" data-pinyin="..." data-vietnamese="..." selected disabled>---chọn trạng thái---</option>
                                <option value="不太忙" data-pinyin="bú tài máng" data-vietnamese="Không bận lắm">不太忙</option>
                                <option value="很忙" data-pinyin="hěn máng" data-vietnamese="Rất bận">很忙</option>
                                <option value="不忙" data-pinyin="bù máng" data-vietnamese="Không bận">不忙</option>
                                <option value="马马虎虎" data-pinyin="mǎmǎhuhu" data-vietnamese="Bình thường">马马虎虎</option>
                            </select>
                            。
                        </div>
                    </div>
                    <div class="pinyin role-B"><span id="pinyin-work-a">...</span>.</div>
                    <div class="dich-nghia role-B"><span id="translation-work-a">...</span>.</div>
                    
                    <!-- Dòng 3 (A) -->
                    <div class="dialogue-line role-A mt-4">
                        <span class="speaker">王老师:</span>
                        <div class="content">身体好吗？</div>
                    </div>
                    <div class="pinyin role-A">Shēntǐ hǎo ma?</div>
                    <div class="dich-nghia role-A">Sức khỏe tốt không?</div>

                    <!-- Dòng 4 (B) -->
                    <div class="dialogue-line role-B mt-4">
                        <span class="speaker">爸爸:</span>
                        <div class="content">
                            <select id="sub-health-a" class="substitute-select" data-target-pinyin="#pinyin-health-a" data-target-vietnamese="#translation-health-a" required>
                                <option value="" data-pinyin="..." data-vietnamese="..." selected disabled>---chọn trạng thái---</option>
                                <option value="很好" data-pinyin="hěn hǎo" data-vietnamese="Rất tốt">很好</option>
                                <option value="好" data-pinyin="hǎo" data-vietnamese="Tốt">好</option>
                                <option value="不太好" data-pinyin="bú tài hǎo" data-vietnamese="Không tốt lắm">不太好</option>
                                <option value="不好" data-pinyin="bù hǎo" data-vietnamese="Không tốt">不好</option>
                                <option value="马马虎虎" data-pinyin="mǎmǎhuhu" data-vietnamese="Bình thường">马马虎虎</option>
                            </select>
                            ！
                        </div>
                    </div>
                    <div class="pinyin role-B"><span id="pinyin-health-a">...</span>!</div>
                    <div class="dich-nghia role-B"><span id="translation-health-a">...</span>!</div>
                </section>

            </main>
        </div> <!-- Hết cột bên trái -->
        
        <!-- CỘT BÊN PHẢI (Từ vựng) -->
        <aside class="w-full md:w-1/3 lg:w-1/4 mt-8 md:mt-0">
            <div class="bg-white rounded-xl shadow-lg p-5 sticky top-4">
                <h3 class="text-xl font-bold text-teal-800 mb-4 border-b border-teal-100 pb-2">
                    <svg class="icon inline-block -mt-1 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" /></svg>
                    Từ vựng Thay thế
                </h3>
                
                <!-- Ngôn ngữ -->
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">
                    <svg class="icon inline-block -mt-1 mr-2 text-teal-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
                    人物 (Người)
                </h4>
                <ul class="space-y-2 text-sm pl-4 list-disc list-inside text-gray-700">
                    <li><strong>王老师</strong> (Wáng lǎoshī): Thầy Vương</li>
                    <li><strong>老师</strong> (lǎoshī): Thầy/cô giáo</li>
                    <li><strong>爸爸</strong> (bàba): Bố</li>
                    <li><strong>妈妈</strong> (māmā): Mẹ</li>
                    <li><strong>哥哥</strong> (gēge): Anh trai</li>
                    <li><strong>姐姐</strong> (jiějie): Chị gái</li>
                    <li><strong>弟弟</strong> (dìdi): Em trai</li>
                    <li><strong>妹妹</strong> (mèimei): Em gái</li>
                    <li><strong>朋友</strong> (péngyou): Bạn bè</li>
                </ul>

                <!-- Địa điểm -->
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">
                    <svg class="icon inline-block -mt-1 mr-2 text-teal-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.092 1.21-.138 2.43-.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7Zm-1.5 0a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Z" /></svg>
                    Hành động/Đồ uống
                </h4>
                <ul class="space-y-2 text-sm pl-4 list-disc list-inside text-gray-700">
                    <li><strong>喝茶</strong> (hē chá): Uống trà</li>
                    <li><strong>喝奶茶</strong> (hē nǎichá): Uống trà sữa</li>
                    <li><strong>喝牛奶</strong> (hē niúnǎi): Uống sữa</li>
                    <li><strong>喝果汁</strong> (hē guǒzhī): Uống nước quả</li>
                    <li><strong>喝啤酒</strong> (hē píjiǔ): Uống bia</li>
                    <li><strong>喝矿泉水</strong> (hē kuàngquán shuǐ): Uống nước khoáng</li>
                </ul>

                <!-- Hành động -->
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">
                    <svg class="icon inline-block -mt-1 mr-2 text-teal-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m0-10.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.75c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.57-.598-3.75h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" /></svg>
                    Trạng thái
                </h4>
                <ul class="space-y-2 text-sm pl-4 list-disc list-inside text-gray-700">
                    <li><strong>很好</strong> (hěn hǎo): Rất tốt</li>
                    <li><strong>好</strong> (hǎo): Tốt</li>
                    <li><strong>不太好</strong> (bú tài hǎo): Không tốt lắm</li>
                    <li><strong>不好</strong> (bù hǎo): Không tốt</li>
                    <li><strong>很忙</strong> (hěn máng): Rất bận</li>
                    <li><strong>不太忙</strong> (bú tài máng): Không bận lắm</li>
                    <li><strong>不忙</strong> (bù máng): Không bận</li>
                    <li><strong>马马虎虎</strong> (mǎmǎhuhu): Bình thường</li>
                </ul>
            </div>
        </aside>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mode1StudentBtn = document.getElementById('mode-1-student');
            const mode2StudentBtn = document.getElementById('mode-2-student');
            const togglePinyinBtn = document.getElementById('toggle-pinyin');
            const toggleVietnameseBtn = document.getElementById('toggle-vietnamese');
            const substituteSelects = document.querySelectorAll('.substitute-select');

            // Hàm cập nhật chế độ hiển thị
            function setMode(mode) {
                const linesRoleB = document.querySelectorAll('.role-B');
                
                if (mode === '1-student') {
                    // Chế độ 1 học viên: Ẩn lời thoại B
                    linesRoleB.forEach(line => line.style.display = 'none');
                    mode1StudentBtn.classList.replace('inactive', 'active');
                    mode2StudentBtn.classList.replace('active', 'inactive');
                } else {
                    // Chế độ 2 học viên: Hiện tất cả
                    // Sử dụng 'flex' cho .dialogue-line và 'block' cho .pinyin, .dich-nghia
                    document.querySelectorAll('.dialogue-line.role-B').forEach(line => line.style.display = 'flex');
                    document.querySelectorAll('.pinyin.role-B').forEach(line => line.style.display = 'block');
                    document.querySelectorAll('.dich-nghia.role-B').forEach(line => line.style.display = 'block');
                    
                    mode1StudentBtn.classList.replace('active', 'inactive');
                    mode2StudentBtn.classList.replace('inactive', 'active');
                }
            }

            // Hàm cập nhật Pinyin VÀ Nghĩa khi thay đổi lựa chọn
            function updateSubstitution(selectElement) {
                try {
                    const selectedOption = selectElement.options[selectElement.selectedIndex];
                    
                    const pinyin = selectedOption.dataset.pinyin;
                    const pinyinTargetSelector = selectElement.dataset.targetPinyin;
                    
                    const vietnamese = selectedOption.dataset.vietnamese;
                    const vietnameseTargetSelector = selectElement.dataset.targetVietnamese;

                    if (pinyinTargetSelector) {
                        const pinyinElement = document.querySelector(pinyinTargetSelector);
                        if (pinyinElement) {
                            pinyinElement.textContent = pinyin;
                        }
                    }
                    
                    if (vietnameseTargetSelector) {
                        const vietnameseElement = document.querySelector(vietnameseTargetSelector);
                        if (vietnameseElement) {
                            vietnameseElement.textContent = vietnamese;
                        }
                    }
                } catch (e) {
                    console.error("Lỗi cập nhật:", e, selectElement);
                }
            }
            
            // Hàm quản lý nút bật/tắt (cho cả Pinyin và Nghĩa)
            function setupToggleButton(btn, bodyClass, openIconSelector, closedIconSelector, textSpanSelector) {
                const textSpan = btn.querySelector(textSpanSelector);
                const openIcon = btn.querySelector(openIconSelector);
                const closedIcon = btn.querySelector(closedIconSelector);
                const baseText = textSpan.textContent.replace('Ẩn', '').replace('Hiện', '').trim();

                btn.addEventListener('click', () => {
                    document.body.classList.toggle(bodyClass);
                    const isActive = !document.body.classList.contains(bodyClass);
                    
                    textSpan.textContent = isActive ? `Ẩn ${baseText}` : `Hiện ${baseText}`;
                    btn.classList.toggle('active', isActive);
                    btn.classList.toggle('inactive', !isActive);
                    
                    openIcon.style.display = isActive ? 'block' : 'none';
                    closedIcon.style.display = isActive ? 'none' : 'block';
                });

                // Đặt trạng thái ban đầu
                const isActive = !document.body.classList.contains(bodyClass);
                textSpan.textContent = isActive ? `Ẩn ${baseText}` : `Hiện ${baseText}`;
                btn.classList.toggle('active', isActive);
                btn.classList.toggle('inactive', !isActive);
                openIcon.style.display = isActive ? 'block' : 'none';
                closedIcon.style.display = isActive ? 'none' : 'block';
            }

            // Gán sự kiện cho các nút chế độ
            mode1StudentBtn.addEventListener('click', () => setMode('1-student'));
            mode2StudentBtn.addEventListener('click', () => setMode('2-student'));

            // Đặt trạng thái ban đầu
            document.body.classList.remove('hide-pinyin');
            document.body.classList.remove('hide-vietnamese');

            // Gán sự kiện cho nút Pinyin
            setupToggleButton(
                togglePinyinBtn, 
                'hide-pinyin', 
                '.icon-eye-open', 
                '.icon-eye-closed',
                '.btn-text'
            );

            // Gán sự kiện cho nút Nghĩa
            setupToggleButton(
                toggleVietnameseBtn, 
                'hide-vietnamese', 
                '.icon-eye-open', 
                '.icon-eye-closed',
                '.btn-text'
            );

            // Gán sự kiện cho tất cả các dropdown
            substituteSelects.forEach(select => {
                // Cập nhật pinyin khi có thay đổi
                select.addEventListener('change', () => updateSubstitution(select));
                
                // Cập nhật lần đầu khi tải trang (để hiển thị '...')
                updateSubstitution(select);
            });

            // Đặt chế độ mặc định là 2 học viên
            setMode('2-student');
        });
    </script>

</body>
</html>
